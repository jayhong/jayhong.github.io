<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>jayhongåšå®¢</title>
    <link>https://jayhong.github.io/</link>
    <description>Recent content on jayhongåšå®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <copyright>jayhong</copyright>
    <lastBuildDate>Mon, 04 Mar 2019 21:38:52 +0800</lastBuildDate>
    
        <atom:link href="https://jayhong.github.io/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>å…³äº</title>
      <link>https://jayhong.github.io/about/</link>
      <pubDate>Mon, 04 Mar 2019 21:38:52 +0800</pubDate>
      
      <guid>https://jayhong.github.io/about/</guid>
      
        <description>&lt;ul&gt;
&lt;li&gt;Golang ç¨‹åºå‘˜ï¼Œå–œæ¬¢æŠ€æœ¯ï¼Œçƒ­çˆ±é’»ç ”ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>Go pprof ä½¿ç”¨</title>
      <link>https://jayhong.github.io/post/profiling-go-programs/</link>
      <pubDate>Mon, 22 Apr 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/profiling-go-programs/</guid>
      
        <description>

&lt;h2 id=&#34;go-pprof-æ€§èƒ½ä¼˜åŒ–&#34;&gt;go pprof æ€§èƒ½ä¼˜åŒ–&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;pprof&lt;/code&gt; æ˜¯&lt;code&gt;golang&lt;/code&gt;å®˜æ–¹æä¾›çš„ä¸€ç§å·¥å…·ï¼Œä¸»è¦å°±æ˜¯ç”¨äºgoç¨‹åºçš„æ€§èƒ½ä¼˜åŒ–ã€‚&lt;code&gt;pprof&lt;/code&gt;çš„åŸç†å°±æ˜¯é€šè¿‡åœ¨&lt;code&gt;golang&lt;/code&gt;ç¨‹åºä¸­é‡‡æ ·
ç”Ÿäº§&lt;code&gt;profile&lt;/code&gt;æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨&lt;code&gt;go tool pprof&lt;/code&gt;å·¥å…·è¿›è¡Œåˆ†æã€‚å¯¹äº&lt;code&gt;web server&lt;/code&gt;ç±»ï¼Œ&lt;code&gt;pprof&lt;/code&gt;æä¾›äº†&lt;code&gt;web&lt;/code&gt;çš„æ–¹å¼æ¥åˆ†ææ€§èƒ½ã€‚&lt;/p&gt;

&lt;h2 id=&#34;prof-æ–‡ä»¶çš„ç±»å‹&#34;&gt;&lt;code&gt;.prof&lt;/code&gt;æ–‡ä»¶çš„ç±»å‹&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;profile&lt;/code&gt;æ–‡ä»¶æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;CPU Profiling&lt;br /&gt;
åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§100hzçš„é¢‘ç‡å»é‡‡é›†åº”ç”¨ç¨‹åºåœ¨ CPU å’Œå¯„å­˜å™¨ä¸Šé¢çš„æ•°æ®ï¼Œå¯¹å½“å‰çš„Goroutineçš„å †æ ˆä¸Šçš„ç¨‹åºè®¡æ•°å™¨çš„å–æ ·ã€‚æ‰€ä»¥å‡ºç°çš„é‡‡æ ·æ¬¡æ•°è¶Šå¤šåˆ™è¯´æ˜ä»£ç çš„è¿è¡Œæ—¶é—´è¶Šé•¿
ç”±æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»æ ·æœ¬è®°å½•ä¸­åˆ†æå‡ºå“ªäº›ä»£ç æ˜¯è®¡ç®—æ—¶é—´æœ€é•¿æˆ–è€…è¯´æœ€è€—CPUèµ„æºçš„éƒ¨åˆ†äº†ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Memory Profiling&lt;br /&gt;
å†…å­˜åˆ†æï¼Œåœ¨åº”ç”¨ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç”¨äºç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ£€æŸ¥å†…å­˜æ³„æ¼ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Block Profiling&lt;br /&gt;
é˜»å¡åˆ†æï¼Œè®°å½• goroutine é˜»å¡ç­‰å¾…åŒæ­¥ï¼ˆåŒ…æ‹¬å®šæ—¶å™¨é€šé“ï¼‰çš„ä½ç½®&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Mutex Profiling&lt;br /&gt;
äº’æ–¥é”åˆ†æï¼ŒæŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;goroutine&lt;br /&gt;
æ‰€æœ‰å½“å‰æ­£åˆ™è¿è¡Œçš„goroutineçš„è°ƒç”¨æ ˆ&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;threadcreate&lt;br /&gt;
è·å–å¯¼è‡´åˆ›å»º OS çº¿ç¨‹çš„ goroutine å †æ ˆ&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;allocs&lt;br /&gt;
è¿‡å»æ‰€æœ‰å†…å­˜åˆ†é…çš„é‡‡æ ·&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;trace&lt;br /&gt;
è·å–å½“å‰çš„æ‰§è¡Œä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡go tool traceå¯ä»¥&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;åœ¨ç¨‹åºä¸­ä½¿ç”¨-pprof&#34;&gt;åœ¨ç¨‹åºä¸­ä½¿ç”¨&lt;code&gt;pprof&lt;/code&gt;&lt;/h2&gt;

&lt;h3 id=&#34;runtime-pprof&#34;&gt;&lt;code&gt;runtime/pprof&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;éserverç±»çš„ç¨‹åºå¯ä»¥ä½¿ç”¨&lt;code&gt;runtime/pprof&lt;/code&gt; è¿›è¡Œé‡‡æ ·ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;cpu profile&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;var cpuprofile = flag.String(&amp;#34;cpuprofile&amp;#34;, &amp;#34;&amp;#34;, &amp;#34;write cpu profile to file&amp;#34;)

func main() {
    flag.Parse()
    if *cpuprofile != &amp;#34;&amp;#34; {
        f, err := os.Create(*cpuprofile)
        if err != nil {
            log.Fatal(err)
        }
        pprof.StartCPUProfile(f)
        defer pprof.StopCPUProfile()
    }
    ...&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;pprof.StartCPUProfile(f)&lt;/code&gt;å¼€å¯cpué‡‡æ ·ï¼Œpprofé»˜è®¤ä¼š100hzé‡‡æ ·ä¸€æ¬¡ï¼Œç„¶åå°†cpué‡‡æ ·ä¿¡æ¯å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚
&lt;code&gt;pprof.StopCPUProfile()&lt;/code&gt; é€šè¿‡å°†é‡‡æ ·é¢‘ç‡è®¾ç½®ä¸º0ï¼Œæ¥æ§åˆ¶åœæ­¢é‡‡æ ·&lt;/p&gt;

&lt;p&gt;ç”Ÿæˆçš„profileå¯ä»¥é€šè¿‡&lt;code&gt;go tool pprof&lt;/code&gt;æ¥è¿›è¡Œåˆ†æ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;heap profile&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;var memprofile = flag.String(&amp;#34;memprofile&amp;#34;, &amp;#34;&amp;#34;, &amp;#34;write memory profile to this file&amp;#34;)
...

    FindHavlakLoops(cfgraph, lsgraph)
    if *memprofile != &amp;#34;&amp;#34; {
        f, err := os.Create(*memprofile)
        if err != nil {
            log.Fatal(err)
        }
        pprof.WriteHeapProfile(f)
        f.Close()
        return
    }&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;heap profileåªéœ€è¦è°ƒç”¨&lt;code&gt;pprof.WriteHeapProfile(file)&lt;/code&gt;å³å¯å®Œæˆé‡‡æ ·ã€‚è¯´æ˜å¯¹äºå †åˆ†é…çš„é‡‡æ ·åœ¨golangä¸­æ˜¯
é»˜è®¤è¿›è¡Œçš„ã€‚åˆ¤æ–­æ˜¯å¦é‡‡æ ·æ˜¯é€šè¿‡&lt;code&gt;runtime.MemProfileRate&lt;/code&gt;æ¥æ§åˆ¶ï¼Œé»˜è®¤å€¼ä¸º &lt;code&gt;512K&lt;/code&gt;, å½“golangåˆ†é…çš„å†…å­˜è¶…è¿‡
512kæ—¶å°±ä¼šè¿›è¡Œé‡‡æ ·ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å…¶å®ƒpprofæ–‡ä»¶çš„ç”Ÿæˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¶ä»–çš„pprofæ–‡ä»¶çš„ç”Ÿæˆå¯ä»¥é€šè¿‡ä½¿ç”¨&lt;code&gt;pprof.Lookup&lt;/code&gt;å‡½æ•°, &lt;code&gt;pprof.Lookup&lt;/code&gt;æ”¯æŒä¸‹åˆ—ç±»å‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;profiles.m = map[string]*Profile{
            &amp;#34;goroutine&amp;#34;:    goroutineProfile,
            &amp;#34;threadcreate&amp;#34;: threadcreateProfile,
            &amp;#34;heap&amp;#34;:         heapProfile,
            &amp;#34;allocs&amp;#34;:       allocsProfile,
            &amp;#34;block&amp;#34;:        blockProfile,
            &amp;#34;mutex&amp;#34;:        mutexProfile,
        }&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;pprof.Lookup&lt;/code&gt;éœ€è¦é…åˆ&lt;code&gt;WirteTo&lt;/code&gt;ä¸€èµ·ä½¿ç”¨, ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func stopBlockProfile() {
    if *blockProfile != &amp;#34;&amp;#34; {
        f, err := os.Create(*blockProfile)
        if err != nil {
            fmt.Fprintf(os.Stderr, &amp;#34;Can not create block profile output file: %s&amp;#34;, err)
            return
        }
        if err = pprof.Lookup(&amp;#34;block&amp;#34;).WriteTo(f, 0); err != nil {
            fmt.Fprintf(os.Stderr, &amp;#34;Can not write %s: %s&amp;#34;, *blockProfile, err)
        }
        f.Close()
    }
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;WriteTo&lt;/code&gt;æ”¯æŒä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ–‡ä»¶æè¿°ç¬¦&lt;code&gt;f&lt;/code&gt;, ç¬¬äºŒä¸ªå‚æ•°æ˜¯&lt;code&gt;debug&lt;/code&gt;, &lt;code&gt;debug&lt;/code&gt;çš„å–å€¼èŒƒå›´ä¸º0ã€1ã€å¤§äºç­‰äº2ã€‚å½“&lt;code&gt;debug&lt;/code&gt;çš„å€¼å°äºç­‰äº&lt;code&gt;0&lt;/code&gt;æ—¶ï¼Œè¿è¡Œæ—¶
ç³»ç»Ÿä»…ä¼šå°†æ¯ä¸ªè®°å½•é¡¹ä¸­çš„åŸºæœ¬ä¿¡æ¯å†™å…¥åˆ°æ¦‚è¦æ–‡ä»¶ä¸­ã€‚è®°å½•é¡¹çš„åŸºæœ¬ä¿¡æ¯åªåŒ…æ‹¬å…¶è°ƒç”¨æ ˆä¸­å„é¡¹çš„ä»¥åå…­
è¿›åˆ¶è¡¨ç¤ºçš„å†…å­˜åœ°å€ã€‚&lt;code&gt;debug&lt;/code&gt;çš„å€¼è¶Šå¤§ï¼Œæˆ‘ä»¬èƒ½ä»æ¦‚è¦æ–‡ä»¶ä¸­è·å–çš„ä¿¡æ¯è¶Šå¤šã€‚&lt;/p&gt;

&lt;h3 id=&#34;net-http-pprof&#34;&gt;&lt;code&gt;net/http/pprof&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;å¯¹äºserverç±»çš„ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;net/http/pprof&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;net/http/pprof&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;0.0.0.0:7200&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä½¿ç”¨èµ·æ¥æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡åœ¨æµè§ˆå™¨ä¸­è®¿é—®&lt;code&gt;http://localhost:7200/debug/pprof/&lt;/code&gt;å¯ä»¥çœ‹åˆ°å¯ä»¥é‡‡é›†çš„profileç±»å‹ã€‚
éšç€ç‰ˆæœ¬çš„ä¸æ–­æ›´æ–°é¡µé¢ä¸Šçš„å†…å®¹ä¹Ÿä¸æ–­ä¸°å¯Œã€‚åœ¨go 1.12 ä¸­ä¼šå°†å¯ä»¥é‡‡é›†çš„ä¿¡æ¯ï¼Œä»¥åŠæ³¨é‡Šéƒ½åœ¨é¡µé¢ä¸­ä½“ç°å‡ºæ¥ã€‚ç‚¹å‡»ç›¸å…³çš„
profile typeï¼Œå¯ä»¥è·³è½¬åˆ°ç›¸å…³çš„ä¿¡æ¯ã€‚å…¶ä¸­æ¯”å¦‚goroutineå¯ä»¥è®¾ç½®debugï¼Œè¿™ä¸ªdebugè·Ÿä¸Šé¢ä»‹ç»åˆ°çš„&lt;code&gt;WriteTo&lt;/code&gt;å‡½æ•°ä¸­çš„&lt;code&gt;debug&lt;/code&gt;
ä¸€æ ·ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;pprof æ˜¯ä»€ä¹ˆæ—¶å€™è¿›è¡Œé‡‡æ ·çš„ï¼Ÿç±»å‹é˜»å¡ä»¥åŠå†…å­˜åˆ†é…çš„profielæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®runtimeä¸­çš„é‡‡æ ·é¢‘ç‡æ¥å…³é—­ã€‚
å¯¹cpuçš„é‡‡é›†å¹¶ä¸æ˜¯ä¸€ç›´è¿›è¡Œçš„ï¼Œå¯ä»¥å‚è€ƒé“¾æ¥&lt;code&gt;https://studygolang.com/articles/11873&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;benchtestç”Ÿæˆpprof&#34;&gt;benchtestç”Ÿæˆpprof&lt;/h3&gt;

&lt;p&gt;å¯ä»¥ä½¿ç”¨å‘½ä»¤&lt;code&gt;go test -bench=BenchmarkStorageXXX -cpuprofile cpu.out -memprofile mem.out&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;go-tool-pprof-çš„ä½¿ç”¨&#34;&gt;&lt;code&gt;go tool pprof&lt;/code&gt; çš„ä½¿ç”¨&lt;/h2&gt;

&lt;p&gt;ç”Ÿæˆçš„profile å’Œ heap profile å¯ä»¥é€šè¿‡go tool pprofè¿›è¡Œåˆ†æã€‚&lt;/p&gt;

&lt;p&gt;è¯¦ç»†çš„ä½¿ç”¨æ–¹å¼å¯ä»¥é€šè¿‡æ‰§è¡Œ &lt;code&gt;go tool pprof -h&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;go tool pprof æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ä¸º &lt;code&gt;pprof &amp;lt;format&amp;gt; [options] [binary] &amp;lt;source&amp;gt;&lt;/code&gt;ï¼Œbinary æ˜¯åº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨æ¥è§£æå„ç§ç¬¦å·ï¼›source è¡¨ç¤º profile æ•°æ®çš„æ¥æºï¼Œå¯ä»¥æ˜¯æœ¬åœ°çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ http åœ°å€ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;go tool pprof binary http://localhost:7200/debug/pprof/profile?seconds=10&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¿›å…¥åˆ°å‘½ä»¤è¡Œäº¤äº’æç¤ºå¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;Fetching profile over HTTP from http://localhost:7200/debug/pprof/profile?seconds=10
Saved profile in /Users/eddycjy/pprof/pprof.samples.cpu.007.pb.gz
Type: cpu
Duration: 1mins, Total samples = 26.55s (44.15%)
Entering interactive mode (type &amp;#34;help&amp;#34; for commands, &amp;#34;o&amp;#34; for options)
(pprof) &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä¸‹é¢ä»‹ç»å‡ ä¸ªæœ€å¸¸ç”¨çš„å­å‘½ä»¤ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;top&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;(pprof) top10
Showing nodes accounting for 1040ms, 48.37% of 2150ms total
Dropped 76 nodes (cum &amp;lt;= 10.75ms)
Showing top 10 nodes out of 123
      flat  flat%   sum%        cum   cum%
     190ms  8.84%  8.84%      740ms 34.42%  runtime.mallocgc
     190ms  8.84% 17.67%      190ms  8.84%  runtime.memclrNoHeapPointers
     140ms  6.51% 24.19%      160ms  7.44%  runtime.heapBitsSetType
      90ms  4.19% 28.37%      330ms 15.35%  regexp.makeOnePass.func1
      80ms  3.72% 32.09%      190ms  8.84%  regexp.onePassCopy
      80ms  3.72% 35.81%      110ms  5.12%  runtime.scanobject
      70ms  3.26% 39.07%      100ms  4.65%  regexp.(*Regexp).doOnePass
      70ms  3.26% 42.33%       70ms  3.26%  regexp.cleanupOnePass
      70ms  3.26% 45.58%      390ms 18.14%  runtime.growslice
      60ms  2.79% 48.37%       70ms  3.26%  net/url.unescape&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;top å‘½ä»¤å„åˆ—çš„å«ä¹‰ï¼š
    * flatï¼šç»™å®šå‡½æ•°ä¸Šè¿è¡Œè€—æ—¶
    * flat%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹
    * sum%ï¼šç»™å®šå‡½æ•°ç´¯ç§¯ä½¿ç”¨ CPU æ€»æ¯”ä¾‹
    * cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šå®ƒä¹‹ä¸Šçš„è°ƒç”¨è¿è¡Œæ€»è€—æ—¶
    * cum%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;top -cum&lt;br /&gt;
æŒ‰ç…§cumåˆ—è¿›è¡Œæ’åºï¼Œä¸æ˜¯100%æ˜¯å› ä¸ºæœ‰æˆªæ–­&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;list æ­£åˆ™è¡¨è¾¾å¼&lt;br /&gt;
æŸ¥çœ‹æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å‡½æ•°æ¯ä¸€è¡Œä»£ç çš„è¿è¡Œæƒ…å†µ&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;peek æ­£åˆ™è¡¨è¾¾å¼&lt;br /&gt;
ä»¥è¡¨æ ¼çš„å½¢å¼å±•ç¤ºå‡½æ•°&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;web  æ­£åˆ™è¡¨è¾¾å¼&lt;br /&gt;
åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºåˆ†é…çš„æƒ…å†µæˆ–è€…è€—æ—¶æƒ…å†µã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;weblist æ­£åˆ™è¡¨è¾¾å¼&lt;br /&gt;
å°†listå‘½ä»¤è¾“å‡ºçš„å†…å®¹åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼Œç‚¹å‡»åº•è‰²ä¸ºé»‘è‰²çš„ä»£ç å¯ä»¥æ˜¾ç¤ºç›¸å…³çš„æ±‡ç¼–&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;go tool pprof åœ¨åˆ†æheap profileçš„æ—¶å€™æ”¯æŒä¸€äº›option&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;-inuse_space           ä½¿ç”¨å†…å­˜çš„å¤§å°
-inuse_objects         ä½¿ç”¨å †å¯¹è±¡çš„ä¸ªæ•°
-alloc_space           åˆ†é…çš„å †å†…å­˜å¤§å°
-alloc_objects         åˆ†é…çš„å †å¯¹è±¡ä¸ªæ•°
--nodefraction=0.1     è¿‡æ»¤æ‰å™ªéŸ³ï¼Œå°å¯¹è±¡ä¸åˆ—å‡º&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ç‰¹åˆ«æ¨è &lt;code&gt;go tool -http=:8080 profile&lt;/code&gt;
ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åœ¨webç«¯æ˜¾ç¤ºprofileçš„å†…å®¹ï¼Œæ›´åŠ ç›´è§‚æ˜“ç”¨ã€‚è¿˜å¯ä»¥æŸ¥çœ‹ç«ç„°å›¾&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;go tool pprof&lt;/code&gt;åˆ†æç¨‹åºæ€§èƒ½çš„å…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒé“¾æ¥ &lt;code&gt;http://xargin.com/pprof-and-flamegraph/&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;go-tool-trace-çš„ä½¿ç”¨&#34;&gt;&lt;code&gt;go tool trace&lt;/code&gt; çš„ä½¿ç”¨&lt;/h2&gt;

&lt;p&gt;å¯ä»¥å‚è€ƒå°ç±³è¿ç»´çš„æ–‡ç« 
&lt;a href=&#34;https://mp.weixin.qq.com/s/I9xSMxy32cALSNQAN8wlnQ&#34;&gt;https://mp.weixin.qq.com/s/I9xSMxy32cALSNQAN8wlnQ&lt;/a&gt;&lt;br /&gt;
æ˜¯å¯¹ä»¥ä¸‹é“¾æ¥çš„ç¿»è¯‘&lt;br /&gt;
&lt;a href=&#34;https://blog.gopheracademy.com/advent-2017/go-execution-tracer/&#34;&gt;https://blog.gopheracademy.com/advent-2017/go-execution-tracer/&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;ç«ç„°å›¾&#34;&gt;ç«ç„°å›¾&lt;/h2&gt;

&lt;p&gt;ç«ç„°å›¾ï¼ˆFlame Graphï¼‰æ˜¯ Bredan Gregg åˆ›å»ºçš„ä¸€ç§æ€§èƒ½åˆ†æå›¾è¡¨ï¼Œå› ä¸ºå®ƒçš„æ ·å­è¿‘ä¼¼ ğŸ”¥è€Œå¾—åã€‚ä¸Šé¢çš„ profiling ç»“æœä¹Ÿè½¬æ¢æˆç«ç„°å›¾ï¼Œå¦‚æœå¯¹ç«ç„°å›¾æ¯”è¾ƒäº†è§£å¯ä»¥æ‰‹åŠ¨æ¥æ“ä½œï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬è¦ä»‹ç»ä¸€ä¸ªå·¥å…·ï¼š(go-torch)[&lt;a href=&#34;https://github.com/uber-archive/go-torch]ã€‚è¿™æ˜¯&#34;&gt;https://github.com/uber-archive/go-torch]ã€‚è¿™æ˜¯&lt;/a&gt; uber å¼€æºçš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥ç›´æ¥è¯»å– golang profiling æ•°æ®ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç«ç„°å›¾çš„ svg æ–‡ä»¶ã€‚ç«ç„°å›¾ svg æ–‡ä»¶å¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰“å¼€ï¼Œå®ƒå¯¹äºè°ƒç”¨å›¾çš„æœ€ä¼˜ç‚¹æ˜¯å®ƒæ˜¯åŠ¨æ€çš„ï¼šå¯ä»¥é€šè¿‡ç‚¹å‡»æ¯ä¸ªæ–¹å—æ¥ zoom in åˆ†æå®ƒä¸Šé¢çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;p&gt;ç«ç„°å›¾çš„è°ƒç”¨é¡ºåºä»ä¸‹åˆ°ä¸Šï¼ˆåœ¨go pprof toolä¸­æ˜¯ä»ä¸Šåˆ°ä¸‹ï¼‰ï¼Œæ¯ä¸ªæ–¹å—ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸Šé¢ä¸€å±‚è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨å“ªäº›å‡½æ•°ï¼Œæ–¹å—çš„å¤§å°ä»£è¡¨äº†å ç”¨ CPU ä½¿ç”¨çš„é•¿çŸ­ã€‚ç«ç„°å›¾çš„é…è‰²å¹¶æ²¡æœ‰ç‰¹æ®Šçš„æ„ä¹‰ï¼Œé»˜è®¤çš„çº¢ã€é»„é…è‰²æ˜¯ä¸ºäº†æ›´åƒç«ç„°è€Œå·²ã€‚æ‰€ä»¥ä¸»è¦å…³æ³¨é•¿çš„&lt;/p&gt;

&lt;p&gt;go-torch å·¥å…·çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°çš„è¯ï¼Œå®ƒä¼šå°è¯•ä» &lt;a href=&#34;http://localhost:8080/debug/pprof/profile&#34;&gt;http://localhost:8080/debug/pprof/profile&lt;/a&gt; è·å– profiling æ•°æ®ã€‚å®ƒæœ‰ä¸‰ä¸ªå¸¸ç”¨çš„å‚æ•°å¯ä»¥è°ƒæ•´ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;-u &amp;ndash;urlï¼šè¦è®¿é—®çš„ URLï¼Œè¿™é‡Œåªæ˜¯ä¸»æœºå’Œç«¯å£éƒ¨åˆ†&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;-s &amp;ndash;suffixï¼špprof profile çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º /debug/pprof/profile&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;&amp;ndash;secondsï¼šè¦æ‰§è¡Œ profiling çš„æ—¶é—´é•¿åº¦ï¼Œé»˜è®¤ä¸º 30s&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;go-torch åœ¨go 1.11 ä¹‹åå·²ç»é›†æˆåˆ°go tool pprofä¸­, é€šè¿‡&lt;code&gt;go tool -http=:8080 profile&lt;/code&gt; å¯ä»¥æŸ¥çœ‹.&lt;/p&gt;

&lt;p&gt;å¦‚æœä½¿ç”¨go 1.11 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;# Get the pprof tool directly
$ go get -u github.com/google/pprof

$ pprof -http=&amp;#34;:8081&amp;#34; [binary] [profile]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;ä¼˜åŒ–å»ºè®®&#34;&gt;ä¼˜åŒ–å»ºè®®&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;ä¸è¦è¿‡æ—©ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;äº†è§£golangé€ƒé€¸åˆ†æï¼Œå‡å°‘å †åˆ†é…&lt;/li&gt;
&lt;li&gt;å¯¹é¢‘ç¹åˆ†é…çš„å°å¯¹è±¡ï¼Œä½¿ç”¨ sync.Pool å¯¹è±¡æ± é¿å…åˆ†é…&lt;/li&gt;
&lt;li&gt;ç”¨ atomic.Load/StoreXXXï¼Œatomic.Value, sync.Map ç­‰ä»£æ›¿ Mutexã€‚(ä¼˜å…ˆçº§é€’å‡)&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é«˜æ•ˆçš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ç”¨fasthttpæ›¿ä»£ net/http&lt;/li&gt;
&lt;li&gt;åœ¨å¼€å‘ç¯å¢ƒåŠ ä¸Š-raceç¼–è¯‘é€‰é¡¹è¿›è¡Œç«æ€æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;åœ¨å¼€å‘ç¯å¢ƒå¼€å¯ net/http/pprofï¼Œæ–¹ä¾¿å®æ—¶ pprof&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.golang.org/profiling-go-programs&#34;&gt;https://blog.golang.org/profiling-go-programs&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://studygolang.com/articles/11873&#34;&gt;https://studygolang.com/articles/11873&lt;/a&gt;
&lt;a href=&#34;http://xargin.com/pprof-and-flamegraph/&#34;&gt;http://xargin.com/pprof-and-flamegraph/&lt;/a&gt;
&lt;a href=&#34;https://www.jianshu.com/p/162f44022eb7&#34;&gt;https://www.jianshu.com/p/162f44022eb7&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://www.cnblogs.com/Leo_wl/p/7426618.html&#34;&gt;https://www.cnblogs.com/Leo_wl/p/7426618.html&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://lrita.github.io/2017/05/26/golang-memory-pprof&#34;&gt;https://lrita.github.io/2017/05/26/golang-memory-pprof&lt;/a&gt;
&lt;a href=&#34;https://cizixs.com/2017/09/11/profiling-golang-program/&#34;&gt;https://cizixs.com/2017/09/11/profiling-golang-program/&lt;/a&gt;
&lt;a href=&#34;https://mp.weixin.qq.com/s/I9xSMxy32cALSNQAN8wlnQ&#34;&gt;https://mp.weixin.qq.com/s/I9xSMxy32cALSNQAN8wlnQ&lt;/a&gt;
&lt;a href=&#34;https://blog.gopheracademy.com/advent-2017/go-execution-tracer/&#34;&gt;https://blog.gopheracademy.com/advent-2017/go-execution-tracer/&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>golang Assemblerå­¦ä¹ </title>
      <link>https://jayhong.github.io/post/20190404-golang-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/</link>
      <pubDate>Thu, 04 Apr 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190404-golang-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/</guid>
      
        <description>

&lt;h2 id=&#34;å¯ä»¥å­¦åˆ°ä»€ä¹ˆ&#34;&gt;å¯ä»¥å­¦åˆ°ä»€ä¹ˆ&lt;/h2&gt;

&lt;p&gt;çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œå¯ä»¥å­¦åˆ°ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;go æ±‡ç¼–çš„åˆæ­¥è®¤è¯†&lt;/li&gt;
&lt;li&gt;go æ±‡ç¼–ä¸­ä½¿ç”¨åˆ°çš„ä¼ªå¯„å­˜å™¨&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å£°æ˜å¸¸é‡ã€å…¨å±€å˜é‡ã€å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬æ–‡æ˜¯çœ‹å®Œgolangå®˜æ–¹æ–‡æ¡£&lt;a href=&#34;https://golang.org/doc/asm&#34;&gt;A Quick Guide to Go&amp;rsquo;s Assembler&lt;/a&gt; ä¹‹åå†™çš„ç¬”è®°ã€‚å¤§éƒ¨åˆ†æ˜¯æŒ‰ç…§åŸæ–‡æ¥ç¿»è¯‘çš„ã€‚
å…¶ä¸­æœ‰ä¸€äº›æ¦‚å¿µï¼Œåœ¨åˆæ­¥çœ‹çš„æ—¶å€™ä¸å¤ªæ‡‚ï¼Œåé¢çœ‹äº†ç½‘ç»œä¸Šçš„å…¶ä»–èµ„æ–™ä¹‹åæ…¢æ…¢æ‹é¡ºäº†ã€‚å­¦ä¹ æ±‡ç¼–çš„åŸå› ä¸»è¦æ˜¯ä¸ºäº†å­¦ä¹ golangä¸€äº›åŸç†æ€§çš„
ä¸œè¥¿ï¼Œä»¥åŠå­¦ä¹ è®¡ç®—æœºå†…å­˜æ¨¡å‹ã€‚åŒæ—¶çœ‹ä¸‹èƒ½å¦åœ¨é‡åˆ°æŸäº›é—®é¢˜çš„æ—¶å€™èƒ½å¦å¤šä¸€ç§æ–¹å¼å»è§£å†³ã€‚&lt;/p&gt;

&lt;p&gt;golangä½¿ç”¨çš„æ±‡ç¼–è¯­è¨€æ˜¯åŸºäºplan9çš„ï¼Œåœ¨golangä¸­ä½¿ç”¨çš„æ±‡ç¼–è¯­è¨€æ˜¯ä¸€ç§æŠ½è±¡çš„è¯­è¨€ï¼Œå¹¶ä¸é’ˆå¯¹æŸä¸€ç§ç‰¹å®šç±»å‹çš„æœºå™¨ã€‚
å¦‚æœæƒ³è¦æŸ¥çœ‹golangæ±‡ç¼–åœ¨æŸç§å¹³å°ä¸Šç”Ÿæˆçš„æŠ½è±¡ä»£ç ï¼Œå¯ä»¥æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;GOOS=linux GOARCH=amd64 go tool compile -S x.go    # or: go build -gcflags -S x.go&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;å¸¸é‡&#34;&gt;å¸¸é‡&lt;/h2&gt;

&lt;p&gt;è™½ç„¶æ±‡ç¼–è¯­è¨€æ˜¯åŸºäºplan 9çš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›ä¸åŒçš„åœ°æ–¹ï¼Œå¸¸é‡æ±‚å€¼ï¼Œå¦å¤–ä¸€ä¸ªå¸¸é‡æ€»æ˜¯å½“åšæ˜¯64ä½æ— ç¬¦å·æ•´æ•°ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç¬¦å·&#34;&gt;ç¬¦å·&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;ä¼ªå¯„å­˜å™¨ pseudo-registers&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;FP: Frame pointer: arguments and locals.
PC: Program counter: jumps and branches.
SB: Static base pointer: global symbols.
SP: Stack pointer: top of stack.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„ç¬¦å·ï¼Œéƒ½è¢«å†™æˆ&lt;code&gt;pseudo-registers FP&lt;/code&gt;å’Œ&lt;code&gt;SB&lt;/code&gt;çš„åç§»&lt;/p&gt;

&lt;p&gt;&lt;code&gt;pseudo-registers SB&lt;/code&gt;å¯ä»¥å½“åšæ˜¯å†…å­˜çš„èµ·ç‚¹ï¼Œæ‰€ä»¥ç¬¦å·&lt;code&gt;foo(SB)&lt;/code&gt; æ˜¯nameä¸ºfoo åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚è¿™ç§æ ¼å¼ä¸»è¦ç”¨äº
å…¨å±€å‡½æ•°ä»¥åŠæ•°æ®ã€‚åœ¨åå­—ä¹‹å‰åŠ ä¸Š&lt;code&gt;&amp;lt;&amp;gt;&lt;/code&gt;,æ¯”å¦‚&lt;code&gt;foo&amp;lt;&amp;gt;(SB)&lt;/code&gt;,å¯ä»¥å°†nameçš„è®¿é—®èŒƒå›´é™åˆ¶åœ¨å½“å‰æ–‡ä»¶ä¸­ã€‚åœ¨åå­—ä¹‹å‰
åŠ ä¸Šåç§»é‡å¯ä»¥æŒ‡å‘name åç§»ç›¸åº”åç§»é‡ä¹‹åçš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥&lt;code&gt;foo+4(SB)&lt;/code&gt; æ˜¯åœ¨foo 4 Bytesä¹‹åçš„åœ°å€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;pseudo-register FP&lt;/code&gt; æ˜¯ä¸€ä¸ªç”¨äºå¼•ç”¨å‡½æ•°å‚æ•°çš„è™šæ‹ŸframeæŒ‡é’ˆï¼Œç¼–è¯‘å™¨ç»´æŠ¤äº†ä¸€ä¸ªè™šæ‹ŸframeæŒ‡é’ˆå¹¶ä¸”å°†å †æ ˆä¸Šçš„
å‡½æ•°å‚æ•°ä½œä¸ºè¯¥ä¼ªå¯„å­˜å™¨çš„åç§»é‡ã€‚å› æ­¤&lt;code&gt;0ï¼ˆFPï¼‰&lt;/code&gt;æ˜¯å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ&lt;code&gt;8ï¼ˆFPï¼‰&lt;/code&gt;æ˜¯ç¬¬äºŒä¸ªï¼ˆåœ¨64ä½æœºå™¨ä¸Šï¼‰ã€‚ä½†æ˜¯ï¼Œ
å½“ä»¥è¿™ç§æ–¹å¼å¼•ç”¨å‡½æ•°å‚æ•°æ—¶ï¼Œå¿…é¡»åœ¨å¼€å¤´æ”¾ç½®ä¸€ä¸ªåç§°ï¼Œå¦‚&lt;code&gt;first_arg + 0ï¼ˆFPï¼‰&lt;/code&gt;å’Œ&lt;code&gt;second_arg + 8ï¼ˆFPï¼‰&lt;/code&gt;ã€‚
ï¼ˆè¿™é‡Œä¸ä¸Šé¢çš„SB ä¼ªå¯„å­˜å™¨çš„åç§»é‡ä¸åŒï¼Œ&lt;code&gt;foo+4(SB)&lt;/code&gt; æ˜¯ç›¸å¯¹äºfooçš„åç§»é‡ï¼Œ&lt;code&gt;first_arg + 0ï¼ˆFP&lt;/code&gt;çš„åç§»é‡ï¼‰
æ±‡ç¼–ç¨‹åºå¼ºåˆ¶æ‰§è¡Œæ­¤çº¦å®šï¼Œæ‹’ç»æ™®é€š&lt;code&gt;0ï¼ˆFPï¼‰&lt;/code&gt;å’Œ&lt;code&gt;8ï¼ˆFPï¼‰&lt;/code&gt;ã€‚ å®é™…åç§°åœ¨è¯­ä¹‰ä¸Šæ˜¯ä¸ç›¸å…³çš„ï¼Œä½†åº”è¯¥ç”¨äºè®°å½•å‚æ•°çš„åç§°ã€‚ å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œ&lt;code&gt;FP&lt;/code&gt;å§‹ç»ˆæ˜¯ä¼ªå¯„å­˜å™¨ï¼Œè€Œä¸æ˜¯ç¡¬ä»¶å¯„å­˜å™¨ï¼Œå³ä½¿åœ¨å…·æœ‰ç¡¬ä»¶å¸§æŒ‡é’ˆçš„æ¶æ„ä¸Šä¹Ÿæ˜¯å¦‚æ­¤ã€‚
å¯¹äºGo prototypesçš„æ±‡ç¼–å‡½æ•°ï¼Œgo vetå°†æ£€æŸ¥å‚æ•°åç§°å’Œåç§»é‡æ˜¯å¦åŒ¹é…ã€‚ åœ¨32ä½ç³»ç»Ÿä¸Šï¼Œé€šè¿‡åœ¨åç§°ä¸­æ·»åŠ &lt;code&gt;_lo&lt;/code&gt;
æˆ–&lt;code&gt;_hi&lt;/code&gt;åç¼€æ¥åŒºåˆ†64ä½å€¼çš„ä½32ä½å’Œé«˜ä½ï¼Œå¦‚&lt;code&gt;arg_lo + 0ï¼ˆFPï¼‰&lt;/code&gt;æˆ–&lt;code&gt;arg_hi + 4ï¼ˆFPï¼‰&lt;/code&gt;ã€‚ å¦‚æœGo prototypesæœªå‘½åå…¶ç»“æœï¼Œ
åˆ™è¿”å›é¢„æœŸçš„ç¨‹åºé›†åç§°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;pseudo-register SP&lt;/code&gt;ä¼ªå¯„å­˜å™¨æ˜¯ä¸€ä¸ªè™šæ‹Ÿæ ˆæŒ‡é’ˆï¼Œç”¨äºå¼•ç”¨å¸§æœ¬åœ°å˜é‡å’Œä¸ºå‡½æ•°è°ƒç”¨å‡†å¤‡çš„å‚æ•°ã€‚å®ƒæŒ‡å‘æœ¬åœ°æ ˆå¸§çš„é¡¶éƒ¨ï¼Œ
å› æ­¤å¼•ç”¨åº”ä½¿ç”¨&lt;code&gt;[-framesizeï¼Œ0]&lt;/code&gt;èŒƒå›´å†…çš„è´Ÿåç§»ï¼š&lt;code&gt;x-8ï¼ˆSPï¼‰&lt;/code&gt;ï¼Œ&lt;code&gt;y-4ï¼ˆSPï¼‰&lt;/code&gt;ï¼Œä¾æ­¤ç±»æ¨ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å…·æœ‰åä¸ºSPçš„ç¡¬ä»¶å¯„å­˜å™¨çš„ä½“ç³»ç»“æ„ä¸Šï¼Œåç§°å‰ç¼€å°†å¯¹è™šæ‹Ÿå †æ ˆæŒ‡é’ˆçš„å¼•ç”¨ä¸å¯¹ä½“ç³»ç»“æ„SPå¯„å­˜å™¨çš„å¼•ç”¨åŒºåˆ†å¼€æ¥ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;code&gt;x-8ï¼ˆSPï¼‰&lt;/code&gt;å’Œ&lt;code&gt;-8ï¼ˆSPï¼‰&lt;/code&gt;æ˜¯ä¸åŒçš„å­˜å‚¨å™¨ä½ç½®ï¼šç¬¬ä¸€ä¸ªæ˜¯æŒ‡è™šæ‹Ÿå †æ ˆæŒ‡é’ˆä¼ªå¯„å­˜å™¨ï¼Œè€Œç¬¬äºŒä¸ªæ˜¯æŒ‡ç¡¬ä»¶çš„SPå¯„å­˜å™¨ã€‚&lt;/p&gt;

&lt;p&gt;åˆ†æ”¯å’Œç›´æ¥è·³è½¬å§‹ç»ˆå†™ä¸ºPCçš„åç§»é‡ï¼Œæˆ–jump åˆ°æ ‡ç­¾ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;label:
    MOVW $0, R1
    JMP label&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ¯ä¸ªæ ‡ç­¾ä»…åœ¨å®šä¹‰å®ƒçš„å‡½æ•°å†…å¯è§ã€‚ å› æ­¤ï¼Œå…è®¸æ–‡ä»¶ä¸­çš„å¤šä¸ªå‡½æ•°å®šä¹‰å’Œä½¿ç”¨ç›¸åŒçš„æ ‡ç­¾åç§°ã€‚
Direct jumps and call instructions can target text symbols, such as name(SB), but not offsets from symbols, such as name+4(SB).
(æ„æ€åº”è¯¥æ˜¯è·³è½¬å¯ä»¥è·³è½¬åˆ° &lt;code&gt;name(SB)&lt;/code&gt;, ä½†æ˜¯æ— æ³•è·³è½¬åˆ°&lt;code&gt;name(SB)&lt;/code&gt;çš„åç§»ï¼‰&lt;/p&gt;

&lt;p&gt;æŒ‡ä»¤ï¼Œå¯„å­˜å™¨å’Œæ±‡ç¼–ç¨‹åºæŒ‡ä»¤æ€»æ˜¯å¤§å†™ï¼Œä»¥æé†’æ‚¨æ±‡ç¼–ç¼–ç¨‹æ˜¯ä¸€é¡¹fraught endeavorã€‚&lt;/p&gt;

&lt;p&gt;åœ¨Goå¯¹è±¡æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œç¬¦å·çš„å…¨åæ˜¯åŒ…è·¯å¾„ï¼Œåè·Ÿå¥ç‚¹å’Œç¬¦å·åç§°ï¼š&lt;code&gt;fmt.Printf&lt;/code&gt;æˆ–&lt;code&gt;math / rand.Int&lt;/code&gt;ã€‚ å› ä¸ºæ±‡ç¼–ç¨‹åºçš„è§£æå™¨å°†å¥ç‚¹å’Œæ–œæ è§†ä¸ºæ ‡ç‚¹ç¬¦å·ï¼Œæ‰€ä»¥è¿™äº›å­—ç¬¦ä¸²ä¸èƒ½ç›´æ¥ç”¨ä½œæ ‡è¯†ç¬¦åç§°ã€‚
ç›¸åï¼Œæ±‡ç¼–ç¨‹åºå…è®¸åœ¨æ ‡è¯†ç¬¦ä¸­ä½¿ç”¨ä¸­é—´ç‚¹å­—ç¬¦&lt;code&gt;U + 00B7&lt;/code&gt;å’Œé™¤æ³•æ–œæ &lt;code&gt;U + 2215&lt;/code&gt;ï¼Œå¹¶å°†å®ƒä»¬é‡å†™ä¸ºæ™®é€šå¥ç‚¹å’Œæ–œæ ã€‚
åœ¨æ±‡ç¼–æºæ–‡ä»¶ä¸­ï¼Œä¸Šé¢çš„ç¬¦å·å†™ä¸º&lt;code&gt;fmtÂ·Printf&lt;/code&gt;å’Œ&lt;code&gt;math / randÂ·Int&lt;/code&gt;ã€‚ ç¼–è¯‘å™¨åœ¨ä½¿ç”¨-Sæ ‡å¿—æ—¶ç”Ÿæˆçš„ç¨‹åºé›†åˆ—è¡¨ç›´æ¥æ˜¾ç¤ºå¥ç‚¹å’Œæ–œæ ï¼Œ
è€Œä¸æ˜¯æ±‡ç¼–ç¨‹åºæ‰€éœ€çš„Unicodeæ›¿æ¢ã€‚&lt;/p&gt;

&lt;p&gt;å¤§å¤šæ•°æ‰‹å†™çš„ç¨‹åºé›†æ–‡ä»¶ä¸åŒ…å«ç¬¦å·åç§°ä¸­çš„å®Œæ•´ç¨‹åºåŒ…è·¯å¾„ï¼Œå› ä¸ºé“¾æ¥å™¨åœ¨ä»¥å¥ç‚¹å¼€å¤´çš„ä»»ä½•åç§°çš„å¼€å¤´æ’å…¥å½“å‰ç›®æ ‡æ–‡ä»¶çš„ç¨‹åºåŒ…è·¯å¾„ï¼šåœ¨math / randä¸­çš„ç¨‹åºé›†æºæ–‡ä»¶ä¸­ åŒ…çš„å®ç°ï¼ŒåŒ…çš„Intå‡½æ•°å¯ä»¥ç§°ä¸ºÂ·Intã€‚ æ­¤çº¦å®šé¿å…äº†åœ¨è‡ªå·±çš„æºä»£ç ä¸­å¯¹åŒ…çš„å¯¼å…¥è·¯å¾„è¿›è¡Œç¡¬ç¼–ç çš„éœ€è¦ï¼Œä»è€Œå¯ä»¥æ›´è½»æ¾åœ°å°†ä»£ç ä»ä¸€ä¸ªä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æŒ‡ä»¤&#34;&gt;æŒ‡ä»¤&lt;/h3&gt;

&lt;p&gt;æ±‡ç¼–ç¨‹åºä½¿ç”¨å„ç§æŒ‡ä»¤å°†æ–‡æœ¬å’Œæ•°æ®ç»‘å®šåˆ°ç¬¦å·åç§°ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„å®Œæ•´å‡½æ•°å®šä¹‰ã€‚ TEXTæŒ‡ä»¤å£°æ˜ç¬¦å·runtimeÂ·profileloopä»¥åŠåé¢çš„æŒ‡ä»¤å½¢æˆå‡½æ•°ä½“ã€‚ TEXTå—ä¸­çš„æœ€åä¸€æ¡æŒ‡ä»¤å¿…é¡»æ˜¯æŸç§è·³è½¬ï¼Œé€šå¸¸æ˜¯RETï¼ˆä¼ªï¼‰æŒ‡ä»¤ã€‚ ï¼ˆå¦‚æœä¸æ˜¯ï¼Œé“¾æ¥å™¨å°†é™„åŠ ä¸€ä¸ªè·³è½¬åˆ°è‡ªèº«çš„æŒ‡ä»¤; TEXTä¸­æ²¡æœ‰ä»»ä½•åæœã€‚ï¼‰After the symbol, the arguments are flags (see below) and the frame size, a constant (but see below):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;TEXT runtimeÂ·profileloop(SB),NOSPLIT,$8
    MOVQ    $runtimeÂ·profileloop1(SB), CX
    MOVQ    CX, 0(SP)
    CALL    runtimeÂ·externalthreadhandler(SB)
    RET&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¸§å¤§å°åè·Ÿå‚æ•°å¤§å°ï¼Œç”¨å‡å·åˆ†éš”ã€‚ ï¼ˆè¿™ä¸æ˜¯å‡æ³•ï¼Œåªæ˜¯ç‰¹æ®Šè¯­æ³•ã€‚ï¼‰å¸§å¤§å°&lt;code&gt;$ 24-8&lt;/code&gt;è¡¨ç¤ºè¯¥å‡½æ•°æœ‰ä¸€ä¸ª24å­—èŠ‚çš„å¸§ï¼Œå¹¶ä»¥8å­—èŠ‚çš„å‚æ•°è°ƒç”¨ï¼Œå®ƒä»¬å­˜åœ¨äºè°ƒç”¨è€…çš„å¸§ä¸­ã€‚ å¦‚æœæ²¡æœ‰ä¸º&lt;code&gt;TEXT&lt;/code&gt;æŒ‡å®š&lt;code&gt;NOSPLIT&lt;/code&gt;ï¼Œåˆ™å¿…é¡»æä¾›å‚æ•°å¤§å°ã€‚ å¯¹äºGoåŸå‹çš„æ±‡ç¼–å‡½æ•°ï¼Œgo vetå°†æ£€æŸ¥å‚æ•°å¤§å°æ˜¯å¦æ­£ç¡®ã€‚&lt;/p&gt;

&lt;p&gt;è¯·æ³¨æ„ï¼Œç¬¦å·åç§°ä½¿ç”¨ä¸­é—´ç‚¹æ¥åˆ†éš”ç»„ä»¶ï¼Œå¹¶ä¸ºå…¶æŒ‡å®šä¸static baseä¼ªå¯„å­˜å™¨SBçš„åç§»é‡ã€‚ This function would be called from Go source for package runtime using the simple name profileloop.&lt;/p&gt;

&lt;p&gt;å…¨å±€æ•°æ®ç¬¦å·ç”±ä¸€ç³»åˆ—åˆå§‹åŒ–DATAæŒ‡ä»¤å®šä¹‰ï¼Œåè·ŸGLOBLæŒ‡ä»¤ã€‚ æ¯ä¸ªDATAæŒ‡ä»¤åˆå§‹åŒ–ç›¸åº”å†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚ æœªæ˜ç¡®åˆå§‹åŒ–çš„å†…å­˜ä¸ºé›¶ã€‚ DATAæŒ‡ä»¤çš„ä¸€èˆ¬å½¢å¼æ˜¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;DATA    symbol+offset(SB)/width, value&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å®ƒä½¿ç”¨ç»™å®šå€¼åˆå§‹åŒ–ç»™å®šåç§»é‡å’Œå®½åº¦çš„ç¬¦å·å†…å­˜ã€‚ The DATA directives for a given symbol must be written with increasing offsets.ï¼ˆå¿…é¡»ä½¿ç”¨+åç§»é‡ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;code&gt;GLOBL&lt;/code&gt;æŒ‡ä»¤å£°æ˜ç¬¦å·æ˜¯å…¨å±€çš„ã€‚ å‚æ•°æ˜¯å¯é€‰æ ‡å¿—ï¼Œå¹¶ä¸”æ•°æ®çš„å¤§å°è¢«å£°æ˜ä¸ºå…¨å±€ï¼Œé™¤éDATAæŒ‡ä»¤å·²åˆå§‹åŒ–ï¼Œå¦åˆ™åˆå§‹å€¼å°†å…¨ä¸ºé›¶ã€‚ GLOBLæŒ‡ä»¤å¿…é¡»éµå¾ªä»»ä½•ç›¸åº”çš„DATAæŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;DATA divtab&amp;lt;&amp;gt;+0x00(SB)/4, $0xf4f8fcff
DATA divtab&amp;lt;&amp;gt;+0x04(SB)/4, $0xe6eaedf0
...
DATA divtab&amp;lt;&amp;gt;+0x3c(SB)/4, $0x81828384
GLOBL divtab&amp;lt;&amp;gt;(SB), RODATA, $64

GLOBL runtimeÂ·tlsoffset(SB), NOPTR, $4&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æŒ‡ä»¤å¯èƒ½æœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªï¼Œåˆ™ç¬¬ä¸€ä¸ªæ˜¯æ ‡å¿—çš„ä½æ©ç ï¼Œå¯ä»¥å†™ä¸ºæ•°å­—è¡¨è¾¾å¼ï¼Œæ·»åŠ æˆ–è€…ä¸€èµ·ç¼–è¾‘ï¼Œæˆ–è€…å¯ä»¥è±¡å¾æ€§åœ°è®¾ç½®ä»¥ä¾¿äººç±»æ›´å®¹æ˜“å¸æ”¶ã€‚ å®ƒä»¬åœ¨æ ‡å‡†&lt;code&gt;#include&lt;/code&gt;æ–‡ä»¶&lt;code&gt;textflag.h&lt;/code&gt;ä¸­å®šä¹‰çš„å€¼æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;NOPROF = 1&lt;br /&gt;
(For TEXT items.) Don&amp;rsquo;t profile the marked function. This flag is deprecated.ä¸è¦åˆ†ææ ‡è®°çš„åŠŸèƒ½ã€‚ æ­¤æ ‡å¿—å·²è¢«å¼ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;DUPOK = 2&lt;br /&gt;
It is legal to have multiple instances of this symbol in a single binary. The linker will choose one of the duplicates to use.åœ¨å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«æ­¤ç¬¦å·çš„å¤šä¸ªå®ä¾‹æ˜¯åˆæ³•çš„ã€‚ é“¾æ¥å™¨å°†é€‰æ‹©è¦ä½¿ç”¨çš„é‡å¤é¡¹ä¹‹ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;NOSPLIT = 4&lt;br /&gt;
(For TEXT items.) Don&amp;rsquo;t insert the preamble to check if the stack must be split. The frame for the routine, plus anything it calls, must fit in the spare space at the top of the stack segment. Used to protect routines such as the stack splitting code itself.ï¼ˆå¯¹äºTEXTé¡¹ç›®ï¼‰ä¸è¦æ’å…¥å‰å¯¼ç ä»¥æ£€æŸ¥æ˜¯å¦å¿…é¡»æ‹†åˆ†å †æ ˆã€‚ ä¾‹ç¨‹çš„æ¡†æ¶ä»¥åŠå®ƒè°ƒç”¨çš„ä»»ä½•å†…å®¹å¿…é¡»é€‚åˆå †æ ˆæ®µé¡¶éƒ¨çš„å¤‡ç”¨ç©ºé—´ã€‚ ç”¨äºä¿æŠ¤ä¾‹å¦‚å †æ ˆæ‹†åˆ†ä»£ç æœ¬èº«çš„ä¾‹ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;RODATA = 8&lt;br /&gt;
(For DATA and GLOBL items.) Put this data in a read-only section.å°†æ­¤æ•°æ®æ”¾åœ¨åªè¯»éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;NOPTR = 16&lt;br /&gt;
(For DATA and GLOBL items.) This data contains no pointers and therefore does not need to be scanned by the garbage collector.æ­¤æ•°æ®ä¸åŒ…å«æŒ‡é’ˆï¼Œå› æ­¤ä¸éœ€è¦ç”±åƒåœ¾æ”¶é›†å™¨æ‰«æã€‚&lt;/li&gt;
&lt;li&gt;WRAPPER = 32&lt;br /&gt;
(For TEXT items.) This is a wrapper function and should not count as disabling recover.è¿™æ˜¯ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œä¸åº”è¯¥ç®—ä½œç¦ç”¨æ¢å¤&lt;/li&gt;
&lt;li&gt;NEEDCTXT = 64&lt;br /&gt;
(For TEXT items.) This function is a closure so it uses its incoming context register.æ­¤å‡½æ•°æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œå› æ­¤å®ƒä½¿ç”¨å…¶ä¼ å…¥çš„ä¸Šä¸‹æ–‡å¯„å­˜å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;runtime-coordination&#34;&gt;Runtime Coordination&lt;/h3&gt;

&lt;p&gt;è¦ä½¿åƒåœ¾æ”¶é›†æ­£ç¡®è¿è¡Œï¼Œruntimeå¿…é¡»çŸ¥é“æ‰€æœ‰å…¨å±€æ•°æ®å’Œå¤§å¤šæ•°å †æ ˆå¸§ä¸­æŒ‡é’ˆçš„ä½ç½®ã€‚ Goç¼–è¯‘å™¨åœ¨ç¼–è¯‘Goæºæ–‡ä»¶æ—¶ä¼šå‘å‡ºæ­¤ä¿¡æ¯ï¼Œä½†æ±‡ç¼–ç¨‹åºå¿…é¡»æ˜ç¡®å®šä¹‰å®ƒã€‚&lt;/p&gt;

&lt;p&gt;æ ‡æœ‰NOPTRæ ‡å¿—çš„æ•°æ®ç¬¦å·ï¼ˆè§ä¸Šæ–‡ï¼‰è¢«è§†ä¸ºä¸åŒ…å«æŒ‡å‘runtimeåˆ†é…æ•°æ®çš„æŒ‡é’ˆã€‚ å¸¦æœ‰RODATAæ ‡å¿—çš„æ•°æ®ç¬¦å·åœ¨read-only memoryä¸­åˆ†é…ï¼Œå› æ­¤è¢«è§†ä¸ºéšå¼æ ‡è®°çš„NOPTRã€‚ æ€»å¤§å°å°äºæŒ‡é’ˆçš„æ•°æ®ç¬¦å·ä¹Ÿè¢«è§†ä¸ºéšå¼æ ‡è®°çš„NOPTRã€‚ æ— æ³•åœ¨æ±‡ç¼–æºæ–‡ä»¶ä¸­å®šä¹‰åŒ…å«æŒ‡é’ˆçš„ç¬¦å·; å¿…é¡»åœ¨Goæºæ–‡ä»¶ä¸­å®šä¹‰è¿™æ ·çš„ç¬¦å·ã€‚ å³ä½¿æ²¡æœ‰DATAå’ŒGLOBLæŒ‡ä»¤ï¼Œæ±‡ç¼–æºä»ç„¶å¯ä»¥æŒ‰åç§°å¼•ç”¨ç¬¦å·ã€‚ ä¸€èˆ¬çš„ç»éªŒæ³•åˆ™æ˜¯åœ¨Goä¸­å®šä¹‰æ‰€æœ‰éRODATAç¬¦å·è€Œä¸æ˜¯åœ¨ç¨‹åºé›†ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªå‡½æ•°è¿˜éœ€è¦æ³¨é‡ŠæŒ‡é’ˆçš„ä½ç½®ï¼Œåœ¨å…¶å‚æ•°ï¼Œç»“æœå’Œæœ¬åœ°å †æ ˆæ¡†æ¶ä¸­ç»™å‡ºå®æ—¶æŒ‡é’ˆçš„ä½ç½®ã€‚å¯¹äºæ²¡æœ‰æŒ‡é’ˆç»“æœä¸”æ²¡æœ‰æœ¬åœ°å †æ ˆå¸§æˆ–æ²¡æœ‰å‡½æ•°è°ƒç”¨çš„æ±‡ç¼–å‡½æ•°ï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯åœ¨åŒä¸€ä¸ªåŒ…ä¸­çš„Goæºæ–‡ä»¶ä¸­ä¸ºå‡½æ•°å®šä¹‰GoåŸå‹ã€‚ç¨‹åºé›†å‡½æ•°çš„åç§°ä¸èƒ½åŒ…å«ç¨‹åºåŒ…åç§°ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œç¨‹åºåŒ…syscallä¸­çš„å‡½æ•°Syscallåº”ä½¿ç”¨åç§°Â·Syscallè€Œä¸æ˜¯å…¶TEXTæŒ‡ä»¤ä¸­çš„ç­‰æ•ˆåç§°syscallÂ·Syscallï¼‰ã€‚å¯¹äºæ›´å¤æ‚çš„æƒ…å†µï¼Œéœ€è¦æ˜¾å¼æ³¨é‡Šã€‚è¿™äº›æ³¨é‡Šä½¿ç”¨æ ‡å‡†&lt;code&gt;#include&lt;/code&gt;æ–‡ä»¶&lt;code&gt;funcdata.h&lt;/code&gt;ä¸­å®šä¹‰çš„ä¼ªæŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœå‡½æ•°æ²¡æœ‰å‚æ•°ä¸”æ²¡æœ‰ç»“æœï¼Œåˆ™å¯ä»¥çœç•¥æŒ‡é’ˆä¿¡æ¯ã€‚è¿™ç”±TEXTæŒ‡ä»¤çš„&lt;code&gt;$ n-0&lt;/code&gt;çš„å‚æ•°å¤§å°æ³¨é‡Šè¡¨ç¤ºã€‚å¦åˆ™ï¼ŒæŒ‡é’ˆä¿¡æ¯å¿…é¡»ç”±Goæºæ–‡ä»¶ä¸­çš„å‡½æ•°çš„GoåŸå‹æä¾›ï¼Œå³ä½¿å¯¹äºæœªç›´æ¥ä»Goè°ƒç”¨çš„æ±‡ç¼–å‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ ï¼ˆåŸå‹ä¹Ÿä¼šè®©vetæ£€æŸ¥å‚æ•°å¼•ç”¨ã€‚ï¼‰åœ¨å‡½æ•°å¼€å§‹æ—¶ï¼Œå‡å®šå‚æ•°è¢«åˆå§‹åŒ–ä½†ç»“æœå‡å®šæœªåˆå§‹åŒ–ã€‚å¦‚æœç»“æœå°†åœ¨è°ƒç”¨æŒ‡ä»¤æœŸé—´ä¿å­˜å®æ—¶æŒ‡é’ˆï¼Œåˆ™è¯¥å‡½æ•°åº”é¦–å…ˆå°†ç»“æœå½’é›¶ï¼Œç„¶åæ‰§è¡Œä¼ªæŒ‡ä»¤&lt;code&gt;GO_RESULTS_INITIALIZED&lt;/code&gt;ã€‚æ­¤æŒ‡ä»¤è®°å½•ç»“æœç°åœ¨å·²åˆå§‹åŒ–ï¼Œåº”åœ¨å †æ ˆç§»åŠ¨å’Œåƒåœ¾å›æ”¶æœŸé—´è¿›è¡Œæ‰«æã€‚é€šå¸¸æ›´å®¹æ˜“å®‰æ’æ±‡ç¼–å‡½æ•°ä¸è¿”å›æŒ‡é’ˆæˆ–ä¸åŒ…å«è°ƒç”¨æŒ‡ä»¤;æ ‡å‡†åº“ä¸­æ²¡æœ‰æ±‡ç¼–å‡½æ•°ä½¿ç”¨&lt;code&gt;GO_RESULTS_INITIALIZED&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœå‡½æ•°æ²¡æœ‰æœ¬åœ°å †æ ˆå¸§ï¼Œåˆ™å¯ä»¥çœç•¥æŒ‡é’ˆä¿¡æ¯ã€‚è¿™ç”±TEXTæŒ‡ä»¤ä¸Šçš„&lt;code&gt;$ 0-n&lt;/code&gt;çš„æœ¬åœ°å¸§å¤§å°æ³¨é‡Šè¡¨ç¤ºã€‚å¦‚æœå‡½æ•°ä¸åŒ…å«è°ƒç”¨æŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥çœç•¥æŒ‡é’ˆä¿¡æ¯ã€‚å¦åˆ™ï¼Œæœ¬åœ°å †æ ˆå¸§ä¸èƒ½åŒ…å«æŒ‡é’ˆï¼Œå¹¶ä¸”ç¨‹åºé›†å¿…é¡»é€šè¿‡æ‰§è¡Œä¼ªæŒ‡ä»¤&lt;code&gt;NO_LOCAL_POINTERS&lt;/code&gt;æ¥ç¡®è®¤æ­¤äº‹å®ã€‚å› ä¸ºé€šè¿‡ç§»åŠ¨å †æ ˆæ¥å®ç°å †æ ˆå¤§å°è°ƒæ•´ï¼Œæ‰€ä»¥å †æ ˆæŒ‡é’ˆå¯èƒ½åœ¨ä»»ä½•å‡½æ•°è°ƒç”¨æœŸé—´å‘ç”Ÿå˜åŒ–ï¼šç”šè‡³æŒ‡å‘å †æ ˆæ•°æ®çš„æŒ‡é’ˆä¹Ÿä¸èƒ½ä¿å­˜åœ¨å±€éƒ¨å˜é‡ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ç¨‹åºé›†å‡½æ•°åº”å§‹ç»ˆç»™äºˆGoåŸå‹ï¼Œæ—¢å¯ä»¥ä¸ºå‚æ•°å’Œç»“æœæä¾›æŒ‡é’ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è®©go vetæ£€æŸ¥ç”¨äºè®¿é—®å®ƒä»¬çš„åç§»é‡æ˜¯å¦æ­£ç¡®ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://golang.org/doc/asm&#34;&gt;https://golang.org/doc/asm&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://github.com/yangyuqian/technical-articles/blob/master/asm/golang-plan9-assembly-cn.md&#34;&gt;https://github.com/yangyuqian/technical-articles/blob/master/asm/golang-plan9-assembly-cn.md&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://lrita.github.io/2017/12/12/golang-asm/&#34;&gt;https://lrita.github.io/2017/12/12/golang-asm/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://blog.csdn.net/bravezhe/article/details/80256035&#34;&gt;https://blog.csdn.net/bravezhe/article/details/80256035&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://www.10tiao.com/html/528/201702/2653369847/1.html&#34;&gt;http://www.10tiao.com/html/528/201702/2653369847/1.html&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>golang slice å‰–æ</title>
      <link>https://jayhong.github.io/post/20190320-golang-slice-%E5%89%96%E6%9E%90/</link>
      <pubDate>Wed, 20 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190320-golang-slice-%E5%89%96%E6%9E%90/</guid>
      
        <description>

&lt;h2 id=&#34;slice-ä»‹ç»&#34;&gt;slice ä»‹ç»&lt;/h2&gt;

&lt;p&gt;golangä¸­æœ‰ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹sliceï¼Œ sliceæ˜¯å¯ä»¥åŠ¨æ€æ‰©å®¹çš„æ•°ç»„ï¼Œsliceæœ‰æ—¶å€™æˆ‘ä¼šé”™è¯¯çš„æŠŠå®ƒè¯´æˆæ˜¯æ•°ç»„ï¼Œåœ¨golangä¸­sliceå’Œæ•°ç»„è¿˜æ˜¯æœ‰å¾ˆå¤§çš„åŒºåˆ«çš„ã€‚
åœ¨çœ‹sliceçš„æºç ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹ä¸€ä¸‹ä¸¤æ®µä»£ç ï¼Œçœ‹ä¸‹ä¼šè¾“å‡ºä»€ä¹ˆå†…å®¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å†çœ‹å¦å¤–ä¸€æ®µä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ä»£ç åŸºäºgo 1.11&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;slice-æºç &#34;&gt;slice æºç &lt;/h2&gt;

&lt;p&gt;sliceä»£ç åœ¨ &lt;code&gt;runtime/slice.go&lt;/code&gt;ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;type slice struct {
    array unsafe.Pointer
    len   int
    cap   int
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;åœ¨golang ä¸­sliceä½¿ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œä¸€ä¸ªé•¿åº¦lenå’Œä¸€ä¸ªå®¹é‡capæ„æˆçš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;makeslice&#34;&gt;makeslice&lt;/h3&gt;

&lt;p&gt;makeslice æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œsliceå…ƒç´ çš„ç±»å‹ï¼Œé•¿åº¦ä»¥åŠå®¹é‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// MulUintptr returns a * b and whether the multiplication overflowed.
// On supported platforms this is an intrinsic lowered by the compiler.
// MulUintptr è¿”å›a*bçš„å€¼ï¼Œæ˜¯å¦æº¢å‡ºã€‚
func MulUintptr(a, b uintptr) (uintptr, bool) {
    // a|b &amp;lt; 1&amp;lt;&amp;lt;(4*sys.PtrSize) why
    if a|b &amp;lt; 1&amp;lt;&amp;lt;(4*sys.PtrSize) || a == 0 {
        return a * b, false
    }
    // æœºå™¨å…è®¸çš„æœ€å¤§å®¹é‡é™¤ä»¥ç±»å‹çš„å¤§å°
    overflow := b &amp;gt; MaxUintptr/a
    return a * b, overflow
}

func makeslice(et *_type, len, cap int) unsafe.Pointer {
    mem, overflow := math.MulUintptr(et.size, uintptr(cap))
    if overflow || mem &amp;gt; maxAlloc || len &amp;lt; 0 || len &amp;gt; cap {
        // NOTE: Produce a &amp;#39;len out of range&amp;#39; error instead of a
        // &amp;#39;cap out of range&amp;#39; error when someone does make([]T, bignumber).
        // &amp;#39;cap out of range&amp;#39; is true too, but since the cap is only being
        // supplied implicitly, saying len is clearer.
        // See golang.org/issue/4085.
        mem, overflow := math.MulUintptr(et.size, uintptr(len))
        if overflow || mem &amp;gt; maxAlloc || len &amp;lt; 0 {
            panicmakeslicelen()
        }
        panicmakeslicecap()
    }

    //åˆ†é…å†…å­˜
    return mallocgc(mem, et, true)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å¦å¤–è¿˜æœ‰ä¸€ä¸ªmakeslice64 åªæ˜¯å¤šäº†å°†int64 è½¬ä¸ºintçš„æ­¥éª¤&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è®¿é—®sliceä¸­çš„æ•°æ®æ˜¯é€šè¿‡sliceæ¥æ§åˆ¶èŒƒå›´çš„ã€‚ä¸å…è®¸è¶Šç•Œè®¿é—®&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;growslice&#34;&gt;growslice&lt;/h3&gt;

&lt;p&gt;growsliceéœ€è¦çŸ¥é“çš„å°±æ˜¯ä»–çš„æ‰©å®¹ç­–ç•¥ï¼Œä»¥åŠet.kind ä¸ºéæŒ‡é’ˆçš„æ—¶å€™çš„å¤„ç†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;130
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;131
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// growslice handles slice growth during append.
// It is passed the slice element type, the old slice, and the desired new minimum capacity,
// and it returns a new slice with at least that capacity, with the old data
// copied into it.
// The new slice&amp;#39;s length is set to the old slice&amp;#39;s length,
// NOT to the new requested capacity.
// This is for codegen convenience. The old slice&amp;#39;s length is used immediately
// to calculate where to write new values during an append.
// TODO: When the old backend is gone, reconsider this decision.
// The SSA backend might prefer the new length or to return only ptr/cap and save stack space.
func growslice(et *_type, old slice, cap int) slice {
    if raceenabled {
        callerpc := getcallerpc()
        racereadrangepc(old.array, uintptr(old.len*int(et.size)), callerpc, funcPC(growslice))
    }
    if msanenabled {
        msanread(old.array, uintptr(old.len*int(et.size)))
    }
    // æœŸæœ›çš„å®¹é‡å°äºæ—§sliceçš„å®¹é‡
    if cap &amp;lt; old.cap {
        panic(errorString(&amp;#34;growslice: cap out of range&amp;#34;))
    }

    if et.size == 0 {
        // append should not create a slice with nil pointer but non-zero len.
        // We assume that append doesn&amp;#39;t need to preserve old.array in this case.
        //appendä¸åº”è¯¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰nilæŒ‡é’ˆä½†éé›¶lençš„åˆ‡ç‰‡ã€‚æˆ‘ä»¬å‡è®¾appendåœ¨è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦ä¿ç•™old.arrayã€‚
        return slice{unsafe.Pointer(&amp;amp;zerobase), old.len, cap}
    }

    // æ–°slice capçš„ç¡®å®šæ–¹æ³•ï¼Œå½“å°äº1024 çš„æ—¶å€™ç›´æ¥doubleï¼Œå¤§äº1024 æ¯æ¬¡å¢åŠ 1/4
    newcap := old.cap
    doublecap := newcap + newcap
    if cap &amp;gt; doublecap {
        newcap = cap
    } else {
        if old.len &amp;lt; 1024 {
            newcap = doublecap
        } else {
            // Check 0 &amp;lt; newcap to detect overflow
            // and prevent an infinite loop.
            for 0 &amp;lt; newcap &amp;amp;&amp;amp; newcap &amp;lt; cap {
                newcap += newcap / 4
            }
            // Set newcap to the requested cap when
            // the newcap calculation overflowed.
            if newcap &amp;lt;= 0 {
                newcap = cap
            }
        }
    }

    // è®¡ç®—æ–°åˆ‡ç‰‡çš„å¤§å°å®¹é‡ æ˜¯å¦æº¢å‡º
    var overflow bool
    var lenmem, newlenmem, capmem uintptr
    // Specialize for common values of et.size.
    // For 1 we don&amp;#39;t need any division/multiplication.
    // For sys.PtrSize, compiler will optimize division/multiplication into a shift by a constant.
    // For powers of 2, use a variable shift.
    switch {
    case et.size == 1:
        lenmem = uintptr(old.len)
        newlenmem = uintptr(cap)
        capmem = roundupsize(uintptr(newcap))
        overflow = uintptr(newcap) &amp;gt; maxAlloc
        newcap = int(capmem)
    case et.size == sys.PtrSize:
        lenmem = uintptr(old.len) * sys.PtrSize
        newlenmem = uintptr(cap) * sys.PtrSize
        capmem = roundupsize(uintptr(newcap) * sys.PtrSize)
        overflow = uintptr(newcap) &amp;gt; maxAlloc/sys.PtrSize
        newcap = int(capmem / sys.PtrSize)
    case isPowerOfTwo(et.size):
        var shift uintptr
        if sys.PtrSize == 8 {
            // Mask shift for better code generation.
            shift = uintptr(sys.Ctz64(uint64(et.size))) &amp;amp; 63
        } else {
            shift = uintptr(sys.Ctz32(uint32(et.size))) &amp;amp; 31
        }
        lenmem = uintptr(old.len) &amp;lt;&amp;lt; shift
        newlenmem = uintptr(cap) &amp;lt;&amp;lt; shift
        capmem = roundupsize(uintptr(newcap) &amp;lt;&amp;lt; shift)
        overflow = uintptr(newcap) &amp;gt; (maxAlloc &amp;gt;&amp;gt; shift)
        newcap = int(capmem &amp;gt;&amp;gt; shift)
    default:
        lenmem = uintptr(old.len) * et.size
        newlenmem = uintptr(cap) * et.size
        capmem, overflow = math.MulUintptr(et.size, uintptr(newcap))
        capmem = roundupsize(capmem)
        newcap = int(capmem / et.size)
    }

    // The check of overflow in addition to capmem &amp;gt; maxAlloc is needed
    // to prevent an overflow which can be used to trigger a segfault
    // on 32bit architectures with this example program:
    //
    // type T [1&amp;lt;&amp;lt;27 + 1]int64
    //
    // var d T
    // var s []T
    //
    // func main() {
    //   s = append(s, d, d, d, d)
    //   print(len(s), &amp;#34;\n&amp;#34;)
    // }
    if overflow || capmem &amp;gt; maxAlloc {
        panic(errorString(&amp;#34;growslice: cap out of range&amp;#34;))
    }

    var p unsafe.Pointer
    // å…ƒç´ ç±»å‹ä¸ºéæŒ‡é’ˆçš„æ—¶å€™å¯ä»¥åªæ¸…ç©ºcapåˆ°newlenmenä¹‹é—´çš„å€¼
    if et.kind&amp;amp;kindNoPointers != 0 {
        p = mallocgc(capmem, nil, false)
        // The append() that calls growslice is going to overwrite from old.len to cap (which will be the new length).
        // Only clear the part that will not be overwritten.
        memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)
    } else {
        // Note: can&amp;#39;t use rawmem (which avoids zeroing of memory), because then GC can scan uninitialized memory.
        p = mallocgc(capmem, et, true)
        // åˆ¤æ–­å†™å±éšœæ˜¯å¦å¼€å¯äº†ï¼Œé€šè¿‡è¿­ä»£è®²æ—§æ•°ç»„ä¸­çš„æŒ‡é’ˆå±è”½æ‰ï¼Œä¹‹åå°±ä¸ä¼šè¢«gcæ‰«æåˆ°
        if writeBarrier.enabled {
            // Only shade the pointers in old.array since we know the destination slice p
            // only contains nil pointers because it has been cleared during alloc.
            bulkBarrierPreWriteSrcOnly(uintptr(p), uintptr(old.array), lenmem)
        }
    }
    memmove(p, old.array, lenmem)

    return slice{p, old.len, newcap}
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;slice-copy&#34;&gt;slice copy&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func slicecopy(to, fm slice, width uintptr) int {
    if fm.len == 0 || to.len == 0 {
        return 0
    }

    n := fm.len
    if to.len &amp;lt; n {
        n = to.len
    }

    if width == 0 {
        return n
    }

    if raceenabled {
        callerpc := getcallerpc()
        pc := funcPC(slicecopy)
        racewriterangepc(to.array, uintptr(n*int(width)), callerpc, pc)
        racereadrangepc(fm.array, uintptr(n*int(width)), callerpc, pc)
    }
    if msanenabled {
        msanwrite(to.array, uintptr(n*int(width)))
        msanread(fm.array, uintptr(n*int(width)))
    }

    size := uintptr(n) * width
    // å¦‚æœsizeä¸º1 ç›´æ¥å°†åº•å±‚arrayçš„å€¼å¤åˆ¶è¿‡å»ï¼Œå¦‚æœå¤§äº1 è°ƒç”¨memmove è¿›è¡Œå¤åˆ¶
    if size == 1 { // common case worth about 2x to do here
        // TODO: is this still worth it with new memmove impl?
        *(*byte)(to.array) = *(*byte)(fm.array) // known to be a byte pointer
    } else {
        memmove(to.array, fm.array, size)
    }
    return n
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;sliceä¸­çš„ä¸€äº›å‘&#34;&gt;sliceä¸­çš„ä¸€äº›å‘&lt;/h2&gt;

&lt;p&gt;åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨sliceå¦‚æœä¸æ³¨æ„å¾ˆå®¹æ˜“å…¥å‘ã€‚ä¸‹æ¥åˆ—ä¸¾ä¸€ä¸‹æˆ‘çœ‹åˆ°ä»¥åŠé‡åˆ°çš„ä¸€äº›å‘&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;sliceæ˜¯å¦æ‰©å®¹æ˜¯æœ‰lenå’Œcapå†³å®šçš„ï¼Œsliceä¸‹æ ‡æ“ä½œä¸èƒ½è¶…è¿‡lenã€‚&lt;/li&gt;
&lt;li&gt;å°†ä¸€ä¸ªsliceèµ‹å€¼ç»™å…¶ä»–çš„sliceçš„æ—¶å€™ï¼Œä½œä¸ºå‡½æ•°å…¥å‚çš„æ—¶å€™ï¼Œåº•å±‚æ•°ç»„å…±äº«çš„æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯å„ä¸ªsliceæœ‰å„è‡ªlenå’Œcap&lt;/li&gt;
&lt;li&gt;sliceåœ¨&lt;code&gt;for v, i range slice&lt;/code&gt;æ“ä½œçš„æ—¶å€™, è¦æ³¨æ„væ˜¯åŒä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œä½¿ç”¨vçš„æ—¶å€™è¦æ³¨æ„&lt;/li&gt;
&lt;li&gt;æ‰©å®¹çš„ç­–ç•¥&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹é¢çœ‹çœ‹å¼€å¤´ä¸¤æ®µç¨‹åºçš„è¾“å‡º&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¨‹åº1&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;[5 7 9] [5 7 9 12] [5 7 9 12]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;append æ“ä½œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„sliceï¼Œä¼šæœ‰æ–°çš„lenï¼Œå¦‚æœappendè§¦å‘äº†æ‰©å®¹çš„è¯ä¹Ÿä¼šæ›´æ–°capã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç¬¬7è¡Œï¼Œç¬¬8è¡Œçš„appendéƒ½è§¦å‘äº†æ‰©å®¹æ“ä½œï¼Œå¹¶ä¸”å°†äº§ç”Ÿçš„æ–°çš„sliceèµ‹ç»™äº†s
æ‰€ä»¥så˜æˆäº†ä¸€ä¸ªlenä¸º3 capä¸º4çš„åˆ‡ç‰‡ã€‚ç¬¬9è¡Œ &lt;code&gt;x:=append(sï¼Œ11)&lt;/code&gt; ä¼šå°†såº•å±‚æ•°ç»„çš„ç¬¬å››ä¸ªå…ƒç´ è®¾ç½®ä¸º11ï¼Œæ‰§è¡Œä¹‹åå¹¶ä¸ä¼šæ›´æ–°sçš„lenå’Œcapã€‚ &lt;code&gt;y := append(s, 12)&lt;/code&gt;å°†ç¬¬å››ä¸ªå…ƒç´ è®¾ç½®ä¸º12ã€‚
æ‰€ä»¥å°†11è¦†ç›–æ‰äº†&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¨‹åº2&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;[[1 0 0 0] [1 0 0 0] [1 0 0 0] [1 0 0 0]]
[1 0 0 0 6]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¿™æ®µä»£ç ä¸ä¸Šé¢é‚£ä¸€æ®µçš„åŸå› ç±»ä¼¼ã€‚appendæ“ä½œäº§ç”Ÿçš„æ–°sliceå¹¶æ²¡æœ‰èµ‹å€¼ç»™åŸæ¥çš„sliceï¼Œè€Œæ˜¯èµ‹å€¼ç»™ä¸€ä¸ªæ–°çš„sliceã€‚ä½†æ˜¯å› ä¸ºæ—§sliceå¹¶æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥sä¿æŒåŸæ¥çš„æ ·å­&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://halfrost.com/go_slice/&#34;&gt;https://halfrost.com/go_slice/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://jiajunhuang.com/articles/2017_07_18-golang_slice.md.html&#34;&gt;https://jiajunhuang.com/articles/2017_07_18-golang_slice.md.html&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://jsharkc.github.io/2017/07/10/Slice%E6%9C%BA%E5%88%B6/&#34;&gt;https://jsharkc.github.io/2017/07/10/Slice%E6%9C%BA%E5%88%B6/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://github.com/EDDYCJY/blog/blob/master/golang/pkg/2018-12-11-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Go-Slice.md&#34;&gt;https://github.com/EDDYCJY/blog/blob/master/golang/pkg/2018-12-11-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Go-Slice.md&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>golang map å‰–æ</title>
      <link>https://jayhong.github.io/post/20190319-golang-map-%E5%89%96%E6%9E%90/</link>
      <pubDate>Mon, 18 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190319-golang-map-%E5%89%96%E6%9E%90/</guid>
      
        <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;mapåœ¨å·¥ä½œä¸­ç”¨çš„è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œå¯ä»¥é€šè¿‡å­¦ä¹ mapçš„æºç å®ç°æ¥é¿å…å¾ˆå¤šçš„å‘ã€‚ä»¥åŠå®ç°åŸç†ã€‚
map ä¸»è¦éœ€è¦æŒæ¡çš„å°±æ˜¯åˆå§‹åŒ–makeã€æ’å…¥ã€æŸ¥æ‰¾ã€æ‰©å®¹ã€rangeçš„æºç å®ç°ã€‚mapä¸»è¦è¦æ³¨æ„çš„åœ°æ–¹
å¦‚ä½•å¤„ç†hashå†²çªï¼Œmapæ‰©å®¹ç›¸å…³çš„é—®é¢˜&lt;/p&gt;

&lt;h2 id=&#34;åˆå§‹åŒ–-make-map-int-int&#34;&gt;åˆå§‹åŒ–&lt;code&gt;make(map[int]int)&lt;/code&gt;&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;1ã€åˆ¤æ–­ç±»å‹çš„å¤§å°ä¸sizeofçš„å¤§å°æ˜¯å¦ä¸€è‡´ï¼ˆwhyï¼‰&lt;/li&gt;
&lt;li&gt;2ã€åˆ¤æ–­keyå’Œvalueçš„å¤§å°ä»¥åŠæ ¹æ®hintç¡®å®šBçš„å¤§å°&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;3ã€å¦‚æœhintæ˜¯ä¸ä¸º0ï¼Œä¼šåˆ†é…ä¸€ä¸ªbucket arrayæ•°ç»„ï¼Œå¦‚æœä¸º0ï¼Œæ˜¯ä½¿ç”¨lazyinitçš„æ–¹å¼åœ¨èµ‹å€¼çš„æ—¶å€™æ‰è¿›è¡Œåˆå§‹åŒ–&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// makemap implements a Go map creation make(map[k]v, hint)
// If the compiler has determined that the map or the first bucket
// can be created on the stack, h and/or bucket may be non-nil.
// If h != nil, the map can be created directly in h.
// If bucket != nil, bucket can be used as the first bucket.
func makemap(t *maptype, hint int64, h *hmap, bucket unsafe.Pointer) *hmap {
    if sz := unsafe.Sizeof(hmap{}); sz &amp;gt; 48 || sz != t.hmap.size {
        println(&amp;#34;runtime: sizeof(hmap) =&amp;#34;, sz, &amp;#34;, t.hmap.size =&amp;#34;, t.hmap.size)
        throw(&amp;#34;bad hmap size&amp;#34;)
    }

    if hint &amp;lt; 0 || hint &amp;gt; int64(maxSliceCap(t.bucket.size)) {
        hint = 0
    }

    if !ismapkey(t.key) {
        throw(&amp;#34;runtime.makemap: unsupported map key type&amp;#34;)
    }

    // check compiler&amp;#39;s and reflect&amp;#39;s math
    if t.key.size &amp;gt; maxKeySize &amp;amp;&amp;amp; (!t.indirectkey || t.keysize != uint8(sys.PtrSize)) ||
        t.key.size &amp;lt;= maxKeySize &amp;amp;&amp;amp; (t.indirectkey || t.keysize != uint8(t.key.size)) {
        throw(&amp;#34;key size wrong&amp;#34;)
    }
    if t.elem.size &amp;gt; maxValueSize &amp;amp;&amp;amp; (!t.indirectvalue || t.valuesize != uint8(sys.PtrSize)) ||
        t.elem.size &amp;lt;= maxValueSize &amp;amp;&amp;amp; (t.indirectvalue || t.valuesize != uint8(t.elem.size)) {
        throw(&amp;#34;value size wrong&amp;#34;)
    }

    // invariants we depend on. We should probably check these at compile time
    // somewhere, but for now we&amp;#39;ll do it here.
    if t.key.align &amp;gt; bucketCnt {
        throw(&amp;#34;key align too big&amp;#34;)
    }
    if t.elem.align &amp;gt; bucketCnt {
        throw(&amp;#34;value align too big&amp;#34;)
    }
    if t.key.size%uintptr(t.key.align) != 0 {
        throw(&amp;#34;key size not a multiple of key align&amp;#34;)
    }
    if t.elem.size%uintptr(t.elem.align) != 0 {
        throw(&amp;#34;value size not a multiple of value align&amp;#34;)
    }
    if bucketCnt &amp;lt; 8 {
        throw(&amp;#34;bucketsize too small for proper alignment&amp;#34;)
    }
    if dataOffset%uintptr(t.key.align) != 0 {
        throw(&amp;#34;need padding in bucket (key)&amp;#34;)
    }
    if dataOffset%uintptr(t.elem.align) != 0 {
        throw(&amp;#34;need padding in bucket (value)&amp;#34;)
    }

    // find size parameter which will hold the requested # of elements
    B := uint8(0)
    for ; overLoadFactor(hint, B); B++ {
    }

    // allocate initial hash table
    // if B == 0, the buckets field is allocated lazily later (in mapassign)
    // If hint is large zeroing this memory could take a while.
    buckets := bucket
    var extra *mapextra
    if B != 0 {
        var nextOverflow *bmap
        buckets, nextOverflow = makeBucketArray(t, B)
        if nextOverflow != nil {
            extra = new(mapextra)
            extra.nextOverflow = nextOverflow
        }
    }

    // initialize Hmap
    if h == nil {
        h = (*hmap)(newobject(t.hmap))
    }
    h.count = 0
    h.B = B
    h.extra = extra
    h.flags = 0
    h.hash0 = fastrand()
    h.buckets = buckets
    h.oldbuckets = nil
    h.nevacuate = 0
    h.noverflow = 0

    return h
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;å…ƒç´ è®¿é—®-mapassess&#34;&gt;å…ƒç´ è®¿é—®&lt;code&gt;mapassess&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;å®ç°ä¸Šæœ‰ mapaccess1ï¼Œmapaccess2ï¼ŒmapaccessK å‡ ä¸ªæ–¹æ³•ï¼Œä½†å‡ ä¸ªæ–¹æ³•éƒ½å·®ä¸å¤šï¼Œåªå·®åˆ«åœ¨è¿”å›å†…å®¹ä¸Šã€‚mapaccess1 å’Œ mapaccess2 åŒæ—¶æœ‰ 32 ä½ã€64 ä½å’Œ string ç±»å‹çš„å˜ç§:&lt;/p&gt;

&lt;p&gt;mapaccess1_fast32, mapaccess1_fast64, mapaccess1_faststr&lt;br /&gt;
mapaccess2_fast32, mapaccess2_fast64, mapaccess2_faststr&lt;br /&gt;
å…·ä½“ç”¨å“ªä¸€ä¸ªå˜ç§å‡½æ•°æ˜¯ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé€‰æ‹©çš„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func mapaccess2(t *maptype, h *hmap, key unsafe.Pointer) (unsafe.Pointer, bool) {
    if raceenabled &amp;amp;&amp;amp; h != nil {
        callerpc := getcallerpc(unsafe.Pointer(&amp;amp;t))
        pc := funcPC(mapaccess2)
        racereadpc(unsafe.Pointer(h), callerpc, pc)
        raceReadObjectPC(t.key, key, callerpc, pc)
    }
    if msanenabled &amp;amp;&amp;amp; h != nil {
        msanread(key, t.key.size)
    }
    if h == nil || h.count == 0 {
        return unsafe.Pointer(&amp;amp;zeroVal[0]), false
    }
    //map ä¸å…è®¸å¹¶å‘è¯»å†™
    if h.flags&amp;amp;hashWriting != 0 {
        throw(&amp;#34;concurrent map read and map write&amp;#34;)
    }
    alg := t.key.alg
    hash := alg.hash(key, uintptr(h.hash0))
    //ä½¿ç”¨hashå€¼çš„ä½ä½å»ç¡®å®šbucketçš„ä½ç½®
    m := uintptr(1)&amp;lt;&amp;lt;h.B - 1
    b := (*bmap)(unsafe.Pointer(uintptr(h.buckets) + (hash&amp;amp;m)*uintptr(t.bucketsize)))
    //å¦‚æœæ­£åœ¨mapæ‰©å®¹ä¸­ï¼Œåœ¨oldbucketä¸­è¯»å–æ•°æ®
    if c := h.oldbuckets; c != nil {
        if !h.sameSizeGrow() {
            // There used to be half as many buckets; mask down one more power of two.
            m &amp;gt;&amp;gt;= 1
        }
        oldb := (*bmap)(unsafe.Pointer(uintptr(c) + (hash&amp;amp;m)*uintptr(t.bucketsize)))
        if !evacuated(oldb) {
            b = oldb
        }
    }
    top := uint8(hash &amp;gt;&amp;gt; (sys.PtrSize*8 - 8))
    if top &amp;lt; minTopHash {
        top += minTopHash
    }
    //éå†bucketä¸­çš„æ•°æ® å…ˆæ‹¿topä½ä¸tophash è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åå†åˆ¤æ–­keyå€¼ï¼Œæé«˜åˆ¤æ–­é€Ÿåº¦
    //bucketä¸­å¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°æ•°æ®ï¼Œå†ä»overflowä¸­æŸ¥æ‰¾ï¼Œå¦‚æœoverflowä¸­ä¹Ÿæ²¡æœ‰è¯´æ˜æ²¡æœ‰æ•°æ®
    for {
        for i := uintptr(0); i &amp;lt; bucketCnt; i++ {
            if b.tophash[i] != top {
                continue
            }
            k := add(unsafe.Pointer(b), dataOffset+i*uintptr(t.keysize))
            if t.indirectkey {
                k = *((*unsafe.Pointer)(k))
            }
            if alg.equal(key, k) {
                v := add(unsafe.Pointer(b), dataOffset+bucketCnt*uintptr(t.keysize)+i*uintptr(t.valuesize))
                if t.indirectvalue {
                    v = *((*unsafe.Pointer)(v))
                }
                return v, true
            }
        }
        b = b.overflow(t)
        if b == nil {
            return unsafe.Pointer(&amp;amp;zeroVal[0]), false
        }
    }
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;å…ƒç´ èµ‹å€¼&#34;&gt;å…ƒç´ èµ‹å€¼&lt;/h2&gt;

&lt;p&gt;å…ˆæ‰¾åˆ°keyå¯¹åº”çš„bucket ç„¶åèµ‹å€¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// Like mapaccess, but allocates a slot for the key if it is not present in the map.
func mapassign(t *maptype, h *hmap, key unsafe.Pointer) unsafe.Pointer {
    if h == nil {
        panic(plainError(&amp;#34;assignment to entry in nil map&amp;#34;))
    }
    if raceenabled {
        callerpc := getcallerpc(unsafe.Pointer(&amp;amp;t))
        pc := funcPC(mapassign)
        racewritepc(unsafe.Pointer(h), callerpc, pc)
        raceReadObjectPC(t.key, key, callerpc, pc)
    }
    if msanenabled {
        msanread(key, t.key.size)
    }
    // map ä¸å…è®¸å¹¶å‘å†™
    if h.flags&amp;amp;hashWriting != 0 {
        throw(&amp;#34;concurrent map writes&amp;#34;)
    }
    alg := t.key.alg
    hash := alg.hash(key, uintptr(h.hash0))

    // Set hashWriting after calling alg.hash, since alg.hash may panic,
    // in which case we have not actually done a write.
    // è®¾ç½®ä¸ºå†™çŠ¶æ€
    h.flags |= hashWriting

    // å¦‚æœbucketæ˜¯nilçš„è¯ï¼Œç”³è¯·ç©ºé—´ç»™buckets
    if h.buckets == nil {
        h.buckets = newarray(t.bucket, 1)
    }

again:
    // è®¡ç®—hashå€¼ é€šè¿‡ä½ä½æ¥ç¡®å®šbmapçš„ä½ç½®
    bucket := hash &amp;amp; (uintptr(1)&amp;lt;&amp;lt;h.B - 1)
    if h.growing() {
        growWork(t, h, bucket)
    }
    b := (*bmap)(unsafe.Pointer(uintptr(h.buckets) + bucket*uintptr(t.bucketsize)))
    // è®¡ç®—å‡ºtopä¹‹åç”¨äºç¡®å®škeyåœ¨bucketä¸­çš„ä½ç½®
    top := uint8(hash &amp;gt;&amp;gt; (sys.PtrSize*8 - 8))
    if top &amp;lt; minTopHash {
        top += minTopHash
    }

    // for å¾ªç¯ä¸­çš„é€»è¾‘ä¸»è¦æ˜¯ä¸ºäº†ç¡®å®šæ’å…¥çš„ä½ç½®ä»¥åŠå€¼
    var inserti *uint8
    var insertk unsafe.Pointer
    var val unsafe.Pointer
    for {
        for i := uintptr(0); i &amp;lt; bucketCnt; i++ {
            // bucketæ•°ç»„ä¸­çš„æ•°æ®å¯èƒ½è¢«åˆ é™¤è¿‡ï¼Œæœ‰é™å°†å€¼æ’å…¥åˆ°è¿™äº›è¢«åˆ é™¤çš„ç©ºé—´
            if b.tophash[i] != top {
                if b.tophash[i] == empty &amp;amp;&amp;amp; inserti == nil {
                    inserti = &amp;amp;b.tophash[i]
                    insertk = add(unsafe.Pointer(b), dataOffset+i*uintptr(t.keysize))
                    val = add(unsafe.Pointer(b), dataOffset+bucketCnt*uintptr(t.keysize)+i*uintptr(t.valuesize))
                }
                continue
            }
            // å¦‚æœæ‰¾åˆ°key é‚£ä¹ˆç›´æ¥æ›´æ–°å€¼
            k := add(unsafe.Pointer(b), dataOffset+i*uintptr(t.keysize))
            if t.indirectkey {
                k = *((*unsafe.Pointer)(k))
            }
            if !alg.equal(key, k) {
                continue
            }
            // already have a mapping for key. Update it.
            if t.needkeyupdate {
                typedmemmove(t.key, k, key)
            }
            val = add(unsafe.Pointer(b), dataOffset+bucketCnt*uintptr(t.keysize)+i*uintptr(t.valuesize))
            goto done
        }
        // æ»¡äº† éœ€è¦æ’å…¥åˆ°overflow
        ovf := b.overflow(t)
        if ovf == nil {
            break
        }
        b = ovf
    }

    // Did not find mapping for key. Allocate new cell &amp;amp; add entry.

    // If we hit the max load factor or we have too many overflow buckets,
    // and we&amp;#39;re not already in the middle of growing, start growing.
    // åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ æ‰©å®¹çš„æ¡ä»¶ä¸€ä¸ªæ˜¯count &amp;gt; loadfactor * (1 &amp;lt;&amp;lt; B) æˆ–è€…overflowå¤ªå¤š 
    if !h.growing() &amp;amp;&amp;amp; (overLoadFactor(int64(h.count), h.B) || tooManyOverflowBuckets(h.noverflow, h.B)) {
        hashGrow(t, h)
        goto again // Growing the table invalidates everything, so try again
    }

    if inserti == nil {
        // all current buckets are full, allocate a new one.
        newb := h.newoverflow(t, b)
        inserti = &amp;amp;newb.tophash[0]
        insertk = add(unsafe.Pointer(newb), dataOffset)
        val = add(insertk, bucketCnt*uintptr(t.keysize))
    }

    // store new key/value at insert position
    if t.indirectkey {
        kmem := newobject(t.key)
        *(*unsafe.Pointer)(insertk) = kmem
        insertk = kmem
    }
    if t.indirectvalue {
        vmem := newobject(t.elem)
        *(*unsafe.Pointer)(val) = vmem
    }
    // æ‰§è¡Œèµ‹å€¼æ“ä½œ
    typedmemmove(t.key, insertk, key)
    *inserti = top
    h.count++

done:
    if h.flags&amp;amp;hashWriting == 0 {
        throw(&amp;#34;concurrent map writes&amp;#34;)
    }
    h.flags &amp;amp;^= hashWriting
    if t.indirectvalue {
        val = *((*unsafe.Pointer)(val))
    }
    return val
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;åˆ é™¤æ“ä½œ&#34;&gt;åˆ é™¤æ“ä½œ&lt;/h2&gt;

&lt;p&gt;mapçš„åˆ é™¤æ“ä½œä¸èµ‹å€¼æœ‰ç‚¹ç±»ä¼¼ï¼Œåªä¸è¿‡åˆ é™¤æ“ä½œä¸ä¼šå¼•èµ·æ‰©å®¹,
åˆ é™¤æ“ä½œçš„å¤„ç†è¿‡ç¨‹å…¶å®å°±æ˜¯æ‰¾å¯¹åº”çš„æ¡¶ï¼Œåˆ é™¤å¯¹åº”çš„å€¼ï¼Œå¹¶å°†tophashè®¾ç½®ä¸ºempty&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func mapdelete(t *maptype, h *hmap, key unsafe.Pointer) {
    if raceenabled &amp;amp;&amp;amp; h != nil {
        callerpc := getcallerpc(unsafe.Pointer(&amp;amp;t))
        pc := funcPC(mapdelete)
        racewritepc(unsafe.Pointer(h), callerpc, pc)
        raceReadObjectPC(t.key, key, callerpc, pc)
    }
    if msanenabled &amp;amp;&amp;amp; h != nil {
        msanread(key, t.key.size)
    }
    if h == nil || h.count == 0 {
        return
    }
    if h.flags&amp;amp;hashWriting != 0 {
        throw(&amp;#34;concurrent map writes&amp;#34;)
    }

    alg := t.key.alg
    hash := alg.hash(key, uintptr(h.hash0))

    // Set hashWriting after calling alg.hash, since alg.hash may panic,
    // in which case we have not actually done a write (delete).
    h.flags |= hashWriting
    // æ‰©å®¹å·¥ä½œæ˜¯åˆ†æ­¥è¿›è¡Œçš„
    bucket := hash &amp;amp; (uintptr(1)&amp;lt;&amp;lt;h.B - 1)
    if h.growing() {
        growWork(t, h, bucket)
    }
    b := (*bmap)(unsafe.Pointer(uintptr(h.buckets) + bucket*uintptr(t.bucketsize)))
    top := uint8(hash &amp;gt;&amp;gt; (sys.PtrSize*8 - 8))
    if top &amp;lt; minTopHash {
        top += minTopHash
    }
    for {
        for i := uintptr(0); i &amp;lt; bucketCnt; i++ {
            if b.tophash[i] != top {
                continue
            }
            k := add(unsafe.Pointer(b), dataOffset+i*uintptr(t.keysize))
            k2 := k
            if t.indirectkey {
                k2 = *((*unsafe.Pointer)(k2))
            }
            if !alg.equal(key, k2) {
                continue
            }
            if t.indirectkey {
                *(*unsafe.Pointer)(k) = nil
            } else {
                typedmemclr(t.key, k)
            }
            v := unsafe.Pointer(uintptr(unsafe.Pointer(b)) + dataOffset + bucketCnt*uintptr(t.keysize) + i*uintptr(t.valuesize))
            if t.indirectvalue {
                *(*unsafe.Pointer)(v) = nil
            } else {
                typedmemclr(t.elem, v)
            }
            b.tophash[i] = empty
            h.count--
            goto done
        }
        b = b.overflow(t)
        if b == nil {
            goto done
        }
    }

done:
    if h.flags&amp;amp;hashWriting == 0 {
        throw(&amp;#34;concurrent map writes&amp;#34;)
    }
    h.flags &amp;amp;^= hashWriting
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;æ‰©å®¹æ“ä½œ&#34;&gt;æ‰©å®¹æ“ä½œ&lt;/h2&gt;

&lt;p&gt;mapåœ¨æ•°æ®æ’å…¥çš„æ—¶å€™å›è§¦å‘æ˜¯å¦æ‰©å®¹ï¼Œæ‰©å®¹çš„æ¡ä»¶æœ‰ä¸¤ä¸ª:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åˆ¤æ–­mapçš„æ•°é‡ loadFactor * (1&amp;lt;&lt;B), å³å…ƒç´ ä¸ªæ•° &gt;= æ¡¶ä¸ªæ•° * 6.5&lt;/li&gt;
&lt;li&gt;overflow çš„æ¡¶æ˜¯ä¸æ˜¯å¤ªå¤šäº†ï¼Œå½“ bucket æ€»æ•° &amp;lt; 2 ^ 15 æ—¶ï¼Œå¦‚æœ overflow çš„ bucket æ€»æ•° &amp;gt;= bucket çš„æ€»æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸º overflow çš„æ¡¶å¤ªå¤šäº†ã€‚å½“ bucket æ€»æ•° &amp;gt;= 2 ^ 15 æ—¶ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å’Œ 2 ^ 15 æ¯”è¾ƒï¼Œoverflow çš„bucket &amp;gt;= 2 ^ 15 æ—¶ï¼Œå³è®¤ä¸ºæº¢å‡ºæ¡¶å¤ªå¤šäº†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é’ˆå¯¹ä¸Šé¢çš„ä¸¤ç§æƒ…å†µï¼Œå®˜æ–¹ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹å¼è¿›è¡Œæ‰©å®¹çš„:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ç§å°±æ˜¯åˆ†é…æ–°çš„bucketæ•°ç»„ï¼Œå¤§å°ä¸º1&amp;lt;&amp;lt;(B+1)&lt;/li&gt;
&lt;li&gt;å°†hashå€¼åœ¨åŸbucketä¸­é‡æ–°æ’åˆ—ï¼Œè®©å€¼æ’çš„è·Ÿç´§å‡‘ä¸€äº›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;mapçš„æ‰©å®¹ä¸æ˜¯ä¸€æ­¥å®Œæˆçš„ï¼Œè€Œæ˜¯çš„æ’å…¥å€¼å’Œåˆ é™¤å€¼çš„æ—¶å€™åˆ†æ­¥è¿›è¡Œçš„ &lt;code&gt;growWork(t, h, bucket)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹é¢çœ‹ä¸‹æ‰©å®¹çš„æºä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// æ–°å»ºbucketåº•å±‚æ•°ç»„ï¼Œ
func makeBucketArray(t *maptype, b uint8) (buckets unsafe.Pointer, nextOverflow *bmap) {
    base := uintptr(1 &amp;lt;&amp;lt; b)
    nbuckets := base
    // For small b, overflow buckets are unlikely.
    // Avoid the overhead of the calculation.
    // å¯¹äºå°äº4çš„mapæ¥è¯´ï¼Œæˆ‘ä»¬è®¤ä¸ºæ²¡æœ‰overflow å¯ä»¥å‡å°‘ä¸€äº›å†…å­˜è®¡ç®—
    if b &amp;gt;= 4 {
        // Add on the estimated number of overflow buckets
        // required to insert the median number of elements
        // used with this value of b.
        nbuckets += 1 &amp;lt;&amp;lt; (b - 4)
        sz := t.bucket.size * nbuckets
        up := roundupsize(sz)
        if up != sz {
            nbuckets = up / t.bucket.size
        }
    }
    buckets = newarray(t.bucket, int(nbuckets))
    if base != nbuckets {
        // We preallocated some overflow buckets.  
        // æˆ‘ä»¬é¢„å…ˆåˆ†é…äº†ä¸€äº›overflowæ¡¶ã€‚
        // To keep the overhead of tracking these overflow buckets to a minimum,
        // ä¸ºäº†å°†tracking è¿™äº›overflowæ¡¶çš„å¼€é”€ä¿æŒåœ¨æœ€ä½é™åº¦ï¼Œ
        // we use the convention that if a preallocated overflow bucket&amp;#39;s overflow
        // pointer is nil, then there are more available by bumping the pointer.
        // We need a safe non-nil pointer for the last overflow bucket; just use buckets.
        nextOverflow = (*bmap)(add(buckets, base*uintptr(t.bucketsize)))
        last := (*bmap)(add(buckets, (nbuckets-1)*uintptr(t.bucketsize)))
        last.setoverflow(t, (*bmap)(buckets))
    }
    return buckets, nextOverflow
}

func hashGrow(t *maptype, h *hmap) {
    // If we&amp;#39;ve hit the load factor, get bigger.
    // Otherwise, there are too many overflow buckets,
    // so keep the same number of buckets and &amp;#34;grow&amp;#34; laterally.
    bigger := uint8(1)
    if !overLoadFactor(int64(h.count), h.B) {
        bigger = 0
        h.flags |= sameSizeGrow
    }
    oldbuckets := h.buckets
    newbuckets, nextOverflow := makeBucketArray(t, h.B+bigger)

    flags := h.flags &amp;amp;^ (iterator | oldIterator)
    if h.flags&amp;amp;iterator != 0 {
        flags |= oldIterator
    }
    // commit the grow (atomic wrt gc)
    h.B += bigger
    h.flags = flags
    h.oldbuckets = oldbuckets
    h.buckets = newbuckets
    h.nevacuate = 0
    h.noverflow = 0

    if h.extra != nil &amp;amp;&amp;amp; h.extra.overflow[0] != nil {
        // Promote current overflow buckets to the old generation.
        if h.extra.overflow[1] != nil {
            throw(&amp;#34;overflow is not nil&amp;#34;)
        }
        h.extra.overflow[1] = h.extra.overflow[0]
        h.extra.overflow[0] = nil
    }
    if nextOverflow != nil {
        if h.extra == nil {
            h.extra = new(mapextra)
        }
        h.extra.nextOverflow = nextOverflow
    }

    // the actual copying of the hash table data is done incrementally
    // by growWork() and evacuate().
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;130
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;131
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;132
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;133
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;134
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;135
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;136
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;137
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;138
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;139
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;140
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;141
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;142
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;143
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;144
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;145
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;146
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;147
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;148
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;149
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;150
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;151
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;152
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;153
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;154
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;155
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;156
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;157
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;158
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;159
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;160
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;161
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;162
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;163
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;164
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;165
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;166
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;167
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;168
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;169
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;170
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;171
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func growWork(t *maptype, h *hmap, bucket uintptr) {
    // make sure we evacuate the oldbucket corresponding
    // to the bucket we&amp;#39;re about to use
    evacuate(t, h, bucket&amp;amp;h.oldbucketmask())

    // evacuate one more oldbucket to make progress on growing
    if h.growing() {
        evacuate(t, h, h.nevacuate)
    }
}

func evacuate(t *maptype, h *hmap, oldbucket uintptr) {
    b := (*bmap)(add(h.oldbuckets, oldbucket*uintptr(t.bucketsize)))
    newbit := h.noldbuckets()
    alg := t.key.alg
    if !evacuated(b) {
        // TODO: reuse overflow buckets instead of using new ones, if there
        // is no iterator using the old buckets.  (If !oldIterator.)

        var (
            x, y   *bmap          // current low/high buckets in new map
            xi, yi int            // key/val indices into x and y
            xk, yk unsafe.Pointer // pointers to current x and y key storage
            xv, yv unsafe.Pointer // pointers to current x and y value storage
        )
        x = (*bmap)(add(h.buckets, oldbucket*uintptr(t.bucketsize)))
        xi = 0
        xk = add(unsafe.Pointer(x), dataOffset)
        xv = add(xk, bucketCnt*uintptr(t.keysize))
        if !h.sameSizeGrow() {
            // Only calculate y pointers if we&amp;#39;re growing bigger.
            // Otherwise GC can see bad pointers.
            y = (*bmap)(add(h.buckets, (oldbucket+newbit)*uintptr(t.bucketsize)))
            yi = 0
            yk = add(unsafe.Pointer(y), dataOffset)
            yv = add(yk, bucketCnt*uintptr(t.keysize))
        }
        for ; b != nil; b = b.overflow(t) {
            k := add(unsafe.Pointer(b), dataOffset)
            v := add(k, bucketCnt*uintptr(t.keysize))
            for i := 0; i &amp;lt; bucketCnt; i, k, v = i+1, add(k, uintptr(t.keysize)), add(v, uintptr(t.valuesize)) {
                top := b.tophash[i]
                if top == empty {
                    b.tophash[i] = evacuatedEmpty
                    continue
                }
                if top &amp;lt; minTopHash {
                    throw(&amp;#34;bad map state&amp;#34;)
                }
                k2 := k
                if t.indirectkey {
                    k2 = *((*unsafe.Pointer)(k2))
                }
                useX := true
                if !h.sameSizeGrow() {
                    // Compute hash to make our evacuation decision (whether we need
                    // to send this key/value to bucket x or bucket y).
                    hash := alg.hash(k2, uintptr(h.hash0))
                    if h.flags&amp;amp;iterator != 0 {
                        if !t.reflexivekey &amp;amp;&amp;amp; !alg.equal(k2, k2) {
                            // If key != key (NaNs), then the hash could be (and probably
                            // will be) entirely different from the old hash. Moreover,
                            // it isn&amp;#39;t reproducible. Reproducibility is required in the
                            // presence of iterators, as our evacuation decision must
                            // match whatever decision the iterator made.
                            // Fortunately, we have the freedom to send these keys either
                            // way. Also, tophash is meaningless for these kinds of keys.
                            // We let the low bit of tophash drive the evacuation decision.
                            // We recompute a new random tophash for the next level so
                            // these keys will get evenly distributed across all buckets
                            // after multiple grows.
                            if top&amp;amp;1 != 0 {
                                hash |= newbit
                            } else {
                                hash &amp;amp;^= newbit
                            }
                            top = uint8(hash &amp;gt;&amp;gt; (sys.PtrSize*8 - 8))
                            if top &amp;lt; minTopHash {
                                top += minTopHash
                            }
                        }
                    }
                    useX = hash&amp;amp;newbit == 0
                }
                if useX {
                    b.tophash[i] = evacuatedX
                    if xi == bucketCnt {
                        newx := h.newoverflow(t, x)
                        x = newx
                        xi = 0
                        xk = add(unsafe.Pointer(x), dataOffset)
                        xv = add(xk, bucketCnt*uintptr(t.keysize))
                    }
                    x.tophash[xi] = top
                    if t.indirectkey {
                        *(*unsafe.Pointer)(xk) = k2 // copy pointer
                    } else {
                        typedmemmove(t.key, xk, k) // copy value
                    }
                    if t.indirectvalue {
                        *(*unsafe.Pointer)(xv) = *(*unsafe.Pointer)(v)
                    } else {
                        typedmemmove(t.elem, xv, v)
                    }
                    xi++
                    xk = add(xk, uintptr(t.keysize))
                    xv = add(xv, uintptr(t.valuesize))
                } else {
                    b.tophash[i] = evacuatedY
                    if yi == bucketCnt {
                        newy := h.newoverflow(t, y)
                        y = newy
                        yi = 0
                        yk = add(unsafe.Pointer(y), dataOffset)
                        yv = add(yk, bucketCnt*uintptr(t.keysize))
                    }
                    y.tophash[yi] = top
                    if t.indirectkey {
                        *(*unsafe.Pointer)(yk) = k2
                    } else {
                        typedmemmove(t.key, yk, k)
                    }
                    if t.indirectvalue {
                        *(*unsafe.Pointer)(yv) = *(*unsafe.Pointer)(v)
                    } else {
                        typedmemmove(t.elem, yv, v)
                    }
                    yi++
                    yk = add(yk, uintptr(t.keysize))
                    yv = add(yv, uintptr(t.valuesize))
                }
            }
        }
        // Unlink the overflow buckets &amp;amp; clear key/value to help GC.
        if h.flags&amp;amp;oldIterator == 0 {
            b = (*bmap)(add(h.oldbuckets, oldbucket*uintptr(t.bucketsize)))
            // Preserve b.tophash because the evacuation
            // state is maintained there.
            if t.bucket.kind&amp;amp;kindNoPointers == 0 {
                memclrHasPointers(add(unsafe.Pointer(b), dataOffset), uintptr(t.bucketsize)-dataOffset)
            } else {
                memclrNoHeapPointers(add(unsafe.Pointer(b), dataOffset), uintptr(t.bucketsize)-dataOffset)
            }
        }
    }

    // Advance evacuation mark
    if oldbucket == h.nevacuate {
        h.nevacuate = oldbucket + 1
        // Experiments suggest that 1024 is overkill by at least an order of magnitude.
        // Put it in there as a safeguard anyway, to ensure O(1) behavior.
        stop := h.nevacuate + 1024
        if stop &amp;gt; newbit {
            stop = newbit
        }
        for h.nevacuate != stop &amp;amp;&amp;amp; bucketEvacuated(t, h, h.nevacuate) {
            h.nevacuate++
        }
        if h.nevacuate == newbit { // newbit == # of oldbuckets
            // Growing is all done. Free old main bucket array.
            h.oldbuckets = nil
            // Can discard old overflow buckets as well.
            // If they are still referenced by an iterator,
            // then the iterator holds a pointers to the slice.
            if h.extra != nil {
                h.extra.overflow[1] = nil
            }
            h.flags &amp;amp;^= sameSizeGrow
        }
    }
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;map æ‰©å®¹åŸç†å¯ä»¥çœ‹ä¸‹ &lt;a href=&#34;https://www.jianshu.com/p/aa0d4808cbb8&#34;&gt;https://www.jianshu.com/p/aa0d4808cbb8&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.yiz96.com/golang-map/&#34;&gt;https://blog.yiz96.com/golang-map/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://tiancaiamao.gitbooks.io/go-internals/content/zh/02.3.html&#34;&gt;https://tiancaiamao.gitbooks.io/go-internals/content/zh/02.3.html&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://github.com/cch123/golang-notes/blob/master/map.md&#34;&gt;https://github.com/cch123/golang-notes/blob/master/map.md&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://www.jianshu.com/p/aa0d4808cbb8&#34;&gt;https://www.jianshu.com/p/aa0d4808cbb8&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>golang reflect å‰–æ</title>
      <link>https://jayhong.github.io/post/20190313-golang-reflect-%E5%89%96%E6%9E%90/</link>
      <pubDate>Thu, 14 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190313-golang-reflect-%E5%89%96%E6%9E%90/</guid>
      
        <description>

&lt;p&gt;ä¹‹å‰å·²ç»æœ‰ä¸€ç¯‡æ–‡ç« å†™æ”¾å°„çš„ç”¨æ³•ï¼Œä»Šå¤©ä¸»è¦æ˜¯ä»æºç çš„è§’åº¦æ¥åˆ†æåå°„ï¼Œçœ‹ä¸‹æ”¾å°„æ˜¯å¦‚ä½•å®ç°çš„&lt;/p&gt;

&lt;h2 id=&#34;åå°„ä»£ç å‰–æ&#34;&gt;åå°„ä»£ç å‰–æ&lt;/h2&gt;

&lt;p&gt;éœ€è¦å…ˆäº†è§£ä¸€ä¸‹golangä¸­çš„ç±»å‹ç³»ç»Ÿä»¥åŠinterfaceçš„å®ç°,golangä¸­æ‰€æœ‰çš„ç±»å‹éƒ½æœ‰ä¸€ä¸ª_typeå­—æ®µç”¨äºæè¿°è¯¥ç±»å‹ï¼Œå¯¹äºä¸€äº›å¤åˆç±»å‹
è¿˜éœ€è¦æœ‰å…¶ä»–çš„å­—æ®µç”¨äºæè¿°å…¶ä»–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚chanï¼Œé™¤äº†chanæœ¬èº«å¤–ï¼Œè¿˜éœ€è¦æè¿°å…¶å…ƒç´ ç±»å‹ï¼Œè€Œmapåˆ™éœ€è¦keyç±»å‹ä¿¡æ¯å’Œvalueç±»å‹ä¿¡æ¯ç­‰:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;/ src/runtime/type.go
// ptrType represents a pointer type.
type ptrType struct {
   typ     _type   // æŒ‡é’ˆç±»å‹ 
   elem  *_type // æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ç±»å‹
}
type chantype struct {
    typ  _type        // channelç±»å‹
    elem *_type     // channelå…ƒç´ ç±»å‹
    dir  uintptr
}
type maptype struct {
    typ           _type
    key           *_type
    elem          *_type
    bucket        *_type // internal type representing a hash bucket
    hmap          *_type // internal type representing a hmap
    keysize       uint8  // size of key slot
    indirectkey   bool   // store ptr to key instead of key itself
    valuesize     uint8  // size of value slot
    indirectvalue bool   // store ptr to value instead of value itself
    bucketsize    uint16 // size of bucket
    reflexivekey  bool   // true if k==k for all keys
    needkeyupdate bool   // true if we need to update key on an overwrite
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;interface æ˜¯ç”±ä¸¤ä¸ªæ•°æ®æ¥å£efaceå’Œifaceç»„æˆçš„ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« &lt;/p&gt;

&lt;h3 id=&#34;typeof&#34;&gt;TypeOf&lt;/h3&gt;

&lt;p&gt;TypeOfä»£ç åœ¨ reflect/type.go ä¸­ï¼ŒTypeOfçš„æºä»£ç æ¯”è¾ƒç®€å•ï¼Œæ˜¯å°†efaceè½¬æˆemptyInterfaceç»“æ„ç„¶åè¿”å›typå­—æ®µï¼ŒTypeOfå’ŒValueOfçš„å‚æ•°æ˜¯interface{}ï¼Œ
æ‰€ä»¥ä¼šè°ƒç”¨runtime.convT2E è¿›è¡Œè½¬æ¢&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// TypeOf returns the reflection Type that represents the dynamic type of i.
// If i is a nil interface value, TypeOf returns nil.
func TypeOf(i interface{}) Type {
    eface := *(*emptyInterface)(unsafe.Pointer(&amp;amp;i))
    return toType(eface.typ)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å¯¹äºå¤åˆç±»å‹ï¼Œå¦‚Ptr, Slice, Chan, Mapç­‰ï¼Œå®ƒä»¬çš„typeä¿¡æ¯ä¸­åŒ…å«å…¶å­ç±»å‹çš„ä¿¡æ¯ï¼Œå¦‚Sliceå…ƒç´ ç±»å‹ï¼Œè€Œå…¶å…ƒç´ ç±»å‹ä¹Ÿå¯èƒ½æ˜¯å¤åˆç±»å‹ï¼Œå› æ­¤typeå®é™…ä¸Šæ˜¯ä¸€é¢—â€ç±»å‹æ ‘â€ï¼Œ
å¯é€šè¿‡reflect.Elem()å’Œreflect.Key()ç­‰APIæ¥è·å–è¿™äº›å­ç±»å‹ä¿¡æ¯ï¼Œä½†å¦‚æœå¦‚æœtypeä¸åŒ¹é…(æ¯”å¦‚reflect.TypeOf([]int{1,2}).Key())ï¼Œä¼španicã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// reflect/type.go
// reflect.rtypeç»“æ„ä½“å®šä¹‰å’Œruntime._typeä¸€è‡´  type.kindå®šä¹‰ä¹Ÿä¸€è‡´(ä¸ºäº†åˆ†åŒ…è€Œé‡å¤å®šä¹‰)
// Elem()è·å–rtypeä¸­çš„å…ƒç´ ç±»å‹ï¼Œåªé’ˆå¯¹å¤åˆç±»å‹(Array, Chan, Map, Ptr, Slice)æœ‰æ•ˆ
func (t *rtype) Elem() Type {
   switch t.Kind() {
   case Array:
      tt := (*arrayType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Chan:
      tt := (*chanType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Map:
      // å¯¹Mapæ¥è®²ï¼ŒElem()å¾—åˆ°çš„æ˜¯å…¶Valueç±»å‹
      // å¯é€šè¿‡rtype.Key()å¾—åˆ°Keyç±»å‹
      tt := (*mapType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Ptr:
      tt := (*ptrType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Slice:
      tt := (*sliceType)(unsafe.Pointer(t))
      return toType(tt.elem)
   }
   panic(&amp;#34;reflect: Elem of invalid type&amp;#34;)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å–å‡ºtypeä¹‹åå¯ä»¥æ ¹æ®typeä¸­çš„å­—æ®µï¼Œè·å–åˆ°å…³äºç±»å‹çš„å¾ˆå¤šä¿¡æ¯ï¼Œå¾ˆå¤šçš„æ“ä½œéƒ½æ˜¯é€šè¿‡åˆ¤æ–­kind ç„¶åè½¬æˆç›¸åº”ç±»å‹çš„
æŒ‡é’ˆï¼Œç„¶åå°±å¯ä»¥å–å‡ºè¯¥ç±»å‹çš„ä¿¡æ¯äº†&lt;/p&gt;

&lt;h3 id=&#34;valueof&#34;&gt;ValueOf&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;type Value struct {
    // å€¼çš„ç±»å‹
    typ *rtype
    // ç«‹å³æ•°æˆ–æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆ
    ptr unsafe.Pointer
    // type flag uintptr
    // æŒ‡æ˜å€¼çš„ç±»å‹ï¼Œæ˜¯å¦åªè¯»ï¼Œptrå­—æ®µæ˜¯å¦æ˜¯æŒ‡é’ˆç­‰
    flag
}

func ValueOf(i interface{}) Value {
    if i == nil {
        return Value{}
    }

    escapes(i)

    return unpackEface(i)
}

// å°†æ•°æ®ä»interface{}è§£åŒ…ä¸ºreflec.Value
func unpackEface(i interface{}) Value {
    e := (*emptyInterface)(unsafe.Pointer(&amp;amp;i))
    // NOTE: don&amp;#39;t read e.word until we know whether it is really a pointer or not.
    t := e.typ
    if t == nil {
        return Value{}
    }
    f := flag(t.Kind())
    if ifaceIndir(t) {
        f |= flagIndir
    }
    return Value{t, e.word, f}
}
 
// å°†æ•°æ®ç”±reflect.Valueæ‰“åŒ…ä¸ºinterface{}
func packEface(v Value) interface{} {
    t := v.typ
    var i interface{}
    e := (*emptyInterface)(unsafe.Pointer(&amp;amp;i))
    // First, fill in the data portion of the interface.
    switch {
    case ifaceIndir(t):
        if v.flag&amp;amp;flagIndir == 0 {
            panic(&amp;#34;bad indir&amp;#34;)
        }
        ptr := v.ptr
        if v.flag&amp;amp;flagAddr != 0 {
            c := unsafe_New(t)
            typedmemmove(t, c, ptr)
            ptr = c
        }
        e.word = ptr
    case v.flag&amp;amp;flagIndir != 0:
        e.word = *(*unsafe.Pointer)(v.ptr)
    default:
        e.word = v.ptr
    }

    e.typ = t
    return i
}
 
// å°†reflect.Valueè½¬æ¢ä¸ºinterface{}ï¼Œç›¸å½“äºreflect.ValueOfçš„é€†æ“ä½œ
// ç­‰ä»·äº: var i interface{} = (v&amp;#39;s underlying value)
func (v Value) Interface() (i interface{}) {
   return valueInterface(v, true)
}

func valueInterface(v Value, safe bool) interface{} {
   if v.flag == 0 {
      panic(&amp;amp;ValueError{&amp;#34;reflect.Value.Interface&amp;#34;, 0})
   }
   if safe &amp;amp;&amp;amp; v.flag&amp;amp;flagRO != 0 {
      panic(&amp;#34;reflect.Value.Interface: cannot return value obtained from unexported field or method&amp;#34;)
   }
   if v.flag&amp;amp;flagMethod != 0 {
      v = makeMethodValue(&amp;#34;Interface&amp;#34;, v)
   }
   // å½“interface{}ä½œä¸ºå­ç±»å‹æ—¶ï¼Œä¼šäº§ç”Ÿç±»å‹ä¸ºInterfaceçš„Value
   // å¦‚ reflect.TypeOf(m).Elem().Kind() == Interface
   if v.kind() == Interface {
      if v.NumMethod() == 0 {
         return *(*interface{})(v.ptr)
      }
      return *(*interface {
         M()
      })(v.ptr)
   }
   return packEface(v)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://ieevee.com/tech/2017/07/29/go-type.html&#34;&gt;https://ieevee.com/tech/2017/07/29/go-type.html&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://legendtkl.com/2017/07/01/golang-interface-implement/&#34;&gt;http://legendtkl.com/2017/07/01/golang-interface-implement/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://wudaijun.com/2018/01/go-interface-implement/&#34;&gt;http://wudaijun.com/2018/01/go-interface-implement/&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>golang interface å‰–æ</title>
      <link>https://jayhong.github.io/post/20190311-golang-interface-%E5%89%96%E6%9E%90/</link>
      <pubDate>Mon, 11 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190311-golang-interface-%E5%89%96%E6%9E%90/</guid>
      
        <description>

&lt;h2 id=&#34;interface-æ˜¯ä»€ä¹ˆ&#34;&gt;interface æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;

&lt;p&gt;interface æ˜¯ä¸€ç§å…·æœ‰ä¸€ç»„æ–¹æ³•çš„ç±»å‹ï¼Œè¿™äº›æ–¹æ³•å®šä¹‰äº† interface çš„è¡Œä¸ºã€‚&lt;/p&gt;

&lt;p&gt;go å…è®¸ä¸å¸¦ä»»ä½•æ–¹æ³•çš„ interface ï¼Œè¿™ç§ç±»å‹çš„ interface å« empty interfaceã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†ä¸€ä¸ª interface ä¸­æ‰€æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬è¯´ç±»å‹å®ç°äº†è¯¥ interfaceï¼Œ
æ‰€ä»¥æ‰€æœ‰ç±»å‹éƒ½å®ç°äº† empty interfaceï¼Œå› ä¸ºä»»ä½•ä¸€ç§ç±»å‹è‡³å°‘å®ç°äº† 0 ä¸ªæ–¹æ³•ã€‚go æ²¡æœ‰æ˜¾å¼çš„å…³é”®å­—ç”¨æ¥å®ç° interfaceï¼Œåªéœ€è¦å®ç° interface åŒ…å«çš„æ–¹æ³•å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ Gopher China 2017 çš„ä¼šä¸Šåˆæœ‰ä¸€ä¸ªå…³äº interface çš„ topic: &lt;a href=&#34;https://www.youtube.com/watch?v=F4wUrj6pmSI&amp;amp;t=2319s&#34;&gt;understanding golang interface(Gopher China)&lt;/a&gt; â€” youtubeï¼Œ
ä½œè€…æ˜¯ Francescã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦interface&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦interface ?&lt;/h2&gt;

&lt;h3 id=&#34;1-æ³›å‹ç¼–ç¨‹&#34;&gt;1ã€æ³›å‹ç¼–ç¨‹&lt;/h3&gt;

&lt;p&gt;æ³›å‹ç¼–ç¨‹æ˜¯æŒ‡å®ç°ä¸€ä¸ªæ–¹æ³•å¯ä»¥ç”¨äºå¤šç§ä¸åŒçš„æ•°æ®ç±»å‹ã€‚
åœ¨golangä¸­æ˜¯æ²¡æœ‰æ³›å‹ç¼–ç¨‹çš„ã€‚golangä¸­çš„æ³›å‹ç¼–ç¨‹å¯ä»¥é€šè¿‡interface{} è¿›è¡Œå®ç°.
golangæ ‡å‡†åº“ä¸­çš„sort&lt;code&gt;src/sort/sort.go&lt;/code&gt; å°±å®ç°äº†ç±»ä¼¼äºæ³›å‹ç¼–ç¨‹çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sort&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// A type, typically a collection, that satisfies sort.Interface can be
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// sorted by the routines in this package.  The methods require that the
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// elements of the collection be enumerated by an integer index.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// Len is the number of elements in the collection.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// Less reports whether the element with
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// index i should sort before the element with index j.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Less&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// Swap swaps the elements with indexes i and j.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Swap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Sort sorts data.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// It makes one call to data.Len to determine n, and O(n*log(n)) calls to
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// data.Less and data.Swap. The sort is not guaranteed to be stable.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Sort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// Switch to heapsort if depth of 2*ceil(lg(n+1)) is reached.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;maxDepth&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;maxDepth&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;maxDepth&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
    &lt;span class=&#34;nf&#34;&gt;quickSort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxDepth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä»»æ„çš„æ•°æ®ç±»å‹åªè¦å®ç°äº†sortçš„ä¸‰ä¸ªæ–¹æ³•å°±å¯ä»¥è°ƒç”¨sortæ–¹æ³•è¿›è¡Œæ’åºã€‚&lt;/p&gt;

&lt;h3 id=&#34;2-éšè—å®ç°&#34;&gt;2ã€éšè—å®ç°&lt;/h3&gt;

&lt;p&gt;æ¯”å¦‚æˆ‘è®¾è®¡ä¸€ä¸ªå‡½æ•°ç»™ä½ è¿”å›ä¸€ä¸ª interfaceï¼Œé‚£ä¹ˆä½ åªèƒ½é€šè¿‡ interface é‡Œé¢çš„æ–¹æ³•æ¥åšä¸€äº›æ“ä½œï¼Œ
ä½†æ˜¯å†…éƒ¨çš„å…·ä½“å®ç°æ˜¯å®Œå…¨ä¸çŸ¥é“çš„ã€‚Francesc ä¸¾äº†ä¸ª context çš„ä¾‹å­ã€‚ context æœ€å…ˆç”± google æä¾›ï¼Œ
ç°åœ¨å·²ç»çº³å…¥äº†æ ‡å‡†åº“ï¼Œè€Œä¸”åœ¨åŸæœ‰ context çš„åŸºç¡€ä¸Šå¢åŠ äº†ï¼šcancelCtxï¼ŒtimerCtxï¼ŒvalueCtxã€‚
è¯­è¨€çš„è¡¨è¾¾æœ‰æ—¶å€™ç•¥æ˜¾è‹ç™½æ— åŠ›ï¼Œçœ‹ä¸€ä¸‹ context åŒ…çš„ä»£ç å§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func WithCancel(parent Context) (ctx Context, cancel CancelFunc) {
    c := newCancelCtx(parent)
    propagateCancel(parent, &amp;amp;c)
    return &amp;amp;c, func() { c.cancel(true, Canceled) }
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¡¨é¢ä¸Š WithCancel å‡½æ•°è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Context interfaceï¼Œä½†æ˜¯è¿™ä¸ª interface çš„å…·ä½“å®ç°æ˜¯ cancelCtx structã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// newCancelCtx returns an initialized cancelCtx.
func newCancelCtx(parent Context) cancelCtx {
    return cancelCtx{
        Context: parent,
        done:    make(chan struct{}),
    }
}

// A cancelCtx can be canceled. When canceled, it also cancels any children
// that implement canceler.
type cancelCtx struct {
    Context     //æ³¨æ„ä¸€ä¸‹è¿™ä¸ªåœ°æ–¹

    done chan struct{} // closed by the first cancel call.
    mu       sync.Mutex
    children map[canceler]struct{} // set to nil by the first cancel call
    err      error                 // set to non-nil by the first cancel call
}

func (c *cancelCtx) Done() &amp;lt;-chan struct{} {
    return c.done
}

func (c *cancelCtx) Err() error {
    c.mu.Lock()
    defer c.mu.Unlock()
    return c.err
}

func (c *cancelCtx) String() string {
    return fmt.Sprintf(&amp;#34;%v.WithCancel&amp;#34;, c.Context)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å°½ç®¡å†…éƒ¨å®ç°ä¸Šä¸‹é¢ä¸‰ä¸ªå‡½æ•°è¿”å›çš„å…·ä½“ struct ï¼ˆéƒ½å®ç°äº† Context interfaceï¼‰ä¸åŒï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨è€…æ¥è¯´æ˜¯å®Œå…¨æ— æ„ŸçŸ¥çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func WithCancel(parent Context) (ctx Context, cancel CancelFunc)    //è¿”å› cancelCtx
func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc) //è¿”å› timerCtx
func WithValue(parent Context, key, val interface{}) Context    //è¿”å› valueCtx&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;3-providing-interception-points&#34;&gt;3ã€providing interception points&lt;/h3&gt;

&lt;p&gt;å°±æ˜¯å¯ä»¥åœ¨å·²ç»å®ç°çš„æ¥å£ä¸­ï¼Œå°è£…å¤šä¸€å±‚ï¼Œå®ç°ç±»ä¼¼äºè£…é¥°å™¨çš„ä¸œè¥¿&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;type header struct {
    rt  http.RoundTripper
    v   map[string]string
}

func (h header) RoundTrip(r *http.Request) *http.Response {
    for k, v := range h.v {
        r.Header.Set(k,v)
    }
    return h.rt.RoundTrip(r)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç›®å‰opentracing å®˜æ–¹æä¾›çš„åº“å°±ç”¨åˆ°äº†è¿™ä¸ªã€‚åœ¨httpçš„æ¥å£åŠ å¤šäº†ä¸€ä¸ªä¸­é—´ä»¶
&lt;a href=&#34;https://github.com/opentracing-contrib/go-stdlib/blob/master/nethttp/server.go#L111&#34;&gt;go-stdlib&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;interface-æºç å‰–æ&#34;&gt;interface æºç å‰–æ&lt;/h3&gt;

&lt;p&gt;interface åœ¨golangä¸­æ˜¯ç”±ä¸¤ä¸ªç»“æ„ä½“å®ç°çš„ï¼Œä¸€ä¸ªæ˜¯eface ä¸€ä¸ªæ˜¯iface&lt;/p&gt;

&lt;h4 id=&#34;eface&#34;&gt;eface&lt;/h4&gt;

&lt;p&gt;efaceåœ¨&lt;code&gt;runtime/runtime2.go&lt;/code&gt; ä¸­å®šä¹‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// src/runtime/runtime2.go
// ç©ºæ¥å£
type eface struct {
    _type *_type
    data  unsafe.Pointer
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç©ºæ¥å£(eface)æœ‰ä¸¤ä¸ªåŸŸï¼Œæ‰€æŒ‡å‘å¯¹è±¡çš„ç±»å‹ä¿¡æ¯(_type)å’Œæ•°æ®æŒ‡é’ˆ(data)ã€‚å…ˆçœ‹çœ‹_typeå­—æ®µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;/ æ‰€æœ‰ç±»å‹ä¿¡æ¯ç»“æ„ä½“çš„å…¬å…±éƒ¨åˆ†
// src/rumtime/runtime2.go
type _type struct {
    size       uintptr         // ç±»å‹çš„å¤§å°
    ptrdata    uintptr      // size of memory prefix holding all pointers
    hash       uint32          // ç±»å‹çš„Hashå€¼
    tflag      tflag              // ç±»å‹çš„Tags 
    align      uint8       // ç»“æ„ä½“å†…å¯¹é½
    fieldalign uint8       // ç»“æ„ä½“ä½œä¸ºfieldæ—¶çš„å¯¹é½
    kind       uint8       // ç±»å‹ç¼–å· å®šä¹‰äºruntime/typekind.go
    alg        *typeAlg    // ç±»å‹å…ƒæ–¹æ³• å­˜å‚¨hashå’Œequalä¸¤ä¸ªæ“ä½œã€‚map keyä¾¿ä½¿ç”¨keyçš„_type.alg.hash(k)è·å–hashå€¼
    gcdata    *byte            // GCç›¸å…³ä¿¡æ¯
    str       nameOff   // ç±»å‹åå­—çš„åç§»    
    ptrToThis typeOff    
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;_typeæ˜¯goæ‰€æœ‰ç±»å‹çš„å…¬å…±æè¿°ï¼Œé‡Œé¢åŒ…å«GCï¼Œåå°„ç­‰éœ€è¦çš„ç»†èŠ‚ï¼Œå®ƒå†³å®šdataåº”è¯¥å¦‚ä½•è§£é‡Šå’Œæ“ä½œï¼Œè¿™ä¹Ÿæ˜¯å®ƒå’ŒC void*ä¸åŒä¹‹å¤„ã€‚
å„ä¸ªç±»å‹æ‰€éœ€è¦çš„ç±»å‹æè¿°æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚chanï¼Œé™¤äº†chanæœ¬èº«å¤–ï¼Œè¿˜éœ€è¦æè¿°å…¶å…ƒç´ ç±»å‹ï¼Œè€Œmapåˆ™éœ€è¦keyç±»å‹ä¿¡æ¯å’Œvalueç±»å‹ä¿¡æ¯ç­‰:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;/ src/runtime/type.go
// ptrType represents a pointer type.
type ptrType struct {
   typ     _type   // æŒ‡é’ˆç±»å‹ 
   elem  *_type // æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ç±»å‹
}
type chantype struct {
    typ  _type        // channelç±»å‹
    elem *_type     // channelå…ƒç´ ç±»å‹
    dir  uintptr
}
type maptype struct {
    typ           _type
    key           *_type
    elem          *_type
    bucket        *_type // internal type representing a hash bucket
    hmap          *_type // internal type representing a hmap
    keysize       uint8  // size of key slot
    indirectkey   bool   // store ptr to key instead of key itself
    valuesize     uint8  // size of value slot
    indirectvalue bool   // store ptr to value instead of value itself
    bucketsize    uint16 // size of bucket
    reflexivekey  bool   // true if k==k for all keys
    needkeyupdate bool   // true if we need to update key on an overwrite
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¿™äº›ç±»å‹ä¿¡æ¯çš„ç¬¬ä¸€ä¸ªå­—æ®µéƒ½æ˜¯_type(ç±»å‹æœ¬èº«çš„ä¿¡æ¯)ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸€å †ç±»å‹éœ€è¦çš„å…¶å®ƒè¯¦ç»†ä¿¡æ¯(å¦‚å­ç±»å‹ä¿¡æ¯)ï¼Œè¿™æ ·åœ¨è¿›è¡Œç±»å‹ç›¸å…³æ“ä½œæ—¶ï¼Œ
å¯é€šè¿‡ä¸€ä¸ªå­—(typ *_type)å³å¯è¡¨è¿°æ‰€æœ‰ç±»å‹ï¼Œç„¶åå†é€šè¿‡_type.kindå¯è§£æå‡ºå…¶å…·ä½“ç±»å‹ï¼Œæœ€åé€šè¿‡åœ°å€è½¬æ¢å³å¯å¾—åˆ°ç±»å‹å®Œæ•´çš„â€_typeæ ‘â€ï¼Œå‚è€ƒreflect.Type.Elem()å‡½æ•°:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// reflect/type.go
// reflect.rtypeç»“æ„ä½“å®šä¹‰å’Œruntime._typeä¸€è‡´  type.kindå®šä¹‰ä¹Ÿä¸€è‡´(ä¸ºäº†åˆ†åŒ…è€Œé‡å¤å®šä¹‰)
// Elem()è·å–rtypeä¸­çš„å…ƒç´ ç±»å‹ï¼Œåªé’ˆå¯¹å¤åˆç±»å‹(Array, Chan, Map, Ptr, Slice)æœ‰æ•ˆ
func (t *rtype) Elem() Type {
   switch t.Kind() {
   case Array:
      tt := (*arrayType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Chan:
      tt := (*chanType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Map:
      // å¯¹Mapæ¥è®²ï¼ŒElem()å¾—åˆ°çš„æ˜¯å…¶Valueç±»å‹
      // å¯é€šè¿‡rtype.Key()å¾—åˆ°Keyç±»å‹
      tt := (*mapType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Ptr:
      tt := (*ptrType)(unsafe.Pointer(t))
      return toType(tt.elem)
   case Slice:
      tt := (*sliceType)(unsafe.Pointer(t))
      return toType(tt.elem)
   }
   panic(&amp;#34;reflect: Elem of invalid type&amp;#34;)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;iface&#34;&gt;iface&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// runtime/runtime2.go
// éç©ºæ¥å£
type iface struct {
    tab  *itab
    data unsafe.Pointer
}

// éç©ºæ¥å£çš„ç±»å‹ä¿¡æ¯
type itab struct {
    inter  *interfacetype    // æ¥å£å®šä¹‰çš„ç±»å‹ä¿¡æ¯
    _type  *_type                // æ¥å£å®é™…æŒ‡å‘å€¼çš„ç±»å‹ä¿¡æ¯
    link   *itab  
    bad    int32
    inhash int32
    fun    [1]uintptr             // æ¥å£æ–¹æ³•å®ç°åˆ—è¡¨ï¼Œå³å‡½æ•°åœ°å€åˆ—è¡¨ï¼ŒæŒ‰å­—å…¸åºæ’åº
}

// runtime/type.go
// éç©ºæ¥å£ç±»å‹ï¼Œæ¥å£å®šä¹‰ï¼ŒåŒ…è·¯å¾„ç­‰ã€‚
type interfacetype struct {
   typ     _type
   pkgpath name
   mhdr    []imethod      // æ¥å£æ–¹æ³•å£°æ˜åˆ—è¡¨ï¼ŒæŒ‰å­—å…¸åºæ’åº
}

// æ¥å£çš„æ–¹æ³•å£°æ˜ 
type imethod struct {
   name nameOff          // æ–¹æ³•å
   ityp typeOff                // æè¿°æ–¹æ³•å‚æ•°è¿”å›å€¼ç­‰ç»†èŠ‚
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;éç©ºæ¥å£(iface)æœ¬èº«é™¤äº†å¯ä»¥å®¹çº³æ»¡è¶³å…¶æ¥å£çš„å¯¹è±¡ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¿å­˜å…¶æ¥å£çš„æ–¹æ³•ï¼Œå› æ­¤é™¤äº†dataå­—æ®µï¼Œifaceé€šè¿‡tabå­—æ®µæè¿°éç©ºæ¥å£çš„ç»†èŠ‚
ï¼ŒåŒ…æ‹¬æ¥å£æ–¹æ³•å®šä¹‰ï¼Œæ¥å£æ–¹æ³•å®ç°åœ°å€ï¼Œæ¥å£æ‰€æŒ‡ç±»å‹ç­‰ã€‚ifaceæ˜¯éç©ºæ¥å£çš„å®ç°ï¼Œè€Œä¸æ˜¯ç±»å‹å®šä¹‰ï¼Œifaceçš„çœŸæ­£ç±»å‹ä¸ºinterfacetypeï¼Œå…¶ç¬¬ä¸€ä¸ªå­—æ®µä»ç„¶ä¸ºæè¿°å…¶è‡ªèº«ç±»å‹çš„_typeå­—æ®µã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†æé«˜æŸ¥æ‰¾æ•ˆç‡ï¼Œruntimeä¸­å®ç°(interface_type, concrete_type) -&amp;gt; itab(åŒ…å«å…·ä½“æ–¹æ³•å®ç°åœ°å€ç­‰ä¿¡æ¯)çš„hashè¡¨:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// runtime/iface.go
const (
   hashSize = 1009
)

var (
   ifaceLock mutex // lock for accessing hash
   hash      [hashSize]*itab
)
// ç®€å•çš„Hashç®—æ³•
func itabhash(inter *interfacetype, typ *_type) uint32 {
   h := inter.typ.hash
   h += 17 * typ.hash
   return h % hashSize
}

// æ ¹æ®interface_typeå’Œconcrete_typeè·å–æˆ–ç”Ÿæˆitabä¿¡æ¯
func getitab(inter *interfacetype, typ *_type, canfail bool) *itab {
   ...
    // ç®—å‡ºhash key
   h := itabhash(inter, typ)


   var m *itab
   ...
           // éå†hash sloté“¾è¡¨
      for m = (*itab)(atomic.Loadp(unsafe.Pointer(&amp;amp;hash[h]))); m != nil; m = m.link {
         // å¦‚æœåœ¨hashè¡¨ä¸­æ‰¾åˆ°åˆ™è¿”å›
         if m.inter == inter &amp;amp;&amp;amp; m._type == typ {
            if m.bad {
               if !canfail {
                  additab(m, locked != 0, false)
               }
               m = nil
            }
            ...
            return m
         }
      }
   }
    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™å°è¯•ç”Ÿæˆitab(ä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³æ¥å£)
   m = (*itab)(persistentalloc(unsafe.Sizeof(itab{})+uintptr(len(inter.mhdr)-1)*sys.PtrSize, 0, &amp;amp;memstats.other_sys))
   m.inter = inter
   m._type = typ
   additab(m, true, canfail)
   if m.bad {
      return nil
   }
   return m
}

// æ£€æŸ¥concrete_typeæ˜¯å¦ç¬¦åˆinterface_type å¹¶ä¸”åˆ›å»ºå¯¹åº”çš„itabç»“æ„ä½“ å°†å…¶æ”¾åˆ°hashè¡¨ä¸­
func additab(m *itab, locked, canfail bool) {
   inter := m.inter
   typ := m._type
   x := typ.uncommon()

   ni := len(inter.mhdr)
   nt := int(x.mcount)
   xmhdr := (*[1 &amp;lt;&amp;lt; 16]method)(add(unsafe.Pointer(x), uintptr(x.moff)))[:nt:nt]
   j := 0
   for k := 0; k &amp;lt; ni; k++ {
      i := &amp;amp;inter.mhdr[k]
      itype := inter.typ.typeOff(i.ityp)
      name := inter.typ.nameOff(i.name)
      iname := name.name()
      ipkg := name.pkgPath()
      if ipkg == &amp;#34;&amp;#34; {
         ipkg = inter.pkgpath.name()
      }
      for ; j &amp;lt; nt; j++ {
         t := &amp;amp;xmhdr[j]
         tname := typ.nameOff(t.name)
         // æ£€æŸ¥æ–¹æ³•åå­—æ˜¯å¦ä¸€è‡´
         if typ.typeOff(t.mtyp) == itype &amp;amp;&amp;amp; tname.name() == iname {
            pkgPath := tname.pkgPath()
            if pkgPath == &amp;#34;&amp;#34; {
               pkgPath = typ.nameOff(x.pkgpath).name()
            }
            // æ˜¯å¦å¯¼å‡ºæˆ–åœ¨åŒä¸€ä¸ªåŒ…
            if tname.isExported() || pkgPath == ipkg {
               if m != nil {
                    // è·å–å‡½æ•°åœ°å€ï¼Œå¹¶åŠ å…¥åˆ°itab.funæ•°ç»„ä¸­
                  ifn := typ.textOff(t.ifn)
                  *(*unsafe.Pointer)(add(unsafe.Pointer(&amp;amp;m.fun[0]), uintptr(k)*sys.PtrSize)) = ifn
               }
               goto nextimethod
            }
         }
      }
      // didn&amp;#39;t find method
      if !canfail {
         if locked {
            unlock(&amp;amp;ifaceLock)
         }
         panic(&amp;amp;TypeAssertionError{&amp;#34;&amp;#34;, typ.string(), inter.typ.string(), iname})
      }
      m.bad = true
      break
   nextimethod:
   }
   if !locked {
      throw(&amp;#34;invalid itab locking&amp;#34;)
   }
   // åŠ åˆ°Hash Sloté“¾è¡¨ä¸­
   h := itabhash(inter, typ)
   m.link = hash[h]
   m.inhash = true
   atomicstorep(unsafe.Pointer(&amp;amp;hash[h]), unsafe.Pointer(m))
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;æ¥å£èµ‹å€¼&#34;&gt;æ¥å£èµ‹å€¼&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyInterface&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyStruct&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ms&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyStruct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyStruct&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyInterface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ä»£ç  17 è¡Œ var y interface{} = x è°ƒç”¨äº†å‡½æ•° runtime.convT2E ï¼Œå°† int ç±»å‹çš„ x è½¬æ¢æˆ empty interfaceã€‚
ä»£ç  19 è¡Œ var t MyInterface = s è°ƒç”¨äº†å‡½æ•° runtime.convT2I ï¼Œå°† MyStruct ç±»å‹è½¬æ¢æˆ non-empty interface: MyInterface&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func convT2E(t *_type, elem unsafe.Pointer) (e eface) {
    ...
  
    x := newobject(t)
    typedmemmove(t, x, elem)
    e._type = t
    e.data = x
    return
}

func convT2I(tab *itab, elem unsafe.Pointer) (i iface) {
    t := tab._type
    
    ...
  
    x := newobject(t)
    typedmemmove(t, x, elem)
    i.tab = tab
    i.data = x
    return
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;çœ‹ä¸Šé¢çš„å‡½æ•°åŸå‹ï¼Œå¯ä»¥çœ‹å‡ºä¸­é—´è¿‡ç¨‹ç¼–è¯‘å™¨å°†æ ¹æ®æˆ‘ä»¬çš„è½¬æ¢ç›®æ ‡ç±»å‹çš„ empty interface è¿˜æ˜¯ non-empty interfaceï¼Œ
æ¥å¯¹åŸæ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢ï¼ˆè½¬æ¢æˆ &amp;lt;*_type, unsafe.Pointer&amp;gt; æˆ–è€… &amp;lt;*itab, unsafe.Pointer&amp;gt;ï¼‰ã€‚è¿™é‡Œå¯¹äº struct æ»¡ä¸
æ»¡è¶³ interface çš„ç±»å‹è¦æ±‚ï¼ˆä¹Ÿå°±æ˜¯ struct æ˜¯å¦å®ç°äº† interface çš„æ‰€æœ‰ methodï¼‰ï¼Œæ˜¯ç”±ç¼–è¯‘å™¨æ¥æ£€æµ‹çš„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;type-assertion&#34;&gt;Type Assertion&lt;/h2&gt;

&lt;p&gt;æ–­è¨€çš„è¯æ˜¯é€šè¿‡getiatbå®ç°çš„ï¼Œgetitabä¼šè®¡ç®—&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// The assertXXX functions may fail (either panicking or returning false,
// depending on whether they are 1-result or 2-result).
func assertI2I(inter *interfacetype, i iface) (r iface) {
    tab := i.tab
    if tab == nil {
        // explicit conversions require non-nil interface value.
        panic(&amp;amp;TypeAssertionError{&amp;#34;&amp;#34;, &amp;#34;&amp;#34;, inter.typ.string(), &amp;#34;&amp;#34;})
    }
    if tab.inter == inter {
        r.tab = tab
        r.data = i.data
        return
    }
    r.tab = getitab(inter, tab._type, false)
    r.data = i.data
    return
}
func assertI2I2(inter *interfacetype, i iface) (r iface, b bool) {
    tab := i.tab
    if tab == nil {
        return
    }
    if tab.inter != inter {
        tab = getitab(inter, tab._type, true)
        if tab == nil {
            return
        }
    }
    r.tab = tab
    r.data = i.data
    b = true
    return
}

// ç±»ä¼¼
func assertE2I(inter *interfacetype, e eface) (r iface)
func assertE2I2(inter *interfacetype, e eface) (r iface, b bool)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// runtime/iface.go
const (
   hashSize = 1009
)

var (
   ifaceLock mutex // lock for accessing hash
   hash      [hashSize]*itab
)
// ç®€å•çš„Hashç®—æ³•
func itabhash(inter *interfacetype, typ *_type) uint32 {
   h := inter.typ.hash
   h += 17 * typ.hash
   return h % hashSize
}

// æ ¹æ®interface_typeå’Œconcrete_typeè·å–æˆ–ç”Ÿæˆitabä¿¡æ¯
func getitab(inter *interfacetype, typ *_type, canfail bool) *itab {
   ...
    // ç®—å‡ºhash key
   h := itabhash(inter, typ)


   var m *itab
   ...
           // éå†hash sloté“¾è¡¨
      for m = (*itab)(atomic.Loadp(unsafe.Pointer(&amp;amp;hash[h]))); m != nil; m = m.link {
         // å¦‚æœåœ¨hashè¡¨ä¸­æ‰¾åˆ°åˆ™è¿”å›
         if m.inter == inter &amp;amp;&amp;amp; m._type == typ {
            if m.bad {
               if !canfail {
                  additab(m, locked != 0, false)
               }
               m = nil
            }
            ...
            return m
         }
      }
   }
    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™å°è¯•ç”Ÿæˆitab(ä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³æ¥å£)
   m = (*itab)(persistentalloc(unsafe.Sizeof(itab{})+uintptr(len(inter.mhdr)-1)*sys.PtrSize, 0, &amp;amp;memstats.other_sys))
   m.inter = inter
   m._type = typ
   additab(m, true, canfail)
   if m.bad {
      return nil
   }
   return m
}

// æ£€æŸ¥concrete_typeæ˜¯å¦ç¬¦åˆinterface_type å¹¶ä¸”åˆ›å»ºå¯¹åº”çš„itabç»“æ„ä½“ å°†å…¶æ”¾åˆ°hashè¡¨ä¸­
func additab(m *itab, locked, canfail bool) {
   inter := m.inter
   typ := m._type
   x := typ.uncommon()

   ni := len(inter.mhdr)
   nt := int(x.mcount)
   xmhdr := (*[1 &amp;lt;&amp;lt; 16]method)(add(unsafe.Pointer(x), uintptr(x.moff)))[:nt:nt]
   j := 0
   for k := 0; k &amp;lt; ni; k++ {
      i := &amp;amp;inter.mhdr[k]
      itype := inter.typ.typeOff(i.ityp)
      name := inter.typ.nameOff(i.name)
      iname := name.name()
      ipkg := name.pkgPath()
      if ipkg == &amp;#34;&amp;#34; {
         ipkg = inter.pkgpath.name()
      }
      for ; j &amp;lt; nt; j++ {
         t := &amp;amp;xmhdr[j]
         tname := typ.nameOff(t.name)
         // æ£€æŸ¥æ–¹æ³•åå­—æ˜¯å¦ä¸€è‡´
         if typ.typeOff(t.mtyp) == itype &amp;amp;&amp;amp; tname.name() == iname {
            pkgPath := tname.pkgPath()
            if pkgPath == &amp;#34;&amp;#34; {
               pkgPath = typ.nameOff(x.pkgpath).name()
            }
            // æ˜¯å¦å¯¼å‡ºæˆ–åœ¨åŒä¸€ä¸ªåŒ…
            if tname.isExported() || pkgPath == ipkg {
               if m != nil {
                    // è·å–å‡½æ•°åœ°å€ï¼Œå¹¶åŠ å…¥åˆ°itab.funæ•°ç»„ä¸­
                  ifn := typ.textOff(t.ifn)
                  *(*unsafe.Pointer)(add(unsafe.Pointer(&amp;amp;m.fun[0]), uintptr(k)*sys.PtrSize)) = ifn
               }
               goto nextimethod
            }
         }
      }
      // didn&amp;#39;t find method
      if !canfail {
         if locked {
            unlock(&amp;amp;ifaceLock)
         }
         panic(&amp;amp;TypeAssertionError{&amp;#34;&amp;#34;, typ.string(), inter.typ.string(), iname})
      }
      m.bad = true
      break
   nextimethod:
   }
   if !locked {
      throw(&amp;#34;invalid itab locking&amp;#34;)
   }
   // åŠ åˆ°Hash Sloté“¾è¡¨ä¸­
   h := itabhash(inter, typ)
   m.link = hash[h]
   m.inhash = true
   atomicstorep(unsafe.Pointer(&amp;amp;hash[h]), unsafe.Pointer(m))
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;interface æ˜¯æœ‰ä¸¤ä¸ªç»“æ„ä½“ç»„æˆçš„iface å’Œefaceï¼Œefaceæ˜¯æœ‰ä¸€ä¸ª_typeå’ŒæŒ‡é’ˆæ„æˆï¼Œifaceæ˜¯æœ‰itab å’ŒæŒ‡é’ˆæ„æˆ
ifaceé‡Œé¢æœ‰_type å’Œ æ–¹æ³•åˆ—è¡¨å“ˆå¸Œå€¼
æ¥å£çš„èµ‹å€¼æ˜¯é€šè¿‡convT2I convT2E æ¥å®ç°çš„
æ¥å£çš„æ–­è¨€æ˜¯é€šè¿‡assertE2I æ¥å®ç°çš„&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/golang/go/wiki/InterfaceSlice&#34;&gt;https://github.com/golang/go/wiki/InterfaceSlice&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://sanyuesha.com/2017/07/22/how-to-understand-go-interface/&#34;&gt;https://sanyuesha.com/2017/07/22/how-to-understand-go-interface/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://legendtkl.com/2017/07/01/golang-interface-implement/&#34;&gt;http://legendtkl.com/2017/07/01/golang-interface-implement/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://legendtkl.com/2017/06/12/understanding-golang-interface/&#34;&gt;http://legendtkl.com/2017/06/12/understanding-golang-interface/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://i6448038.github.io/2018/10/01/Golang-interface/&#34;&gt;https://i6448038.github.io/2018/10/01/Golang-interface/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://wudaijun.com/2018/01/go-interface-implement/&#34;&gt;http://wudaijun.com/2018/01/go-interface-implement/&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>golang channelå®ç°åŸç†</title>
      <link>https://jayhong.github.io/post/20190307-golang-channel-%E5%89%96%E6%9E%90/</link>
      <pubDate>Thu, 07 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190307-golang-channel-%E5%89%96%E6%9E%90/</guid>
      
        <description>

&lt;h3 id=&#34;channel&#34;&gt;channel&lt;/h3&gt;

&lt;p&gt;è¦æƒ³ç†è§£ channel è¦å…ˆçŸ¥é“ CSP æ¨¡å‹ã€‚CSP æ˜¯ Communicating Sequential Process çš„ç®€ç§°ï¼Œä¸­æ–‡å¯ä»¥å«åšé€šä¿¡é¡ºåºè¿›ç¨‹ï¼Œæ˜¯ä¸€ç§å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œç”± Tony Hoare äº 1977 å¹´æå‡ºã€‚ç®€å•æ¥è¯´ï¼ŒCSP æ¨¡å‹ç”±å¹¶å‘æ‰§è¡Œçš„å®ä½“ï¼ˆçº¿ç¨‹æˆ–è€…è¿›ç¨‹ï¼‰æ‰€ç»„æˆï¼Œå®ä½“ä¹‹é—´é€šè¿‡å‘é€æ¶ˆæ¯è¿›è¡Œé€šä¿¡ï¼Œè¿™é‡Œå‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨çš„å°±æ˜¯é€šé“ï¼Œæˆ–è€…å« channelã€‚CSP æ¨¡å‹çš„å…³é”®æ˜¯å…³æ³¨ channelï¼Œè€Œä¸å…³æ³¨å‘é€æ¶ˆæ¯çš„å®ä½“ã€‚Go è¯­è¨€å®ç°äº† CSP éƒ¨åˆ†ç†è®ºï¼Œgoroutine å¯¹åº” CSP ä¸­å¹¶å‘æ‰§è¡Œçš„å®ä½“ï¼Œchannel ä¹Ÿå°±å¯¹åº”ç€ CSP ä¸­çš„ channelã€‚ï¼Œgolang ä½¿ç”¨äº†channelå®ç°äº†CSPå¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œ
ä¸‹é¢å°†ä»æºç çš„è§’åº¦æ¥åˆ†æchannelï¼Œé¦–å…ˆä¼šå…ˆçœ‹ä¸‹channelæ”¯æŒçš„æ“ä½œï¼Œç„¶åå†åˆ†æè¿™äº›æ“ä½œå¯¹åº”çš„æºä»£ç ã€‚&lt;/p&gt;

&lt;h3 id=&#34;channelç›¸å…³æ“ä½œ&#34;&gt;channelç›¸å…³æ“ä½œ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;chanåˆ†ä¸ºé˜»å¡å¼çš„å’Œéé˜»å¡ç±»çš„chan&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;//åˆ›å»ºä¸€ä¸ªé˜»å¡ç±»chan
ch := make(chan int)
//åˆ›å»ºä¸€ä¸ªéé˜»å¡ç±»chan
ch := make(chan intï¼Œ 9)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¾€chanå†™æ•°æ®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;ch &amp;lt;- 1&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä»chanä¸­è¯»æ•°æ®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;a := &amp;lt;- ch&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å…³é—­ channel&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;close(ch)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æŸ¥çœ‹chançš„cap å’Œlen&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func main() {
ch := make(chan int, 100)
ch &amp;lt;- 1
fmt.Println(len(ch)) // 1
fmt.Println(cap(ch)) // 100
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;goroutine é€šä¿¡&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;select&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;range channel&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è¶…æ—¶æ§åˆ¶&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å•å‘ channel&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;chanä½¿ç”¨éœ€è¦æ³¨æ„çš„é—®é¢˜&#34;&gt;chanä½¿ç”¨éœ€è¦æ³¨æ„çš„é—®é¢˜&lt;/h3&gt;

&lt;h4 id=&#34;close-chan&#34;&gt;close chan&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;å…³é—­ä¸€ä¸ªå·²ç»å…³é—­çš„chanä¼šå¯¼è‡´panic&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å…³é—­chanä¼šé€€å‡ºå¾ªç¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt; func main() {
    ch := make(chan int, 100)
    for elem := range ch { // ä¸»è¦å°±æ˜¯è¿™é‡Œçš„ for range...
        fmt.Println(i)
    }
 }&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¾€å…³é—­çš„chanå‘é€æ•°æ®ä¼šå¯¼è‡´panic&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¦‚æœ close channel æ—¶ï¼Œæœ‰ sender goroutine æŒ‚åœ¨ channel çš„é˜»å¡å‘é€é˜Ÿåˆ—ä¸­ï¼Œ
ä¼šå¯¼è‡´ panicï¼šclose ä¸€ä¸ª channel ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨è¯¥ channel ä¸Šçš„ gï¼Œå¹¶ä½¿å…¶è¿›å…¥ Grunnable çŠ¶æ€ï¼Œ
è¿™æ—¶è¿™äº› writer goroutine ä¼šå‘ç°è¯¥ channel å·²ç»æ˜¯ closed çŠ¶æ€ï¼Œå°± panicäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt; func main() {
    ch := make(chan int)
    go func() { ch &amp;lt;- 1 }() // panic: send on closed channel
    time.Sleep(time.Second)
    go func() { close(ch) }()
    time.Sleep(time.Second)
    x, ok := &amp;lt;-ch
    fmt.Println(x, ok)
 }&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¯ä»¥ä»å·²ç» closed çš„ channel ä¸­æ¥æ”¶å€¼ï¼Œå¦‚æœ channel ä¸­æœ‰å€¼ï¼Œè¿™é‡Œç‰¹æŒ‡å¸¦ buffer çš„ channelï¼Œé‚£ä¹ˆå°±ä» channel ä¸­å–ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆä¼šè¿”å› channel å…ƒç´ çš„ 0 å€¼ã€‚
åŒºåˆ†æ˜¯è¿”å›çš„é›¶å€¼è¿˜æ˜¯ buffer ä¸­çš„å€¼å¯ä½¿ç”¨ comma, ok è¯­æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;//è‹¥ ok ä¸º falseï¼Œè¡¨æ˜ channel å·²è¢«å…³é—­ï¼Œæ‰€å¾—çš„æ˜¯æ— æ•ˆçš„å€¼
x, ok := &amp;lt;-ch&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;nil-chan&#34;&gt;nil chan&lt;/h4&gt;

&lt;p&gt;ä¸è¿›è¡Œåˆå§‹åŒ–ï¼Œå³ä¸è°ƒç”¨ make æ¥èµ‹å€¼çš„ channel ç§°ä¸º nil channel&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt; var a chan int&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;å…³é—­ä¸€ä¸ªnilçš„chanä¼šå¯¼è‡´panic&lt;/p&gt;

&lt;h4 id=&#34;close-principle&#34;&gt;close principle&lt;/h4&gt;

&lt;h3 id=&#34;channelæºç &#34;&gt;channelæºç &lt;/h3&gt;

&lt;p&gt;&lt;code&gt;src/runtime/chan.go:hchan&lt;/code&gt;å®šä¹‰äº†channelçš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;

&lt;h4 id=&#34;hchan-struct&#34;&gt;hchan struct&lt;/h4&gt;

&lt;p&gt;chançš„åº•å±‚å°±æ˜¯hchan&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;type hchan struct {
    qcount   uint           // é˜Ÿåˆ—ä¸­æ•°æ®ä¸ªæ•°
    dataqsiz uint           // channel å¤§å°
    buf      unsafe.Pointer // å­˜æ”¾æ•°æ®çš„ç¯å½¢æ•°ç»„
    elemsize uint16         // channel ä¸­æ•°æ®ç±»å‹çš„å¤§å°
    closed   uint32         // è¡¨ç¤º channel æ˜¯å¦å…³é—­
    elemtype *_type // å…ƒç´ æ•°æ®ç±»å‹
    sendx    uint   // send çš„æ•°ç»„ç´¢å¼•
    recvx    uint   // recv çš„æ•°ç»„ç´¢å¼•
    recvq    waitq  // ç”± recv è¡Œä¸ºï¼ˆä¹Ÿå°±æ˜¯ &amp;lt;-chï¼‰é˜»å¡åœ¨ channel ä¸Šçš„ goroutine é˜Ÿåˆ—
    sendq    waitq  // ç”± send è¡Œä¸º (ä¹Ÿå°±æ˜¯ ch&amp;lt;-) é˜»å¡åœ¨ channel ä¸Šçš„ goroutine é˜Ÿåˆ—

    // lock protects all fields in hchan, as well as several
    // fields in sudogs blocked on this channel.
    //
    // Do not change another G&amp;#39;s status while holding this lock
    // (in particular, do not ready a G), as this can deadlock
    // with stack shrinking.
    lock mutex
}
type waitq struct {
    first *sudog
    last  *sudog
}
type sudog struct {
    // The following fields are protected by the hchan.lock of the
    // channel this sudog is blocking on. shrinkstack depends on
    // this for sudogs involved in channel ops.

    g          *g
    selectdone *uint32 // CAS to 1 to win select race (may point to stack)
    next       *sudog
    prev       *sudog
    elem       unsafe.Pointer // data element (may point to stack)

    // The following fields are never accessed concurrently.
    // For channels, waitlink is only accessed by g.
    // For semaphores, all fields (including the ones above)
    // are only accessed when holding a semaRoot lock.

    acquiretime int64
    releasetime int64
    ticket      uint32
    parent      *sudog // semaRoot binary tree
    waitlink    *sudog // g.waiting list or semaRoot
    waittail    *sudog // semaRoot
    c           *hchan // channel
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;channel å…¶å®å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—åŠ ä¸€ä¸ªé”ï¼Œåªä¸è¿‡è¿™ä¸ªé”æ˜¯ä¸€ä¸ªè½»é‡çº§é”ã€‚å…¶ä¸­ recvq æ˜¯è¯»æ“ä½œé˜»å¡åœ¨ channel çš„ goroutine åˆ—è¡¨ï¼Œ
 sendq æ˜¯å†™æ“ä½œé˜»å¡åœ¨ channel çš„ goroutine åˆ—è¡¨ã€‚åˆ—è¡¨çš„å®ç°æ˜¯ sudogï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹ g çš„ç»“æ„çš„å°è£…&lt;/p&gt;

&lt;h4 id=&#34;make-channel&#34;&gt;make channel&lt;/h4&gt;

&lt;p&gt;é€šè¿‡ make åˆ›å»º channel å¯¹åº”çš„ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func makechan(t *chantype, size int64) *hchan {
    elem := t.elem

    // compiler checks this but be safe.
    if elem.size &amp;gt;= 1&amp;lt;&amp;lt;16 {
        throw(&amp;#34;makechan: invalid channel element type&amp;#34;)
    }
    if hchanSize%maxAlign != 0 || elem.align &amp;gt; maxAlign {
        throw(&amp;#34;makechan: bad alignment&amp;#34;)
    }
    if size &amp;lt; 0 || int64(uintptr(size)) != size || (elem.size &amp;gt; 0 &amp;amp;&amp;amp; uintptr(size) &amp;gt; (_MaxMem-hchanSize)/elem.size) {
        panic(plainError(&amp;#34;makechan: size out of range&amp;#34;))
    }

    var c *hchan
    if elem.kind&amp;amp;kindNoPointers != 0 || size == 0 {
        // Allocate memory in one call.
        // Hchan does not contain pointers interesting for GC in this case:
        // buf points into the same allocation, elemtype is persistent.
        // SudoG&amp;#39;s are referenced from their owning thread so they can&amp;#39;t be collected.
        // TODO(dvyukov,rlh): Rethink when collector can move allocated objects.
        c = (*hchan)(mallocgc(hchanSize+uintptr(size)*elem.size, nil, true))
        if size &amp;gt; 0 &amp;amp;&amp;amp; elem.size != 0 {
            c.buf = add(unsafe.Pointer(c), hchanSize)
        } else {
            // race detector uses this location for synchronization
            // Also prevents us from pointing beyond the allocation (see issue 9401).
            c.buf = unsafe.Pointer(c)
        }
    } else {
        c = new(hchan)
        c.buf = newarray(elem, int(size))
    }
    c.elemsize = uint16(elem.size)
    c.elemtype = elem
    c.dataqsiz = uint(size)

    if debugChan {
        print(&amp;#34;makechan: chan=&amp;#34;, c, &amp;#34;; elemsize=&amp;#34;, elem.size, &amp;#34;; elemalg=&amp;#34;, elem.alg, &amp;#34;; dataqsiz=&amp;#34;, size, &amp;#34;\n&amp;#34;)
    }
    return c
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æœ€å‰é¢çš„ä¸¤ä¸ª if æ˜¯ä¸€äº›å¼‚å¸¸åˆ¤æ–­ï¼šå…ƒç´ ç±»å‹å¤§å°é™åˆ¶å’Œå¯¹é½é™åˆ¶ã€‚ç¬¬ä¸‰ä¸ª if ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåˆ¤æ–­ size å¤§å°æ˜¯å¦å°äº 0 æˆ–è€…è¿‡å¤§ã€‚
&lt;code&gt;int64(uintptr(size)) != size&lt;/code&gt;è¿™å¥ä¹Ÿæ˜¯åˆ¤æ–­ size æ˜¯å¦ä¸ºè´Ÿã€‚å€¼å¾—ä¸€è¯´çš„æ˜¯æœ€åé¢çš„åˆ¤æ–­æ¡ä»¶&lt;/p&gt;

&lt;p&gt;_MaxMem æ˜¯ Arena åŒºåŸŸçš„æœ€å¤§å€¼ï¼Œç”¨æ¥åˆ†é…ç»™å †çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ channel æ˜¯åœ¨å †ä¸Šåˆ†é…çš„ã€‚&lt;/p&gt;

&lt;p&gt;å†å¾€ä¸‹å°±å¯ä»¥çœ‹åˆ°åˆ†é…çš„ä»£ç äº†ã€‚å¦‚æœ channel å†…æ•°æ®ç±»å‹ä¸å«æœ‰æŒ‡é’ˆä¸” size &amp;gt; 0ï¼Œåˆ™å°†å…¶åˆ†é…åœ¨è¿ç»­çš„å†…å­˜åŒºåŸŸã€‚å¦‚æœ size = 0ï¼Œå®é™…ä¸Š buf æ˜¯ä¸åˆ†é…ç©ºé—´çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;if elem.kind&amp;amp;kindNoPointers != 0 || size == 0 {
    // Allocate memory in one call.
    // Hchan does not contain pointers interesting for GC in this case:
    // buf points into the same allocation, elemtype is persistent.
    // SudoG&amp;#39;s are referenced from their owning thread so they can&amp;#39;t be collected.
    // TODO(dvyukov,rlh): Rethink when collector can move allocated objects.
    c = (*hchan)(mallocgc(hchanSize+uintptr(size)*elem.size, nil, true))
    if size &amp;gt; 0 &amp;amp;&amp;amp; elem.size != 0 {
        c.buf = add(unsafe.Pointer(c), hchanSize)
    } else {
        // race detector uses this location for synchronization
        // Also prevents us from pointing beyond the allocation (see issue 9401).
        c.buf = unsafe.Pointer(c)
    }
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;é™¤äº†ä¸Šé¢çš„æƒ…å†µï¼Œå‰©ä¸‹çš„ï¼Œä¹Ÿå°±æ˜¯ size &amp;gt; 0ï¼Œchannel å’Œ channel.buf æ˜¯åˆ†åˆ«è¿›è¡Œåˆ†é…çš„ã€‚å‰©ä¸‹çš„ä»£ç æ˜¯å‰©ä¸‹å­—æ®µçš„å¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;else {
        c = new(hchan)
        c.buf = newarray(elem, int(size))   // newarray ä¹Ÿæ˜¯è°ƒç”¨ mallocgc è¿›è¡Œå†…å­˜åˆ†é…
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;go 1.10çš„ä»£ç ï¼Œif else ä½¿ç”¨switch é‡å†™äº†&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;send&#34;&gt;send&lt;/h4&gt;

&lt;p&gt;send ä¹Ÿå°±æ˜¯ ch &amp;lt;- xï¼Œå¯¹åº”çš„å‡½æ•°å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// entry point for c &amp;lt;- x from compiled code
//go:nosplit
func chansend1(c *hchan, elem unsafe.Pointer) {
    chansend(c, elem, true, getcallerpc(unsafe.Pointer(&amp;amp;c)))
}

func chansend(c *hchan, ep unsafe.Pointer, block bool, callerpc uintptr) bool {
    if c == nil {
        if !block {
            return false
        }
        gopark(nil, nil, &amp;#34;chan send (nil chan)&amp;#34;, traceEvGoStop, 2)
        throw(&amp;#34;unreachable&amp;#34;)
    }
    ...
    
    if !block &amp;amp;&amp;amp; c.closed == 0 &amp;amp;&amp;amp; ((c.dataqsiz == 0 &amp;amp;&amp;amp; c.recvq.first == nil) ||
        (c.dataqsiz &amp;gt; 0 &amp;amp;&amp;amp; c.qcount == c.dataqsiz)) {
        return false
    }

    var t0 int64
    if blockprofilerate &amp;gt; 0 {
        t0 = cputicks()
    }

    lock(&amp;amp;c.lock)

    if c.closed != 0 {
        unlock(&amp;amp;c.lock)
        panic(plainError(&amp;#34;send on closed channel&amp;#34;))
    }

    if sg := c.recvq.dequeue(); sg != nil {
        // Found a waiting receiver. We pass the value we want to send
        // directly to the receiver, bypassing the channel buffer (if any).
        send(c, sg, ep, func() { unlock(&amp;amp;c.lock) }, 3)
        return true
    }

    if c.qcount &amp;lt; c.dataqsiz {
        // Space is available in the channel buffer. Enqueue the element to send.
        qp := chanbuf(c, c.sendx)
        if raceenabled {
            raceacquire(qp)
            racerelease(qp)
        }
        typedmemmove(c.elemtype, qp, ep)
        c.sendx++
        if c.sendx == c.dataqsiz {
            c.sendx = 0
        }
        c.qcount++
        unlock(&amp;amp;c.lock)
        return true
    }

    if !block {
        unlock(&amp;amp;c.lock)
        return false
    }

    // Block on the channel. Some receiver will complete our operation for us.
    gp := getg()
    mysg := acquireSudog()
    mysg.releasetime = 0
    if t0 != 0 {
        mysg.releasetime = -1
    }
    // No stack splits between assigning elem and enqueuing mysg
    // on gp.waiting where copystack can find it.
    mysg.elem = ep
    mysg.waitlink = nil
    mysg.g = gp
    mysg.selectdone = nil
    mysg.c = c
    gp.waiting = mysg
    gp.param = nil
    c.sendq.enqueue(mysg)
    goparkunlock(&amp;amp;c.lock, &amp;#34;chan send&amp;#34;, traceEvGoBlockSend, 3)

    // someone woke us up.
    if mysg != gp.waiting {
        throw(&amp;#34;G waiting list is corrupted&amp;#34;)
    }
    gp.waiting = nil
    if gp.param == nil {
        if c.closed == 0 {
            throw(&amp;#34;chansend: spurious wakeup&amp;#34;)
        }
        panic(plainError(&amp;#34;send on closed channel&amp;#34;))
    }
    gp.param = nil
    if mysg.releasetime &amp;gt; 0 {
        blockevent(mysg.releasetime-t0, 2)
    }
    mysg.c = nil
    releaseSudog(mysg)
    return true
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h5 id=&#34;nil-channel&#34;&gt;nil channel&lt;/h5&gt;

&lt;p&gt;å…ˆæ¥çœ‹ä¸€ä¸‹ nil channel çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å‘æ²¡æœ‰ make çš„ channel å‘é€æ•°æ®ã€‚ä¸Šç¯‡æ–‡ç«  æ·±å…¥ç†è§£ Go Channel ä¸­ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼šå‘ nil channel å‘é€æ•°æ®ä¼šæŠ¥ fatal error: all goroutines are asleep - deadlock! é”™è¯¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nf&#34;&gt;gopark&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;chan send (nil chan)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;traceEvGoStop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unreachable&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;//runtime/trace.go
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;traceEvGoStop&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// goroutine stops (like in select{}) [timestamp, stack]
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;//runtime/proc.go
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Puts the current goroutine into a waiting state and calls unlockf.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// If unlockf returns false, the goroutine is resumed.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// unlockf must not access this G&amp;#39;s stack, as it may be moved between
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// the call to gopark and the call to unlockf.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;gopark&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unlockf&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reason&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;traceEv&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;traceskip&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;gopark ä¼šå°†å½“å‰ goroutine ä¼‘çœ ï¼Œç„¶åé€šè¿‡ unlockf æ¥å”¤é†’ï¼Œæ³¨æ„æˆ‘ä»¬ä¸Šé¢ä¼ å…¥çš„ unlockf æ˜¯ nilï¼Œä¹Ÿå°±æ˜¯å‘ nil channel å‘é€æ•°æ®çš„ goroutine ä¼šä¸€ç›´ä¼‘çœ ã€‚åŒç†ï¼Œä» nil channel è¯»æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„å¤„ç†ã€‚æˆ‘ä»¬å†çœ‹ä¸€çœ¼ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¾‹å­ã€‚&lt;/p&gt;

&lt;h5 id=&#34;closed-channel&#34;&gt;closed channel&lt;/h5&gt;

&lt;p&gt;å‘ close çš„ channel å‘é€æ•°æ®ï¼Œç›´æ¥ panicã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;lock(&amp;amp;c.lock)

if c.closed != 0 {
    unlock(&amp;amp;c.lock)
    panic(plainError(&amp;#34;send on closed channel&amp;#34;))
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h5 id=&#34;å‘é€æ•°æ®å¤„ç†&#34;&gt;å‘é€æ•°æ®å¤„ç†&lt;/h5&gt;

&lt;p&gt;å‘é€æ•°æ®åˆ†ä¸‰ç§æƒ…å†µï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æœ‰ goroutine é˜»å¡åœ¨ channel ä¸Šï¼Œæ­¤æ—¶ hchan.buf ä¸ºç©ºï¼šç›´æ¥å°†æ•°æ®å‘é€ç»™è¯¥ goroutineã€‚&lt;/li&gt;
&lt;li&gt;å½“å‰ hchan.buf è¿˜æœ‰å¯ç”¨ç©ºé—´ï¼šå°†æ•°æ®æ”¾åˆ° buffer é‡Œé¢ã€‚&lt;/li&gt;
&lt;li&gt;å½“å‰ hchan.buf å·²æ»¡ï¼šé˜»å¡å½“å‰ goroutineã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç¬¬ä¸€ç§æƒ…å†µå¦‚ä¸‹ã€‚ä»å½“å‰ channel çš„ç­‰å¾…é˜Ÿåˆ—ä¸­å–å‡ºç­‰å¾…çš„ goroutineï¼Œç„¶åè°ƒç”¨ sendã€‚goready è´Ÿè´£å”¤é†’ goroutineã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;lock(&amp;amp;c.lock)

if sg := c.recvq.dequeue(); sg != nil {
    // Found a waiting receiver. We pass the value we want to send
    // directly to the receiver, bypassing the channel buffer (if any).
    send(c, sg, ep, func() { unlock(&amp;amp;c.lock) }, 3)
    return true
}

// send processes a send operation on an empty channel c.
// The value ep sent by the sender is copied to the receiver sg.
// The receiver is then woken up to go on its merry way.
// Channel c must be empty and locked.  send unlocks c with unlockf.
// sg must already be dequeued from c.
// ep must be non-nil and point to the heap or the caller&amp;#39;s stack.
func send(c *hchan, sg *sudog, ep unsafe.Pointer, unlockf func(), skip int) {
    ... 
    if sg.elem != nil {
        sendDirect(c.elemtype, sg, ep)
        sg.elem = nil
    }
    gp := sg.g
    unlockf()
    gp.param = unsafe.Pointer(sg)
    if sg.releasetime != 0 {
        sg.releasetime = cputicks()
    }
    goready(gp, skip+1)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç¬¬äºŒç§æƒ…å†µæ¯”è¾ƒç®€å•ã€‚é€šè¿‡æ¯”è¾ƒ qcount å’Œ dataqsiz æ¥åˆ¤æ–­ hchan.buf æ˜¯å¦è¿˜æœ‰å¯ç”¨ç©ºé—´ã€‚é™¤æ­¤ä¹‹åè¿˜éœ€è¦è°ƒæ•´ä¸€ä¸‹ sendx å’Œ qcountã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;lock(&amp;amp;c.lock)

if c.qcount &amp;lt; c.dataqsiz {
    // Space is available in the channel buffer. Enqueue the element to send.
    qp := chanbuf(c, c.sendx)
    if raceenabled {
        raceacquire(qp)
        racerelease(qp)
    }
    typedmemmove(c.elemtype, qp, ep)
    c.sendx++
    if c.sendx == c.dataqsiz {
        c.sendx = 0
    }
    c.qcount++
    unlock(&amp;amp;c.lock)
    return true
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;ç¬¬ä¸‰ç§æƒ…å†µå¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// Block on the channel. Some receiver will complete our operation for us.
gp := getg()
mysg := acquireSudog()
mysg.releasetime = 0
if t0 != 0 {
    mysg.releasetime = -1
}

mysg.elem = ep          // ä¸€äº›åˆå§‹åŒ–å·¥ä½œ
mysg.waitlink = nil
mysg.g = gp
mysg.selectdone = nil
mysg.c = c
gp.waiting = mysg
gp.param = nil
c.sendq.enqueue(mysg)   // å½“å‰ goroutine å¦‚ç­‰å¾…é˜Ÿåˆ—
goparkunlock(&amp;amp;c.lock, &amp;#34;chan send&amp;#34;, traceEvGoBlockSend, 3)   //ä¼‘çœ &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;recv&#34;&gt;recv&lt;/h4&gt;

&lt;p&gt;è¯»å– channel ï¼ˆ &amp;lt;-c ï¼‰å’Œå‘é€çš„æƒ…å†µéå¸¸ç±»ä¼¼&lt;/p&gt;

&lt;h5 id=&#34;nil-channel-1&#34;&gt;nil channel&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool) {
    if c == nil {
        if !block {
            return
        }
        gopark(nil, nil, &amp;#34;chan receive (nil chan)&amp;#34;, traceEvGoStop, 2)
        throw(&amp;#34;unreachable&amp;#34;)
    }
    ...
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h5 id=&#34;closed-channel-1&#34;&gt;closed channel&lt;/h5&gt;

&lt;p&gt;ä» closed channel æ¥æ”¶æ•°æ®ï¼Œå¦‚æœ channel ä¸­è¿˜æœ‰æ•°æ®ï¼Œæ¥ç€èµ°ä¸‹é¢çš„æµç¨‹ã€‚å¦‚æœå·²ç»æ²¡æœ‰æ•°æ®äº†ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ã€‚ä½¿ç”¨ ok-idiom æ–¹å¼è¯»å–çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªå‚æ•°è¿”å› false&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;lock(&amp;amp;c.lock)

if c.closed != 0 &amp;amp;&amp;amp; c.qcount == 0 {
    if raceenabled {
        raceacquire(unsafe.Pointer(c))
    }
    unlock(&amp;amp;c.lock)
    if ep != nil {
        typedmemclr(c.elemtype, ep)
    }
    return true, false
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h5 id=&#34;æ¥æ”¶æ•°æ®å¤„ç†&#34;&gt;æ¥æ”¶æ•°æ®å¤„ç†&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;130
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;131
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;132
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;133
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;134
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;135
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;136
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;137
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;138
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;139
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;140
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;141
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;142
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;143
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;144
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;145
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;146
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;147
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;148
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;149
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;150
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;151
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;152
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;153
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;154
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;155
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;156
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;157
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;158
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;159
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;160
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;161
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;162
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;163
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;164
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;165
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;166
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;167
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;168
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;169
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;170
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;171
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;172
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;173
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;174
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;175
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;176
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;177
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;178
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;179
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;180
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;181
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;182
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;183
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;184
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;185
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;186
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;187
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;188
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;189
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;190
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;191
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;192
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;193
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;194
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;195
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;196
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;197
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;198
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;199
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;200
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;201
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// entry points for &amp;lt;- c from compiled code
//go:nosplit
func chanrecv1(c *hchan, elem unsafe.Pointer) {
    chanrecv(c, elem, true)
}

//go:nosplit
func chanrecv2(c *hchan, elem unsafe.Pointer) (received bool) {
    _, received = chanrecv(c, elem, true)
    return
}


func chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool) {
    // raceenabled: don&amp;#39;t need to check ep, as it is always on the stack
    // or is new memory allocated by reflect.

    // å¦‚æœåœ¨ nil channel ä¸Šè¿›è¡Œ recv æ“ä½œï¼Œé‚£ä¹ˆä¼šæ°¸è¿œé˜»å¡
    if c == nil {
        if !block {
            // éé˜»å¡çš„æƒ…å†µä¸‹
            // è¦ç›´æ¥è¿”å›
            // éé˜»å¡å‡ºç°åœ¨ä¸€äº› select çš„åœºæ™¯ä¸­
            // å‚è§ selectnbrecv/selectnbrecv2
            return
        }
        // å½“å‰ goroutine: Grunning -&amp;gt; Gwaiting
        // å…¶å®å°±æ˜¯è¯¥ goroutine ç›´æ¥æ³„éœ² leak äº†
        gopark(nil, nil, &amp;#34;chan receive (nil chan)&amp;#34;, traceEvGoStop, 2)

        // æ”¾ä¸ª throw æœ‰ç‚¹è«åå…¶å¦™
        // ä¸è¿‡è¿™æ®µä»£ç ç¡®å®æ°¸è¿œè¾¾åˆ°ä¸äº†
        throw(&amp;#34;unreachable&amp;#34;)
    }

    // Fast path: check for failed non-blocking operation without acquiring the lock.
    //
    // After observing that the channel is not ready for receiving, we observe that the
    // channel is not closed. Each of these observations is a single word-sized read
    // (first c.sendq.first or c.qcount, and second c.closed).
    // Because a channel cannot be reopened, the later observation of the channel
    // being not closed implies that it was also not closed at the moment of the
    // first observation. We behave as if we observed the channel at that moment
    // and report that the receive cannot proceed.
    //
    // The order of operations is important here: reversing the operations can lead to
    // incorrect behavior when racing with a close.
    if !block &amp;amp;&amp;amp; (c.dataqsiz == 0 &amp;amp;&amp;amp; c.sendq.first == nil ||
        c.dataqsiz &amp;gt; 0 &amp;amp;&amp;amp; atomic.Loaduint(&amp;amp;c.qcount) == 0) &amp;amp;&amp;amp;
        atomic.Load(&amp;amp;c.closed) == 0 {
        // éé˜»å¡ä¸”æ²¡å†…å®¹å¯æ”¶çš„æƒ…å†µä¸‹è¦ç›´æ¥è¿”å›
        // ä¸¤ä¸ª bool çš„é›¶å€¼å°±æ˜¯ falseï¼Œfalse
        return
    }

    var t0 int64
    if blockprofilerate &amp;gt; 0 {
        t0 = cputicks()
    }

    lock(&amp;amp;c.lock)

    // å½“å‰ channel ä¸­æ²¡æœ‰æ•°æ®å¯è¯»
    // ç›´æ¥è¿”å› not selected
    if c.closed != 0 &amp;amp;&amp;amp; c.qcount == 0 {
        unlock(&amp;amp;c.lock)
        if ep != nil {
            typedmemclr(c.elemtype, ep)
        }
        return true, false
    }

    // sender é˜Ÿåˆ—ä¸­æœ‰ sudog åœ¨ç­‰å¾…
    // ç›´æ¥ä»è¯¥ sudog ä¸­è·å–æ•°æ®æ‹·è´åˆ°å½“å‰ g å³å¯
    if sg := c.sendq.dequeue(); sg != nil {
        // Found a waiting sender. If buffer is size 0, receive value
        // directly from sender. Otherwise, receive from head of queue
        // and add sender&amp;#39;s value to the tail of the queue (both map to
        // the same buffer slot because the queue is full).
        recv(c, sg, ep, func() { unlock(&amp;amp;c.lock) }, 3)
        return true, true
    }

    if c.qcount &amp;gt; 0 {
        // Receive directly from queue
        qp := chanbuf(c, c.recvx)

        // ç›´æ¥ä» buffer é‡Œæ‹·è´æ•°æ®
        if ep != nil {
            typedmemmove(c.elemtype, ep, qp)
        }
        typedmemclr(c.elemtype, qp)
        // æ¥æ”¶ç´¢å¼• +1
        c.recvx++
        if c.recvx == c.dataqsiz {
            c.recvx = 0
        }
        // buffer å…ƒç´ è®¡æ•° -1
        c.qcount--
        unlock(&amp;amp;c.lock)
        return true, true
    }

    if !block {
        unlock(&amp;amp;c.lock)
        // éé˜»å¡æ—¶ï¼Œä¸”æ— æ•°æ®å¯æ”¶
        // å§‹ç»ˆä¸é€‰ä¸­ï¼Œè¿™æ˜¯åœ¨ buffer ä¸­æ²¡å†…å®¹çš„æ—¶å€™
        return false, false
    }

    // no sender available: block on this channel.
    gp := getg()
    mysg := acquireSudog()
    mysg.releasetime = 0
    if t0 != 0 {
        mysg.releasetime = -1
    }
    // No stack splits between assigning elem and enqueuing mysg
    // on gp.waiting where copystack can find it.
    // æ‰“åŒ…æˆ sudog
    mysg.elem = ep
    mysg.waitlink = nil
    gp.waiting = mysg
    mysg.g = gp
    mysg.isSelect = false
    mysg.c = c
    gp.param = nil
    // è¿›å…¥ recvq é˜Ÿåˆ—
    c.recvq.enqueue(mysg)

    // Grunning -&amp;gt; Gwaiting
    goparkunlock(&amp;amp;c.lock, &amp;#34;chan receive&amp;#34;, traceEvGoBlockRecv, 3)

    // someone woke us up
    // è¢«å”¤é†’
    if mysg != gp.waiting {
        throw(&amp;#34;G waiting list is corrupted&amp;#34;)
    }
    gp.waiting = nil
    if mysg.releasetime &amp;gt; 0 {
        blockevent(mysg.releasetime-t0, 2)
    }
    closed := gp.param == nil
    gp.param = nil
    mysg.c = nil
    releaseSudog(mysg)
    // å¦‚æœ channel æœªè¢«å…³é—­ï¼Œé‚£å°±æ˜¯çœŸçš„ recv åˆ°æ•°æ®äº†
    return true, !closed
}

// recv processes a receive operation on a full channel c.
// There are 2 parts:
// 1) The value sent by the sender sg is put into the channel
//    and the sender is woken up to go on its merry way.
// 2) The value received by the receiver (the current G) is
//    written to ep.
// For synchronous channels, both values are the same.
// For asynchronous channels, the receiver gets its data from
// the channel buffer and the sender&amp;#39;s data is put in the
// channel buffer.
// Channel c must be full and locked. recv unlocks c with unlockf.
// sg must already be dequeued from c.
// A non-nil ep must point to the heap or the caller&amp;#39;s stack.
func recv(c *hchan, sg *sudog, ep unsafe.Pointer, unlockf func(), skip int) {
    if c.dataqsiz == 0 {
        if ep != nil {
            // copy data from sender
            recvDirect(c.elemtype, sg, ep)
        }
    } else {
        // Queue is full. Take the item at the
        // head of the queue. Make the sender enqueue
        // its item at the tail of the queue. Since the
        // queue is full, those are both the same slot.
        qp := chanbuf(c, c.recvx)

        // copy data from queue to receiver
        // è‹±æ–‡å†™çš„å¾ˆæ˜ç™½
        if ep != nil {
            typedmemmove(c.elemtype, ep, qp)
        }
        // copy data from sender to queue
        // è‹±æ–‡å†™çš„å¾ˆæ˜ç™½
        typedmemmove(c.elemtype, qp, sg.elem)
        c.recvx++
        if c.recvx == c.dataqsiz {
            c.recvx = 0
        }
        c.sendx = c.recvx // c.sendx = (c.sendx+1) % c.dataqsiz
    }
    sg.elem = nil
    gp := sg.g
    unlockf()
    gp.param = unsafe.Pointer(sg)
    if sg.releasetime != 0 {
        sg.releasetime = cputicks()
    }

    // Gwaiting -&amp;gt; Grunnable
    goready(gp, skip+1)
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;å…³é—­channel&#34;&gt;å…³é—­channel&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;func closechan(c *hchan) {
    if c == nil {
        panic(plainError(&amp;#34;close of nil channel&amp;#34;))
    }

    lock(&amp;amp;c.lock)
    if c.closed != 0 {
        unlock(&amp;amp;c.lock)
        panic(plainError(&amp;#34;close of closed channel&amp;#34;))
    }

    c.closed = 1

    var glist *g

    // release all readers
    for {
        sg := c.recvq.dequeue()
        if sg == nil {
            break
        }
        if sg.elem != nil {
            typedmemclr(c.elemtype, sg.elem)
            sg.elem = nil
        }
        if sg.releasetime != 0 {
            sg.releasetime = cputicks()
        }
        gp := sg.g
        gp.param = nil
        if raceenabled {
            raceacquireg(gp, unsafe.Pointer(c))
        }
        gp.schedlink.set(glist)
        glist = gp
    }

    // release all writers (they will panic)
    for {
        sg := c.sendq.dequeue()
        if sg == nil {
            break
        }
        sg.elem = nil
        if sg.releasetime != 0 {
            sg.releasetime = cputicks()
        }
        gp := sg.g
        gp.param = nil
        if raceenabled {
            raceacquireg(gp, unsafe.Pointer(c))
        }
        gp.schedlink.set(glist)
        glist = gp
    }
    unlock(&amp;amp;c.lock)

    // Ready all Gs now that we&amp;#39;ve dropped the channel lock.
    for glist != nil {
        gp := glist
        glist = glist.schedlink.ptr()
        gp.schedlink = 0
        goready(gp, 3)
    }
}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;close channel çš„å·¥ä½œé™¤äº†å°† c.closed è®¾ç½®ä¸º 1ã€‚è¿˜éœ€è¦ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å”¤é†’ recvq é˜Ÿåˆ—é‡Œé¢çš„é˜»å¡ goroutine&lt;/li&gt;
&lt;li&gt;å”¤é†’ sendq é˜Ÿåˆ—é‡Œé¢çš„é˜»å¡ goroutine
å¤„ç†æ–¹å¼æ˜¯åˆ†åˆ«éå† recvq å’Œ sendq é˜Ÿåˆ—ï¼Œå°†æ‰€æœ‰çš„ goroutine æ”¾åˆ° glist é˜Ÿåˆ—ä¸­ï¼Œæœ€åå”¤é†’ glist é˜Ÿåˆ—ä¸­çš„ goroutineã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;

&lt;h3 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://my.oschina.net/renhc/blog/2246871&#34;&gt;https://my.oschina.net/renhc/blog/2246871&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://legendtkl.com/2017/08/06/golang-channel-implement/&#34;&gt;http://legendtkl.com/2017/08/06/golang-channel-implement/&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;http://xargin.com/channel-from-usage-to-src-analysis/&#34;&gt;http://xargin.com/channel-from-usage-to-src-analysis/&lt;/a&gt;
&lt;a href=&#34;http://legendtkl.com/2017/07/30/understanding-golang-channel/&#34;&gt;http://legendtkl.com/2017/07/30/understanding-golang-channel/&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>[è½¬]golang åå°„</title>
      <link>https://jayhong.github.io/post/20190306-golang%E5%8F%8D%E5%B0%84/</link>
      <pubDate>Wed, 06 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190306-golang%E5%8F%8D%E5%B0%84/</guid>
      
        <description>

&lt;p&gt;è½¬è‡ª &lt;a href=&#34;https://juejin.im/post/5a75a4fb5188257a82110544#heading-2&#34;&gt;https://juejin.im/post/5a75a4fb5188257a82110544#heading-2&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯åå°„&#34;&gt;ä»€ä¹ˆæ˜¯åå°„&lt;/h2&gt;

&lt;p&gt;åå°„åœ¨è®¡ç®—æœºé¢†åŸŸæ˜¯ä¸€ç§èƒ½å¤Ÿé€šè¿‡ç±»å‹æ¥æ£€æŸ¥è‡ªå·±çš„å€¼çš„èƒ½åŠ›ï¼Œåœ¨golangä¸­åå°„æä¾›äº†ä¸€ç§æœºåˆ¶åœ¨è¿è¡Œæ—¶æ›´æ–°å˜é‡å’Œæ£€æŸ¥å®ƒä»¬çš„å€¼ã€è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•å’Œå®ƒä»¬æ”¯æŒçš„å†…åœ¨æ“ä½œï¼Œ
ä½†æ˜¯åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“è¿™äº›å˜é‡çš„å…·ä½“ç±»å‹ã€‚ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æä¾›çš„åå°„æœºåˆ¶ä¸ä¸€æ ·ã€‚&lt;/p&gt;

&lt;h2 id=&#34;types-å’Œ-interfaces&#34;&gt;Types å’Œ interfaces&lt;/h2&gt;

&lt;p&gt;å­¦ä¹ æ”¾å°„é¦–å…ˆè¦çŸ¥é“golangä¸­å…³äºç±»å‹çš„ä¸€äº›åŸåˆ™&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å˜é‡åŒ…æ‹¬typeï¼Œvalue ä¸¤éƒ¨åˆ†&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;type åŒ…æ‹¬ static typeå’Œconcrete type. ç®€å•æ¥è¯´ static typeæ˜¯ä½ åœ¨ç¼–ç æ˜¯çœ‹è§çš„ç±»å‹(å¦‚intã€string)ï¼Œconcrete typeæ˜¯runtimeç³»ç»Ÿçœ‹è§çš„ç±»å‹&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;ç±»å‹æ–­è¨€èƒ½å¦æˆåŠŸï¼Œå–å†³äºå˜é‡çš„concrete typeï¼Œè€Œä¸æ˜¯static type. å› æ­¤ï¼Œä¸€ä¸ª readerå˜é‡å¦‚æœå®ƒçš„concrete typeä¹Ÿå®ç°äº†writeæ–¹æ³•çš„è¯ï¼Œå®ƒä¹Ÿå¯ä»¥è¢«ç±»å‹æ–­è¨€ä¸ºwriter.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¥ä¸‹æ¥è¦è®²çš„åå°„ï¼Œå°±æ˜¯å»ºç«‹åœ¨ç±»å‹ä¹‹ä¸Šçš„ï¼ŒGolangçš„æŒ‡å®šç±»å‹çš„å˜é‡çš„ç±»å‹æ˜¯é™æ€çš„ï¼ˆä¹Ÿå°±æ˜¯æŒ‡å®šintã€stringè¿™äº›çš„å˜é‡ï¼Œå®ƒçš„typeæ˜¯static typeï¼‰ï¼Œ
åœ¨åˆ›å»ºå˜é‡çš„æ—¶å€™å°±å·²ç»ç¡®å®šï¼Œåå°„ä¸»è¦ä¸Golangçš„interfaceç±»å‹ç›¸å…³ï¼ˆå®ƒçš„typeæ˜¯concrete typeï¼‰ï¼Œåªæœ‰interfaceç±»å‹æ‰æœ‰åå°„ä¸€è¯´ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨Golangçš„å®ç°ä¸­ï¼Œæ¯ä¸ªinterfaceå˜é‡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”pairï¼Œpairä¸­è®°å½•äº†å®é™…å˜é‡çš„å€¼å’Œç±»å‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;(value, type)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;valueæ˜¯å®é™…å˜é‡å€¼ï¼Œtypeæ˜¯å®é™…å˜é‡çš„ç±»å‹ã€‚ä¸€ä¸ªinterface{}ç±»å‹çš„å˜é‡åŒ…å«äº†2ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å€¼çš„ç±»å‹ã€å¯¹åº”concrete typeã€‘ï¼Œå¦å¤–ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®é™…çš„å€¼ã€å¯¹åº”valueã€‘ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;var r io.Reader
tty, err := os.OpenFile(&amp;#34;/dev/tty&amp;#34;, os.O_RDWR, 0)
if err != nil {
    return nil, err
}
r = tty&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ¥å£å˜é‡rçš„pairä¸­å°†è®°å½•å¦‚ä¸‹ä¿¡æ¯ï¼š(tty, *os.File)ï¼Œè¿™ä¸ªpairåœ¨æ¥å£å˜é‡çš„è¿ç»­èµ‹å€¼è¿‡ç¨‹ä¸­æ˜¯ä¸å˜çš„ï¼Œå°†æ¥å£å˜é‡rèµ‹ç»™å¦ä¸€ä¸ªæ¥å£å˜é‡w:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;var w io.Writer
w = r.(io.Writer)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;æ¥å£å˜é‡wçš„pairä¸rçš„pairç›¸åŒï¼Œéƒ½æ˜¯:(tty, *os.File)ï¼Œå³ä½¿wæ˜¯ç©ºæ¥å£ç±»å‹ï¼Œpairä¹Ÿæ˜¯ä¸å˜çš„ã€‚
interfaceåŠå…¶pairçš„å­˜åœ¨ï¼Œæ˜¯Golangä¸­å®ç°åå°„çš„å‰æï¼Œç†è§£äº†pairï¼Œå°±æ›´å®¹æ˜“ç†è§£åå°„ã€‚åå°„å°±æ˜¯ç”¨æ¥æ£€æµ‹å­˜å‚¨åœ¨æ¥å£å˜é‡å†…éƒ¨(å€¼valueï¼›ç±»å‹concrete type) pairå¯¹çš„ä¸€ç§æœºåˆ¶ã€‚&lt;/p&gt;

&lt;h2 id=&#34;golangä¸­çš„åå°„&#34;&gt;golangä¸­çš„åå°„&lt;/h2&gt;

&lt;h4 id=&#34;reflectçš„åŸºæœ¬åŠŸèƒ½typeofå’Œvalueof&#34;&gt;reflectçš„åŸºæœ¬åŠŸèƒ½TypeOfå’ŒValueOf&lt;/h4&gt;

&lt;p&gt;æ—¢ç„¶åå°„å°±æ˜¯ç”¨æ¥æ£€æµ‹å­˜å‚¨åœ¨æ¥å£å˜é‡å†…éƒ¨(å€¼valueï¼›ç±»å‹concrete type) pairå¯¹çš„ä¸€ç§æœºåˆ¶ã€‚é‚£ä¹ˆåœ¨Golangçš„reflectåå°„åŒ…ä¸­æœ‰ä»€ä¹ˆæ ·çš„æ–¹å¼å¯ä»¥è®©æˆ‘ä»¬ç›´æ¥è·å–åˆ°å˜é‡å†…éƒ¨çš„ä¿¡æ¯å‘¢ï¼Ÿ
æä¾›äº†ä¸¤ç§ç±»å‹ï¼ˆæˆ–è€…è¯´ä¸¤ä¸ªæ–¹æ³•ï¼‰è®©æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„è®¿é—®æ¥å£å˜é‡å†…å®¹ï¼Œåˆ†åˆ«æ˜¯reflect.ValueOf() å’Œ reflect.TypeOf()ï¼Œçœ‹çœ‹å®˜æ–¹çš„è§£é‡Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// ValueOf returns a new Value initialized to the concrete value
// stored in the interface i.  ValueOf(nil) returns the zero 
func ValueOf(i interface{}) Value {...}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;// TypeOf returns the reflection Type that represents the dynamic type of i.
// If i is a nil interface value, TypeOf returns nil.
func TypeOf(i interface{}) Type {...}&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;reflect.TypeOf()æ˜¯è·å–pairä¸­çš„typeï¼Œreflect.ValueOf()è·å–pairä¸­çš„valueï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;3.4&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;type:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TypeOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;value: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;nx&#34;&gt;è¿è¡Œç»“æœ&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mf&#34;&gt;3.4&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h5 id=&#34;è¯´æ˜&#34;&gt;è¯´æ˜&lt;/h5&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;reflect.TypeOfï¼š ç›´æ¥ç»™åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„typeç±»å‹ï¼Œå¦‚float64ã€intã€å„ç§pointerã€struct ç­‰ç­‰çœŸå®çš„ç±»å‹&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;reflect.ValueOfï¼šç›´æ¥ç»™åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„å…·ä½“çš„å€¼ï¼Œå¦‚1.2345è¿™ä¸ªå…·ä½“æ•°å€¼ï¼Œæˆ–è€…ç±»ä¼¼&amp;amp;{1 &amp;ldquo;Allen.Wu&amp;rdquo; 25} è¿™æ ·çš„ç»“æ„ä½“structçš„å€¼&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´æ˜åå°„å¯ä»¥å°†â€œæ¥å£ç±»å‹å˜é‡â€è½¬æ¢ä¸ºâ€œåå°„ç±»å‹å¯¹è±¡â€ï¼Œåå°„ç±»å‹æŒ‡çš„æ˜¯reflect.Typeå’Œreflect.Valueè¿™ä¸¤ç§&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;ä»relfect-valueä¸­è·å–æ¥å£interfaceçš„ä¿¡æ¯&#34;&gt;ä»relfect.Valueä¸­è·å–æ¥å£interfaceçš„ä¿¡æ¯&lt;/h4&gt;

&lt;p&gt;å½“æ‰§è¡Œreflect.ValueOf(interface)ä¹‹åï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªç±»å‹ä¸ºâ€relfect.Valueâ€å˜é‡ï¼Œå¯ä»¥é€šè¿‡å®ƒæœ¬èº«çš„Interface()æ–¹æ³•è·å¾—æ¥å£å˜é‡çš„çœŸå®å†…å®¹ï¼Œ
ç„¶åå¯ä»¥é€šè¿‡ç±»å‹åˆ¤æ–­è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢ä¸ºåŸæœ‰çœŸå®ç±»å‹ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯èƒ½æ˜¯å·²çŸ¥åŸæœ‰ç±»å‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æœªçŸ¥åŸæœ‰ç±»å‹ï¼Œå› æ­¤ï¼Œä¸‹é¢åˆ†ä¸¤ç§æƒ…å†µè¿›è¡Œè¯´æ˜ã€‚&lt;/p&gt;

&lt;h5 id=&#34;å·²çŸ¥åŸæœ‰ç±»å‹-è¿›è¡Œ-å¼ºåˆ¶è½¬æ¢&#34;&gt;å·²çŸ¥åŸæœ‰ç±»å‹ã€è¿›è¡Œâ€œå¼ºåˆ¶è½¬æ¢â€ã€‘&lt;/h5&gt;

&lt;p&gt;å·²çŸ¥ç±»å‹åè½¬æ¢ä¸ºå…¶å¯¹åº”çš„ç±»å‹çš„åšæ³•å¦‚ä¸‹ï¼Œç›´æ¥é€šè¿‡Interfaceæ–¹æ³•ç„¶åå¼ºåˆ¶è½¬æ¢ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;realValue := value.Interface().(å·²çŸ¥çš„ç±»å‹)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1.2345&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// å¯ä»¥ç†è§£ä¸ºâ€œå¼ºåˆ¶è½¬æ¢â€ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ—¶å€™ï¼Œè½¬æ¢çš„æ—¶å€™ï¼Œå¦‚æœè½¬æ¢çš„ç±»å‹ä¸å®Œå…¨ç¬¦åˆï¼Œåˆ™ç›´æ¥panic
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// Golang å¯¹ç±»å‹è¦æ±‚éå¸¸ä¸¥æ ¼ï¼Œç±»å‹ä¸€å®šè¦å®Œå…¨ç¬¦åˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚ä¸‹ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯*float64ï¼Œä¸€ä¸ªæ˜¯float64ï¼Œå¦‚æœå¼„æ··ï¼Œåˆ™ä¼španic
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;convertPointer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;convertValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;convertPointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;convertValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;nx&#34;&gt;è¿è¡Œç»“æœ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
&lt;span class=&#34;mh&#34;&gt;0xc42000e238&lt;/span&gt;
&lt;span class=&#34;mf&#34;&gt;1.2345&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h5 id=&#34;è¯´æ˜-1&#34;&gt;è¯´æ˜&lt;/h5&gt;

&lt;ul&gt;
&lt;li&gt;è½¬æ¢çš„æ—¶å€™ï¼Œå¦‚æœè½¬æ¢çš„ç±»å‹ä¸å®Œå…¨ç¬¦åˆï¼Œåˆ™ç›´æ¥panicï¼Œç±»å‹è¦æ±‚éå¸¸ä¸¥æ ¼ï¼&lt;/li&gt;
&lt;li&gt;è½¬æ¢çš„æ—¶å€™ï¼Œè¦åŒºåˆ†æ˜¯æŒ‡é’ˆè¿˜æ˜¯å€¼&lt;/li&gt;
&lt;li&gt;ä¹Ÿå°±æ˜¯è¯´åå°„å¯ä»¥å°†â€œåå°„ç±»å‹å¯¹è±¡â€å†é‡æ–°è½¬æ¢ä¸ºâ€œæ¥å£ç±»å‹å˜é‡â€&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;æœªçŸ¥åŸæœ‰ç±»å‹-éå†æ¢æµ‹å…¶filed&#34;&gt;æœªçŸ¥åŸæœ‰ç±»å‹ã€éå†æ¢æµ‹å…¶Filedã€‘&lt;/h4&gt;

&lt;p&gt;å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½å¹¶ä¸çŸ¥é“å…¶å…·ä½“ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œè¯¥å¦‚ä½•åšå‘¢ï¼Ÿéœ€è¦æˆ‘ä»¬è¿›è¡Œéå†æ¢æµ‹å…¶Filedæ¥å¾—çŸ¥ï¼Œç¤ºä¾‹å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;Age&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;u&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ReflectCallFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Allen.Wu ReflectCallFunc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Allen.Wu&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;nf&#34;&gt;DoFiledAndMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// é€šè¿‡æ¥å£æ¥è·å–ä»»æ„å‚æ•°ï¼Œç„¶åä¸€ä¸€æ­æ™“
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;DoFiledAndMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;getType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TypeOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;get Type is :&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;getValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;get all Fields is:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// è·å–æ–¹æ³•å­—æ®µ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 1. å…ˆè·å–interfaceçš„reflect.Typeï¼Œç„¶åé€šè¿‡NumFieldè¿›è¡Œéå†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 2. å†é€šè¿‡reflect.Typeçš„Fieldè·å–å…¶Field
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 3. æœ€åé€šè¿‡Fieldçš„Interface()å¾—åˆ°å¯¹åº”çš„value
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NumField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;field&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Field&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Field&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: %v = %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;field&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;field&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// è·å–æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 1. å…ˆè·å–interfaceçš„reflect.Typeï¼Œç„¶åé€šè¿‡.NumMethodè¿›è¡Œéå†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NumMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;nx&#34;&gt;è¿è¡Œç»“æœ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;all&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Fields&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Allen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Wu&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Allen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Wu&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;Age&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;ReflectCallFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h5 id=&#34;è¯´æ˜-2&#34;&gt;è¯´æ˜&lt;/h5&gt;

&lt;p&gt;é€šè¿‡è¿è¡Œç»“æœå¯ä»¥å¾—çŸ¥è·å–æœªçŸ¥ç±»å‹çš„interfaceçš„å…·ä½“å˜é‡åŠå…¶ç±»å‹çš„æ­¥éª¤ä¸ºï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å…ˆè·å–interfaceçš„reflect.Typeï¼Œç„¶åé€šè¿‡NumFieldè¿›è¡Œéå†&lt;/li&gt;
&lt;li&gt;å†é€šè¿‡reflect.Typeçš„Fieldè·å–å…¶&lt;code&gt;Field&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æœ€åé€šè¿‡Fieldçš„Interface()å¾—åˆ°å¯¹åº”çš„value&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€šè¿‡è¿è¡Œç»“æœå¯ä»¥å¾—çŸ¥è·å–æœªçŸ¥ç±»å‹çš„interfaceçš„æ‰€å±æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰çš„æ­¥éª¤ä¸ºï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å…ˆè·å–interfaceçš„reflect.Typeï¼Œç„¶åé€šè¿‡NumMethodè¿›è¡Œéå†&lt;/li&gt;
&lt;li&gt;å†åˆ†åˆ«é€šè¿‡reflect.Typeçš„&lt;code&gt;Method&lt;/code&gt;è·å–å¯¹åº”çš„çœŸå®çš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰&lt;/li&gt;
&lt;li&gt;æœ€åå¯¹ç»“æœå–å…¶Nameå’ŒTypeå¾—çŸ¥å…·ä½“çš„æ–¹æ³•å&lt;/li&gt;
&lt;li&gt;ä¹Ÿå°±æ˜¯è¯´åå°„å¯ä»¥å°†â€œåå°„ç±»å‹å¯¹è±¡â€å†é‡æ–°è½¬æ¢ä¸ºâ€œæ¥å£ç±»å‹å˜é‡â€
struct æˆ–è€… struct çš„åµŒå¥—éƒ½æ˜¯ä¸€æ ·çš„åˆ¤æ–­å¤„ç†æ–¹å¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;é€šè¿‡reflect-valueè®¾ç½®å®é™…å˜é‡çš„å€¼&#34;&gt;é€šè¿‡reflect.Valueè®¾ç½®å®é™…å˜é‡çš„å€¼&lt;/h4&gt;

&lt;p&gt;reflect.Valueæ˜¯é€šè¿‡reflect.ValueOf(X)è·å¾—çš„ï¼Œåªæœ‰å½“Xæ˜¯æŒ‡é’ˆçš„æ—¶å€™ï¼Œæ‰å¯ä»¥é€šè¿‡reflec.Valueä¿®æ”¹å®é™…å˜é‡Xçš„å€¼ï¼Œå³ï¼šè¦ä¿®æ”¹åå°„ç±»å‹çš„å¯¹è±¡å°±ä¸€å®šè¦ä¿è¯å…¶å€¼æ˜¯â€œaddressableâ€çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1.2345&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;old value of pointer:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// é€šè¿‡reflect.ValueOfè·å–numä¸­çš„reflect.Valueï¼Œæ³¨æ„ï¼Œå‚æ•°å¿…é¡»æ˜¯æŒ‡é’ˆæ‰èƒ½ä¿®æ”¹å…¶å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;newValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;type of pointer:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;settability of pointer:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CanSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// é‡æ–°èµ‹å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;newValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SetFloat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;77&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;new value of pointer:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;////////////////////
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœreflect.ValueOfçš„å‚æ•°ä¸æ˜¯æŒ‡é’ˆï¼Œä¼šå¦‚ä½•ï¼Ÿ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;//newValue = pointer.Elem() // å¦‚æœéæŒ‡é’ˆï¼Œè¿™é‡Œç›´æ¥panicï¼Œâ€œpanic: reflect: call of reflect.Value.Elem on float64 Valueâ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;nx&#34;&gt;è¿è¡Œç»“æœ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1.2345&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;settability&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;77&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯* float64è¿™ä¸ªæŒ‡é’ˆï¼Œç„¶åå¯ä»¥é€šè¿‡pointer.Elem()å»è·å–æ‰€æŒ‡å‘çš„Valueï¼Œæ³¨æ„ä¸€å®šè¦æ˜¯æŒ‡é’ˆã€‚&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¦‚æœä¼ å…¥çš„å‚æ•°ä¸æ˜¯æŒ‡é’ˆï¼Œè€Œæ˜¯å˜é‡ï¼Œé‚£ä¹ˆ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é€šè¿‡Elemè·å–åŸå§‹å€¼å¯¹åº”çš„å¯¹è±¡åˆ™ç›´æ¥panic&lt;/li&gt;
&lt;li&gt;é€šè¿‡CanSetæ–¹æ³•æŸ¥è¯¢æ˜¯å¦å¯ä»¥è®¾ç½®è¿”å›false&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;newValue.CantSet()è¡¨ç¤ºæ˜¯å¦å¯ä»¥é‡æ–°è®¾ç½®å…¶å€¼ï¼Œå¦‚æœè¾“å‡ºçš„æ˜¯trueåˆ™å¯ä¿®æ”¹ï¼Œå¦åˆ™ä¸èƒ½ä¿®æ”¹ï¼Œä¿®æ”¹å®Œä¹‹åå†è¿›è¡Œæ‰“å°å‘ç°çœŸçš„å·²ç»ä¿®æ”¹äº†ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;reflect.Value.Elem() è¡¨ç¤ºè·å–åŸå§‹å€¼å¯¹åº”çš„åå°„å¯¹è±¡ï¼Œåªæœ‰åŸå§‹å¯¹è±¡æ‰èƒ½ä¿®æ”¹ï¼Œå½“å‰åå°„å¯¹è±¡æ˜¯ä¸èƒ½ä¿®æ”¹çš„&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å¦‚æœè¦ä¿®æ”¹åå°„ç±»å‹å¯¹è±¡ï¼Œå…¶å€¼å¿…é¡»æ˜¯â€œaddressableâ€ã€å¯¹åº”çš„è¦ä¼ å…¥çš„æ˜¯æŒ‡é’ˆï¼ŒåŒæ—¶è¦é€šè¿‡Elemæ–¹æ³•è·å–åŸå§‹å€¼å¯¹åº”çš„åå°„å¯¹è±¡ã€‘&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;struct æˆ–è€… struct çš„åµŒå¥—éƒ½æ˜¯ä¸€æ ·çš„åˆ¤æ–­å¤„ç†æ–¹å¼&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;é€šè¿‡reflect-valueofæ¥è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨&#34;&gt;é€šè¿‡reflect.ValueOfæ¥è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨&lt;/h4&gt;

&lt;p&gt;è¿™ç®—æ˜¯ä¸€ä¸ªé«˜çº§ç”¨æ³•äº†ï¼Œå‰é¢æˆ‘ä»¬åªè¯´åˆ°å¯¹ç±»å‹ã€å˜é‡çš„å‡ ç§åå°„çš„ç”¨æ³•ï¼ŒåŒ…æ‹¬å¦‚ä½•è·å–å…¶å€¼ã€å…¶ç±»å‹ã€å¦‚æœé‡æ–°è®¾ç½®æ–°å€¼ã€‚ä½†æ˜¯åœ¨å·¥ç¨‹åº”ç”¨ä¸­ï¼Œå¦å¤–ä¸€ä¸ªå¸¸ç”¨å¹¶ä¸”å±äºé«˜çº§çš„ç”¨æ³•ï¼Œå°±æ˜¯é€šè¿‡reflectæ¥è¿›è¡Œæ–¹æ³•ã€å‡½æ•°ã€‘çš„è°ƒç”¨ã€‚æ¯”å¦‚æˆ‘ä»¬è¦åšæ¡†æ¶å·¥ç¨‹çš„æ—¶å€™ï¼Œéœ€è¦å¯ä»¥éšæ„æ‰©å±•æ–¹æ³•ï¼Œæˆ–è€…è¯´ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ä»€ä¹ˆæ‰‹æ®µæ¥æ‰©å±•è®©ç”¨æˆ·èƒ½å¤Ÿè‡ªå®šä¹‰å‘¢ï¼Ÿå…³é”®ç‚¹åœ¨äºç”¨æˆ·çš„è‡ªå®šä¹‰æ–¹æ³•æ˜¯æœªå¯çŸ¥çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡reflectæ¥æå®š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;s&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;Age&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;u&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ReflectCallFuncHasArgs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;age&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ReflectCallFuncHasArgs name: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;, age:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;age&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;and origal User.Name:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;u&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ReflectCallFuncNoArgs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ReflectCallFuncNoArgs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å¦‚ä½•é€šè¿‡åå°„æ¥è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨ï¼Ÿ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// æœ¬æ¥å¯ä»¥ç”¨u.ReflectCallFuncXXXç›´æ¥è°ƒç”¨çš„ï¼Œä½†æ˜¯å¦‚æœè¦é€šè¿‡åå°„ï¼Œé‚£ä¹ˆé¦–å…ˆè¦å°†æ–¹æ³•æ³¨å†Œï¼Œä¹Ÿå°±æ˜¯MethodByNameï¼Œç„¶åé€šè¿‡åå°„è°ƒåŠ¨mv.Call
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Allen.Wu&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    
    &lt;span class=&#34;c1&#34;&gt;// 1. è¦é€šè¿‡åå°„æ¥è°ƒç”¨èµ·å¯¹åº”çš„æ–¹æ³•ï¼Œå¿…é¡»è¦å…ˆé€šè¿‡reflect.ValueOf(interface)æ¥è·å–åˆ°reflect.Valueï¼Œå¾—åˆ°â€œåå°„ç±»å‹å¯¹è±¡â€åæ‰èƒ½åšä¸‹ä¸€æ­¥å¤„ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;getValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// ä¸€å®šè¦æŒ‡å®šå‚æ•°ä¸ºæ­£ç¡®çš„æ–¹æ³•å
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 2. å…ˆçœ‹çœ‹å¸¦æœ‰å‚æ•°çš„è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;methodValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MethodByName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ReflectCallFuncHasArgs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;wudebao&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;methodValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// ä¸€å®šè¦æŒ‡å®šå‚æ•°ä¸ºæ­£ç¡®çš„æ–¹æ³•å
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 3. å†çœ‹çœ‹æ— å‚æ•°çš„è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;methodValue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MethodByName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ReflectCallFuncNoArgs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;methodValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;


&lt;span class=&#34;nx&#34;&gt;è¿è¡Œç»“æœ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;ReflectCallFuncHasArgs&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;wudebao&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;age&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;origal&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Allen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Wu&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;ReflectCallFuncNoArgs&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;è¯´æ˜&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è¦é€šè¿‡åå°„æ¥è°ƒç”¨èµ·å¯¹åº”çš„æ–¹æ³•ï¼Œå¿…é¡»è¦å…ˆé€šè¿‡reflect.ValueOf(interface)æ¥è·å–åˆ°reflect.Valueï¼Œå¾—åˆ°â€œåå°„ç±»å‹å¯¹è±¡â€åæ‰èƒ½åšä¸‹ä¸€æ­¥å¤„ç†&lt;/li&gt;
&lt;li&gt;reflect.Value.MethodByNameè¿™.MethodByNameï¼Œéœ€è¦æŒ‡å®šå‡†ç¡®çœŸå®çš„æ–¹æ³•åå­—ï¼Œå¦‚æœé”™è¯¯å°†ç›´æ¥panicï¼ŒMethodByNameè¿”å›ä¸€ä¸ªå‡½æ•°å€¼å¯¹åº”çš„reflect.Valueæ–¹æ³•çš„åå­—ã€‚&lt;/li&gt;
&lt;li&gt;[]reflect.Valueï¼Œè¿™ä¸ªæ˜¯æœ€ç»ˆéœ€è¦è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥æ²¡æœ‰æˆ–è€…ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼Œæ ¹æ®å®é™…å‚æ•°æ¥å®šã€‚&lt;/li&gt;
&lt;li&gt;reflect.Valueçš„ Call è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†æœ€ç»ˆè°ƒç”¨çœŸå®çš„æ–¹æ³•ï¼Œå‚æ•°åŠ¡å¿…ä¿æŒä¸€è‡´ï¼Œå¦‚æœreflect.Value&amp;rsquo;Kindä¸æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°†ç›´æ¥panicã€‚&lt;/li&gt;
&lt;li&gt;æœ¬æ¥å¯ä»¥ç”¨u.ReflectCallFuncXXXç›´æ¥è°ƒç”¨çš„ï¼Œä½†æ˜¯å¦‚æœè¦é€šè¿‡åå°„ï¼Œé‚£ä¹ˆé¦–å…ˆè¦å°†æ–¹æ³•æ³¨å†Œï¼Œä¹Ÿå°±æ˜¯MethodByNameï¼Œç„¶åé€šè¿‡åå°„è°ƒç”¨methodValue.Call&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;jsonè½¬ç çš„ä¾‹å­&#34;&gt;jsonè½¬ç çš„ä¾‹å­&lt;/h4&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;ä¸Šè¿°è¯¦ç»†è¯´æ˜äº†Golangçš„åå°„reflectçš„å„ç§åŠŸèƒ½å’Œç”¨æ³•ï¼Œéƒ½é™„å¸¦æœ‰ç›¸åº”çš„ç¤ºä¾‹ï¼Œç›¸ä¿¡èƒ½å¤Ÿåœ¨å·¥ç¨‹åº”ç”¨ä¸­è¿›è¡Œç›¸åº”å®è·µï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;åå°„å¯ä»¥å¤§å¤§æé«˜ç¨‹åºçš„çµæ´»æ€§ï¼Œä½¿å¾—interface{}æœ‰æ›´å¤§çš„å‘æŒ¥ä½™åœ°&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åå°„å¿…é¡»ç»“åˆinterfaceæ‰ç©å¾—è½¬&lt;/li&gt;
&lt;li&gt;å˜é‡çš„typeè¦æ˜¯concrete typeçš„ï¼ˆä¹Ÿå°±æ˜¯interfaceå˜é‡ï¼‰æ‰æœ‰åå°„ä¸€è¯´&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åå°„å¯ä»¥å°†â€œæ¥å£ç±»å‹å˜é‡â€è½¬æ¢ä¸ºâ€œåå°„ç±»å‹å¯¹è±¡â€&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åå°„ä½¿ç”¨ TypeOf å’Œ ValueOf å‡½æ•°ä»æ¥å£ä¸­è·å–ç›®æ ‡å¯¹è±¡ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åå°„å¯ä»¥å°†â€œåå°„ç±»å‹å¯¹è±¡â€è½¬æ¢ä¸ºâ€œæ¥å£ç±»å‹å˜é‡&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;reflect.value.Interface().(å·²çŸ¥çš„ç±»å‹)&lt;/li&gt;
&lt;li&gt;éå†reflect.Typeçš„Fieldè·å–å…¶Field&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åå°„å¯ä»¥ä¿®æ”¹åå°„ç±»å‹å¯¹è±¡ï¼Œä½†æ˜¯å…¶å€¼å¿…é¡»æ˜¯â€œaddressableâ€&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æƒ³è¦åˆ©ç”¨åå°„ä¿®æ”¹å¯¹è±¡çŠ¶æ€ï¼Œå‰ææ˜¯ interface.data æ˜¯ settable,å³ pointer-interface&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é€šè¿‡åå°„å¯ä»¥â€œåŠ¨æ€â€è°ƒç”¨æ–¹æ³•&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å› ä¸ºGolangæœ¬èº«ä¸æ”¯æŒæ¨¡æ¿ï¼Œå› æ­¤åœ¨ä»¥å¾€éœ€è¦ä½¿ç”¨æ¨¡æ¿çš„åœºæ™¯ä¸‹å¾€å¾€å°±éœ€è¦ä½¿ç”¨åå°„(reflect)æ¥å®ç°&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.golang.org/laws-of-reflection&#34;&gt;https://blog.golang.org/laws-of-reflection&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://juejin.im/post/5a75a4fb5188257a82110544#heading-2&#34;&gt;https://juejin.im/post/5a75a4fb5188257a82110544#heading-2&lt;/a&gt;&lt;br /&gt;
&lt;a href=&#34;https://www.zhihu.com/question/28570203&#34;&gt;https://www.zhihu.com/question/28570203&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>ä¸ºä»€ä¹ˆå¼€è¿™ä¸ªåšå®¢</title>
      <link>https://jayhong.github.io/post/20190305-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%80%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2/</link>
      <pubDate>Tue, 05 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://jayhong.github.io/post/20190305-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%80%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2/</guid>
      
        <description>

&lt;h2 id=&#34;ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹å†™åšå®¢&#34;&gt;ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹å†™åšå®¢&lt;/h2&gt;

&lt;p&gt;å…¶å®æ—©åœ¨æˆ‘è¿˜æ²¡æœ‰æ¯•ä¸šçš„æ—¶å€™ï¼Œå°±å·²ç»æœ‰å†™ä¸€äº›åšå®¢ã€‚å½“æ—¶æ˜¯å†™åœ¨csdnä¸Šé¢ï¼Œè¯´èµ·æ¥ä¹Ÿæ˜¯æç¬‘ï¼Œå› ä¸ºå†™çš„æ–‡ä»¶é‡Œé¢ä¼šå¸¦ä¸€äº›å¼•ç”¨çš„é“¾æ¥ï¼Œç„¶åå°±è¢«csdnå°æ‰äº†ï¼Œç”³è¯‰ä¹‹åçš„åŸå› å°±æ˜¯è¯´æˆ‘çš„æ–‡ç« å¸¦æœ‰å¾ˆå¤šå¤–é“¾
ã€‚è¢«å½“æˆæ˜¯åƒåœ¾åšå®¢äº†ã€‚å½“æ—¶å†™åšå®¢å¾ˆå¤§çš„ä¸€ä¸ªåŸå› å°±æ˜¯å› ä¸ºè¦æ‰¾å·¥ä½œï¼Œæ‰¾å·¥ä½œçš„æ—¶å€™å°±å¯ä»¥åœ¨è‡ªå·±çš„ç®€å†ä¸Šå†™ä¸Šblogåœ°å€ï¼Œ
å…¶å®æƒ³æƒ³ä¹Ÿæ˜¯æŒºæ€¥åŠŸè¿‘åˆ©çš„ã€‚åæ¥è‡ªå·±ä¹°äº†ä¸ªäº‘ä¸»æœºä¹°äº†ä¸ªåŸŸåï¼Œä¹Ÿç”¨hugoå¼„äº†ä¸€ä¸ªåšå®¢ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡èƒ½åšæŒä¸‹æ¥ã€‚å»å¹´11æœˆä»½ä¹Ÿåˆ°æœŸäº†æ²¡æœ‰ç»§ç»­ç»­è´¹äº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä¸ºå•¥è¦å†™åšå®¢&#34;&gt;ä¸ºå•¥è¦å†™åšå®¢&lt;/h2&gt;

&lt;p&gt;ä½œä¸ºä¸€ä¸ªè½¯ä»¶å¼€å‘äººå‘˜ï¼Œéœ€è¦ä¸åœåœ°å­¦ä¹ ã€‚å­¦ä¹ çš„è¿‡ç¨‹ä¸­æ˜¯ä¸€ä¸ªä¸æ–­æ•´ç†å½’çº³çš„è¿‡ç¨‹ï¼Œå‰å‡ å¹´çœ‹çš„æŠ€æœ¯ä¹¦ç±éæŠ€æœ¯ä¹¦ç±ï¼Œç®—ä¸‹æ¥ä¹Ÿæœ‰10å¤šæœ¬ï¼Œä½†æ˜¯çœŸæ­£æ²‰æ·€ä¸‹æ¥çš„çŸ¥è¯†å´
å°‘å¾—å¯æ€œï¼Œè€Œä¸”å¾ˆå¤šçŸ¥è¯†æ²¡åŠæ³•ä¸²æˆä¸€æ£µæ ‘ï¼Œè€Œä¸”æˆ‘å‘ç°è¡¨è¾¾èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯æŠ€æœ¯çš„è¡¨è¾¾èƒ½åŠ›æˆ‘ç›®å‰è¿˜æ˜¯æŒºæ¬ ç¼ºçš„ã€‚æ‰€ä»¥æƒ³ç€é”»ç‚¼ä¸€ä¸‹è‡ªå·±ã€‚åˆšå¥½ç›®å‰çš„å·¥ä½œä»»åŠ¡ä¹Ÿæ¯”ä¹‹å‰å°‘äº†ä¸€äº›ã€‚
ä¹‹å‰ä¼šæŠŠå·¥ä½œè®°å½•åˆ°æœ‰é“äº‘é‡Œé¢ï¼Œä½†æ˜¯æˆ‘ç¿»äº†ä¸€ä¸‹å‘ç°å¾ˆå¤šéƒ½æ˜¯ä¸å®Œæ•´çš„ã€‚æ‰€ä»¥é¡ºä¾¿æ•´ç†ä¸€ä¸‹ã€‚è¯´ä¸å®šæˆ‘çš„ä¸€äº›æ–‡ç« è¿˜å¯ä»¥å¸®åˆ°ä¸€äº›æœ‹å‹å‘¢ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åšå®¢çš„å†…å®¹&#34;&gt;åšå®¢çš„å†…å®¹&lt;/h2&gt;

&lt;p&gt;åœ¨è¿™é‡Œå†™çš„æ–‡ç« åº”è¯¥ä¼šä»¥æŠ€æœ¯ä¸ºä¸»ï¼Œå¯èƒ½ä¹Ÿä¼šç©¿æ’ä¸€äº›å¯¹ç”Ÿæ´»çš„æ„Ÿæ‚Ÿå§ã€‚æ¯•ç«Ÿæˆ‘è§‰å¾—æˆ‘è¿˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒå–œæ¬¢æ— ç—…å‘»åŸçš„äººã€‚æ‰€ä»¥å€Ÿæ­¤ç«‹ä¸‹ä¸€ä¸ªflagã€‚ä¸€å‘¨è‡³å°‘å‘å‡ ç¯‡æŠ€æœ¯æˆ–è€…éæŠ€æœ¯æ–‡å­—å§ã€‚
æŠ€æœ¯çš„è¯æˆ‘ä¼šå…ˆå°†å‰å‡ å¹´å­¦ä¹ çš„ä¸œè¥¿éƒ½æ•´ç†ä¸€éã€‚&lt;/p&gt;
</description>
      
    </item>
    
  </channel>
</rss>